import{J as Te,r as f,R as H,j as e,t as $e,S as q,Q as Oe}from"./app-Cfy4TXUM.js";import{S as z,j as we,n as Le,o as qe,B as v,A as Ne,D as he}from"./AdminSidebarLayout-Buj-taLG.js";import{d as S}from"./dayjs.min-CQ88ldzR.js";import{F as m}from"./index-BM3_YHPt.js";import{M as K,R as ye}from"./index-BTuzFoE5.js";import{A as U}from"./index-B5CpmtyB.js";import{R as Ze}from"./InfoCircleOutlined-C-FiczMP.js";import{I as P}from"./index-BWhN2zcf.js";import{S as M}from"./index-BH-hJvoT.js";import{T as N}from"./index-Dbm_9vxK.js";import{D as Q}from"./index-B7DGN-AY.js";import{s as Ce}from"./index-BScjEhXM.js";import{R as G}from"./CheckCircleOutlined-D3khjOz4.js";import{s as g}from"./index-CMJhgVxZ.js";import{P as Ve}from"./progress-j8EeeJZ1.js";import{R as V,C as R,T as Xe}from"./index-mG9EyX9P.js";import{R as fe,C as A}from"./row-DnGM8N7d.js";import{R as ge}from"./useIcons-C0CVJH8d.js";import{F as y}from"./Table-BDJDT3yO.js";import{T as X}from"./index-eYiOuDe6.js";import{R as be}from"./getAllowClear-CEhEtxYT.js";import{R as je}from"./BankOutlined-CjDe3nlE.js";import{R as Se}from"./MoreOutlined-BWZw2gaf.js";import{R as He}from"./EditOutlined-DIT7bWP5.js";import"./SessionTimeout-Dn5jdFb_.js";import"./Modal-dSY3wv-x.js";import"./transition-CwSGfga5.js";import"./PrimaryButton-D3tyYlDf.js";import"./SecondaryButton-HhmXi8wu.js";import"./CSSMotionList-CIWGNMjx.js";import"./useForm-WxDJKNk0.js";import"./CheckCircleFilled-JrBW7ofW.js";import"./InfoCircleFilled-Ce035z5p.js";import"./Input-CfZxHJYv.js";import"./EyeOutlined-c0yod4UM.js";import"./TextArea-kKKIj_tr.js";import"./index-BqBQ4c5d.js";import"./DownOutlined-D7IvzF20.js";import"./CalendarOutlined-Dc2SfXVk.js";import"./ClockCircleOutlined-BEpyFDSv.js";import"./scrollTo-CLqcVzDY.js";import"./index-Du1U9e5C.js";const{TextArea:Ke}=P,{Option:Je}=M;function Ue({open:c,onClose:T,members:I,defaultType:a="monthly"}){const{props:w}=Te(),F=w.settings||{},i=F.monthly_contribution_amount?parseFloat(F.monthly_contribution_amount.value):5e4,[h]=m.useForm(),[B,l]=f.useState(!1),[n,x]=f.useState(a);H.useEffect(()=>{c&&x(a)},[c,a]),H.useEffect(()=>{c&&setTimeout(()=>{h.resetFields();const s={member_id:void 0,date:S(),notes:""};n==="monthly"?(s.amount=i,s.purpose="Monthly Contribution"):(s.amount=void 0,s.purpose=""),h.setFieldsValue(s)},0)},[c,n,i,h]);const o=s=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),C=async s=>{var Y,E,W;l(!0);const _={member_id:s.member_id,type:n,amount:s.amount,date:s.date.format("YYYY-MM-DD"),purpose:s.purpose,notes:s.notes||""};try{(await window.axios.post(route("contributions.store"),_,{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}})).data.success&&(Ce.success({message:"Success!",description:"Contribution recorded successfully!",icon:e.jsx(G,{style:{color:"#52c41a"}}),placement:"topRight",duration:3}),h.resetFields(),T(),setTimeout(()=>{window.location.reload()},1500))}catch(k){if(console.error("Error:",k),((Y=k.response)==null?void 0:Y.status)===422){const $=k.response.data.errors;Object.keys($).forEach(O=>{g.error($[O][0])})}else(W=(E=k.response)==null?void 0:E.data)!=null&&W.message?g.error(k.response.data.message):g.error("Failed to record contribution. Please try again.")}finally{l(!1)}},p=()=>{h.resetFields(),T()};return H.useEffect(()=>{c||h.resetFields()},[c,h]),e.jsx(K,{title:e.jsxs(z,{children:[e.jsx(we,{style:{color:"#1890ff"}}),e.jsx("span",{children:n==="monthly"?"Add Monthly Contribution":"Add Other Contribution"})]}),open:c,onCancel:p,onOk:()=>h.submit(),confirmLoading:B,okText:n==="monthly"?"Add Monthly Contribution":"Add Other Contribution",cancelText:"Cancel",width:600,styles:{body:{maxHeight:"70vh",overflowY:"auto"}},centered:!0,destroyOnClose:!0,children:e.jsxs(m,{form:h,layout:"vertical",onFinish:C,children:[e.jsx(U,{message:n==="monthly"?"Monthly Contribution":"Other Contribution",description:n==="monthly"?"System handles multiple payments and advance payments automatically. Excess amounts are distributed to future months.":"Record special projects, donations, or other non-monthly contributions.",type:"info",icon:e.jsx(Ze,{}),showIcon:!0,style:{marginBottom:24}}),e.jsx(m.Item,{name:"type",hidden:!0,initialValue:n,children:e.jsx(P,{})}),e.jsx(m.Item,{label:"Member",name:"member_id",rules:[{required:!0,message:"Please select a member"}],children:e.jsx(M,{showSearch:!0,placeholder:"Select a member",optionFilterProp:"children",filterOption:(s,_)=>_.children.toLowerCase().includes(s.toLowerCase()),children:I.map(s=>e.jsx(Je,{value:s.id,children:s.name},s.id))})}),e.jsx(m.Item,{label:"Amount (TZS)",name:"amount",rules:[{required:!0,message:"Please enter an amount"},{type:"number",min:0,message:"Amount must be positive"}],extra:n==="monthly"?`Monthly contribution: ${o(i)} â€¢ Smart distribution enabled`:"Enter amount for special contribution",children:e.jsx(N,{style:{width:"100%"},placeholder:"Enter amount",formatter:s=>`${s}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:s=>s.replace(/\$\s?|(,*)/g,""),prefix:"TZS"})}),e.jsx(m.Item,{label:"Date",name:"date",rules:[{required:!0,message:"Please select a date"}],children:e.jsx(Q,{style:{width:"100%"},format:"YYYY-MM-DD"})}),e.jsx(m.Item,{label:"Purpose",name:"purpose",rules:[{required:!0,message:"Please enter a purpose"}],children:e.jsx(P,{placeholder:n==="monthly"?"Monthly Contribution":"Enter purpose (e.g., Building Fund, Equipment)",autoComplete:"new-password",style:{backgroundColor:"transparent"},styles:{input:{backgroundColor:"transparent",WebkitBoxShadow:"none",boxShadow:"none"}}})}),e.jsx(m.Item,{label:"Notes (Optional)",name:"notes",children:e.jsx(Ke,{rows:3,placeholder:"Additional notes about this contribution..."})})]},`form-${n}`)},`contribution-form-${n}-${c}`)}const{Option:Qe}=M,{TextArea:Nt}=P;function Ge({open:c,onClose:T,members:I,editingLoan:a}){const[w]=m.useForm(),[F,i]=f.useState(!1),h=async l=>{var x,o,C;i(!0);const n={member_id:l.member_id,amount:l.amount,interest_rate:l.interest_rate,purpose:l.purpose,term_months:l.term_months,due_date:l.due_date.format("YYYY-MM-DD")};try{let p;a?p=await window.axios.put(route("loans.update",a.id),n,{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}):p=await window.axios.post(route("loans.store"),n,{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}),p.data.success&&(Ce.success({message:"Success!",description:a?"Loan updated successfully!":"Loan created successfully!",icon:e.jsx(G,{style:{color:"#52c41a"}}),placement:"topRight",duration:3}),w.resetFields(),T(),setTimeout(()=>{window.location.reload()},1500))}catch(p){if(console.error("Error:",p),((x=p.response)==null?void 0:x.status)===422){const s=p.response.data.errors;Object.keys(s).forEach(_=>{g.error(s[_][0])})}else(C=(o=p.response)==null?void 0:o.data)!=null&&C.message?g.error(p.response.data.message):g.error(a?"Failed to update loan. Please try again.":"Failed to create loan. Please try again.")}finally{i(!1)}},B=()=>{w.resetFields(),T()};return f.useEffect(()=>{a&&c?w.setFieldsValue({member_id:a.member_id,amount:a.amount,interest_rate:a.interest_rate,purpose:a.purpose,term_months:a.term_months,due_date:a.due_date?S(a.due_date):S().add(12,"months")}):!a&&c&&w.setFieldsValue({interest_rate:13,term_months:12,due_date:S().add(12,"months")})},[a,c,w]),e.jsx(K,{title:e.jsxs(z,{children:[e.jsx(we,{style:{color:"#1890ff"}}),e.jsx("span",{children:a?"Edit Loan":"Create Loan"})]}),open:c,onCancel:B,onOk:()=>w.submit(),confirmLoading:F,okText:a?"Update Loan":"Create Loan",cancelText:"Cancel",width:600,styles:{body:{maxHeight:"70vh",overflowY:"auto"}},centered:!0,children:e.jsxs(m,{form:w,layout:"vertical",onFinish:h,initialValues:{interest_rate:13,term_months:12,due_date:S().add(12,"months")},children:[e.jsx(m.Item,{label:"Member",name:"member_id",rules:[{required:!0,message:"Please select a member"}],children:e.jsx(M,{showSearch:!0,placeholder:"Select a member",optionFilterProp:"children",filterOption:(l,n)=>n.children.toLowerCase().includes(l.toLowerCase()),children:((I==null?void 0:I.data)||I||[]).map(l=>e.jsx(Qe,{value:l.id,children:l.name},l.id))})}),e.jsx(m.Item,{label:"Loan Amount (TZS)",name:"amount",rules:[{required:!0,message:"Please enter loan amount"},{type:"number",min:1,message:"Amount must be greater than 0"}],children:e.jsx(N,{style:{width:"100%"},placeholder:"Enter loan amount",formatter:l=>`${l}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:l=>l.replace(/\$\s?|(,*)/g,""),prefix:"TZS"})}),e.jsx(m.Item,{label:"Interest Rate (% per month)",name:"interest_rate",rules:[{required:!0,message:"Please enter interest rate"},{type:"number",min:0,max:100,message:"Interest rate must be between 0 and 100"}],children:e.jsx(N,{style:{width:"100%"},placeholder:"Enter monthly interest rate",suffix:"%",step:.1,precision:2})}),e.jsx(m.Item,{label:"Purpose",name:"purpose",rules:[{required:!0,message:"Please enter loan purpose"}],children:e.jsx(P,{placeholder:"Enter loan purpose (e.g., Business expansion, Emergency, etc.)"})}),e.jsx(m.Item,{label:"Loan Term (Months)",name:"term_months",rules:[{required:!0,message:"Please enter loan term"},{type:"number",min:1,max:60,message:"Term must be between 1 and 60 months"}],children:e.jsx(N,{style:{width:"100%"},placeholder:"Enter loan term in months",min:1,max:60})}),e.jsx(m.Item,{label:"Due Date",name:"due_date",rules:[{required:!0,message:"Please select due date"}],children:e.jsx(Q,{style:{width:"100%"},format:"YYYY-MM-DD",disabledDate:l=>l&&l<S().startOf("day")})})]})})}const{Option:et}=M;function tt({open:c,onClose:T,members:I}){const[a]=m.useForm(),[w,F]=f.useState(!1),[i,h]=f.useState({isProcessing:!1,total:0,sent:0,failed:0,currentStep:"idle",errors:[]}),B=async n=>{var o,C;F(!0),h({isProcessing:!0,total:0,sent:0,failed:0,currentStep:"creating",errors:[]});const x={member_id:n.member_id,amount:n.amount,date:n.date.format("YYYY-MM-DD"),purpose:n.purpose};try{const s=(await window.axios.post(route("disaster-payments.store"),x,{headers:{"X-Requested-With":"XMLHttpRequest"}})).data;s.success&&(h({isProcessing:!1,total:s.email_results.total,sent:s.email_results.sent,failed:s.email_results.failed,currentStep:"complete",errors:s.email_results.errors||[]}),g.success(`Disbursement recorded! Notifications sent to ${s.email_results.sent} members.`),setTimeout(()=>{a.resetFields(),T(),window.location.reload()},3e3))}catch(p){console.error("Error:",p),h({isProcessing:!1,total:0,sent:0,failed:0,currentStep:"idle",errors:[]}),(C=(o=p.response)==null?void 0:o.data)!=null&&C.errors?Object.keys(p.response.data.errors).forEach(s=>{g.error(p.response.data.errors[s][0])}):g.error("Failed to record disbursement. Please try again.")}finally{F(!1)}},l=()=>{i.isProcessing||(a.resetFields(),h({isProcessing:!1,total:0,sent:0,failed:0,currentStep:"idle",errors:[]}),T())};return e.jsx(K,{title:e.jsxs(z,{children:[e.jsx(qe,{style:{color:"#1890ff"}}),e.jsx("span",{children:"Add Disbursement"})]}),open:c,onCancel:l,onOk:()=>a.submit(),confirmLoading:w||i.isProcessing,okText:i.isProcessing?"Processing...":"Add Disbursement",cancelText:"Cancel",width:600,closable:!i.isProcessing,maskClosable:!i.isProcessing,styles:{body:{maxHeight:"70vh",overflowY:"auto"}},centered:!0,children:e.jsxs(m,{form:a,layout:"vertical",onFinish:B,initialValues:{date:S()},children:[e.jsx(m.Item,{label:"Member",name:"member_id",rules:[{required:!0,message:"Please select a member"}],children:e.jsx(M,{showSearch:!0,placeholder:"Select a member",optionFilterProp:"children",filterOption:(n,x)=>x.children.toLowerCase().includes(n.toLowerCase()),disabled:i.isProcessing,children:I.map(n=>e.jsx(et,{value:n.id,children:n.name},n.id))})}),e.jsx(m.Item,{label:"Amount (TZS)",name:"amount",rules:[{required:!0,message:"Please enter an amount"},{type:"number",min:0,message:"Amount must be positive"}],children:e.jsx(N,{style:{width:"100%"},placeholder:"Enter disbursement amount",formatter:n=>`${n}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:n=>n.replace(/\$\s?|(,*)/g,""),prefix:"TZS",disabled:i.isProcessing})}),e.jsx(m.Item,{label:"Date",name:"date",rules:[{required:!0,message:"Please select a date"}],children:e.jsx(Q,{style:{width:"100%"},format:"YYYY-MM-DD",disabled:i.isProcessing})}),e.jsx(m.Item,{label:"Purpose",name:"purpose",rules:[{required:!0,message:"Please enter a purpose"}],children:e.jsx(P,{placeholder:"Purpose of disbursement (e.g., Medical Emergency, Funeral)",disabled:i.isProcessing})}),i.isProcessing&&e.jsx(U,{message:i.currentStep==="creating"?"Creating disbursement...":"Sending email notifications...",description:i.total>0&&e.jsxs("div",{style:{marginTop:12},children:[e.jsx(Ve,{percent:Math.round(i.sent/i.total*100),status:"active"}),e.jsxs("div",{style:{marginTop:8,fontSize:12},children:["Sent ",i.sent," of ",i.total," notifications",i.failed>0&&` (${i.failed} failed)`]})]}),type:"info",icon:e.jsx(Le,{}),showIcon:!0}),i.currentStep==="complete"&&e.jsx(U,{message:"Email Notifications Complete",description:e.jsxs("div",{children:[e.jsxs("div",{children:["âœ… Successfully sent to ",i.sent," members"]}),i.failed>0&&e.jsxs("div",{style:{color:"#fa8c16"},children:["âš ï¸ Failed to send to ",i.failed," members"]})]}),type:"success",showIcon:!0})]})})}function Zt(){var me,ue;const{members:c=[],allMembers:T=[],monthlyContributionsByMonth:I={},memberMonthlyTotal:a={},memberOtherTotal:w={},otherContributions:F={},otherContributionsSummary:i=[],loans:h={},penalties:B={},disasterPayments:l={},statistics:n={},filters:x={}}=Te().props,{token:o}=$e.useToken(),[C,p]=f.useState(x.tab||"contributions"),[s,_]=f.useState(x.search||""),[Y,E]=f.useState(x.year||new Date().getFullYear()),[W,k]=f.useState(x.month||"");H.useEffect(()=>{x.tab&&x.tab!==C&&p(x.tab)},[x.tab]);const[$,O]=f.useState(!1),[ee,te]=f.useState("monthly"),[ve,re]=f.useState(!1),[ke,oe]=f.useState(!1),[se,ne]=f.useState(null),ie=r=>{$?(O(!1),setTimeout(()=>{te(r),O(!0)},100)):(te(r),O(!0))},b=r=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(r||0),ae=Array.from({length:new Date().getFullYear()-2018+1},(r,t)=>({label:String(2018+t),value:2018+t})).reverse(),le=[{label:"All Months",value:""},{label:"January",value:1},{label:"February",value:2},{label:"March",value:3},{label:"April",value:4},{label:"May",value:5},{label:"June",value:6},{label:"July",value:7},{label:"August",value:8},{label:"September",value:9},{label:"October",value:10},{label:"November",value:11},{label:"December",value:12}],de=()=>{q.get(route("admin-portal.financials"),{search:s,year:Y,month:W,tab:C})},ce=()=>{_(""),E(new Date().getFullYear()),k(""),q.get(route("admin-portal.financials"),{tab:C})},[D,L]=f.useState({open:!1,type:"",loan:null,confirmText:"",loading:!1}),Me=async(r,t)=>{var u,j;L(d=>({...d,loading:!0}));try{let d;switch(t){case"disburse":d=await window.axios.patch(route("loans.disburse",r));break;case"repaid":d=await window.axios.patch(route("loans.markAsRepaid",r));break;case"delete":d=await window.axios.delete(route("loans.destroy",r));break;default:throw new Error("Unknown action")}d.data.success&&(g.success(d.data.message),L({open:!1,type:"",loan:null,confirmText:"",loading:!1}),setTimeout(()=>{window.location.reload()},1e3))}catch(d){console.error("Error:",d),(j=(u=d.response)==null?void 0:u.data)!=null&&j.message?g.error(d.response.data.message):g.error(`Failed to ${t} loan. Please try again.`)}finally{L(d=>({...d,loading:!1}))}},J=(r,t)=>{L({open:!0,type:t,loan:r,confirmText:"",loading:!1})},Ie=()=>{var j,d;const{type:r,loan:t,confirmText:u}=D;if(r==="delete"&&u!==((j=t.member)==null?void 0:j.name)){g.error(`Please type "${(d=t.member)==null?void 0:d.name}" to confirm deletion`);return}Me(t.id,r)},Fe=()=>{L({open:!1,type:"",loan:null,confirmText:"",loading:!1})},_e=async r=>{try{await q.patch(route("penalties.markAsPaid",r.id),{},{onSuccess:()=>{g.success(`Penalty for ${r.member.name} marked as paid successfully`)},onError:t=>{g.error("Failed to mark penalty as paid"),console.error("Error:",t)}})}catch(t){g.error("An error occurred while marking penalty as paid"),console.error("Error:",t)}},Z=()=>{var u,j,d,pe,xe;const{type:r,loan:t}=D;switch(r){case"disburse":return{title:e.jsxs(z,{children:[e.jsx(je,{style:{color:"#1890ff"}}),e.jsx("span",{children:"Disburse Loan"})]}),content:e.jsxs("div",{style:{color:o.colorText},children:[e.jsx("p",{style:{marginBottom:"16px",fontSize:"14px",color:o.colorTextSecondary},children:"Are you sure you want to disburse this loan?"}),e.jsx("div",{style:{background:o.colorBgElevated,border:`1px solid ${o.colorBorder}`,padding:"16px",borderRadius:"8px",marginBottom:"16px"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"11px",color:o.colorTextTertiary,textTransform:"uppercase",fontWeight:600,marginBottom:"4px"},children:"Member"}),e.jsx("div",{style:{fontSize:"14px",fontWeight:500,color:o.colorText},children:(u=t==null?void 0:t.member)==null?void 0:u.name})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"11px",color:o.colorTextTertiary,textTransform:"uppercase",fontWeight:600,marginBottom:"4px"},children:"Principal"}),e.jsx("div",{style:{fontSize:"14px",fontWeight:600,color:o.colorPrimary,fontFamily:"monospace"},children:b(t==null?void 0:t.amount)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"11px",color:o.colorTextTertiary,textTransform:"uppercase",fontWeight:600,marginBottom:"4px"},children:"Interest Rate"}),e.jsxs("div",{style:{fontSize:"14px",fontWeight:500,color:o.colorText},children:[t==null?void 0:t.interest_rate,"% monthly"]})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"11px",color:o.colorTextTertiary,textTransform:"uppercase",fontWeight:600,marginBottom:"4px"},children:"Total Amount"}),e.jsx("div",{style:{fontSize:"14px",fontWeight:600,color:o.colorSuccess,fontFamily:"monospace"},children:b((t==null?void 0:t.total_amount)||(t==null?void 0:t.amount))})]})]})}),e.jsx("div",{style:{background:o.colorInfoBg,border:`1px solid ${o.colorInfoBorder}`,padding:"12px",borderRadius:"6px",fontSize:"13px",color:o.colorTextSecondary},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:o.colorInfo,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",color:"white"},children:"ðŸ“Š"}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:o.colorInfo},children:"Accounting Impact:"}),e.jsx("br",{}),"This will create journal entries: Loans Receivable â†” Cash"]})]})})]}),okText:"Disburse Loan",okType:"primary"};case"repaid":return{title:e.jsxs(z,{children:[e.jsx(be,{style:{color:"#52c41a"}}),e.jsx("span",{children:"Mark Loan as Repaid"})]}),content:e.jsxs("div",{style:{color:o.colorText},children:[e.jsx("p",{style:{marginBottom:"16px",fontSize:"14px",color:o.colorTextSecondary},children:"Are you sure you want to mark this loan as repaid?"}),e.jsx("div",{style:{background:o.colorBgElevated,border:`1px solid ${o.colorBorder}`,padding:"16px",borderRadius:"8px",marginBottom:"16px"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"11px",color:o.colorTextTertiary,textTransform:"uppercase",fontWeight:600,marginBottom:"4px"},children:"Member"}),e.jsx("div",{style:{fontSize:"14px",fontWeight:500,color:o.colorText},children:(j=t==null?void 0:t.member)==null?void 0:j.name})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"11px",color:o.colorTextTertiary,textTransform:"uppercase",fontWeight:600,marginBottom:"4px"},children:"Principal"}),e.jsx("div",{style:{fontSize:"14px",fontWeight:500,color:o.colorText,fontFamily:"monospace"},children:b(t==null?void 0:t.amount)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"11px",color:o.colorTextTertiary,textTransform:"uppercase",fontWeight:600,marginBottom:"4px"},children:"Interest Earned"}),e.jsx("div",{style:{fontSize:"14px",fontWeight:500,color:o.colorWarning,fontFamily:"monospace"},children:b(((t==null?void 0:t.total_amount)||(t==null?void 0:t.amount))-(t==null?void 0:t.amount))})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"11px",color:o.colorTextTertiary,textTransform:"uppercase",fontWeight:600,marginBottom:"4px"},children:"Total Repayment"}),e.jsx("div",{style:{fontSize:"14px",fontWeight:600,color:o.colorSuccess,fontFamily:"monospace"},children:b((t==null?void 0:t.total_amount)||(t==null?void 0:t.amount))})]})]})}),e.jsx("div",{style:{background:o.colorInfoBg,border:`1px solid ${o.colorInfoBorder}`,padding:"12px",borderRadius:"6px",fontSize:"13px",color:o.colorTextSecondary},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:o.colorInfo,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",color:"white"},children:"ðŸ“Š"}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:o.colorInfo},children:"Accounting Impact:"}),e.jsx("br",{}),"This will create journal entries: Cash â†” Loans Receivable + Interest Income"]})]})})]}),okText:"Mark as Repaid",okType:"primary"};case"delete":return{title:e.jsxs(z,{children:[e.jsx(ye,{style:{color:"#ff4d4f"}}),e.jsx("span",{children:"Delete Loan"})]}),content:e.jsxs("div",{style:{color:o.colorText},children:[e.jsx("div",{style:{background:o.colorErrorBg,border:`1px solid ${o.colorErrorBorder}`,padding:"12px",borderRadius:"6px",marginBottom:"16px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:o.colorError,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",color:"white"},children:"âš ï¸"}),e.jsxs("div",{children:[e.jsx("div",{style:{color:o.colorError,fontWeight:600,fontSize:"14px",marginBottom:"4px"},children:"This action cannot be undone!"}),e.jsx("div",{style:{fontSize:"13px",color:o.colorTextSecondary},children:"You are about to permanently delete this loan."})]})]})}),e.jsx("div",{style:{background:o.colorBgElevated,border:`1px solid ${o.colorBorder}`,padding:"16px",borderRadius:"8px",marginBottom:"16px"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"11px",color:o.colorTextTertiary,textTransform:"uppercase",fontWeight:600,marginBottom:"4px"},children:"Member"}),e.jsx("div",{style:{fontSize:"14px",fontWeight:500,color:o.colorText},children:(d=t==null?void 0:t.member)==null?void 0:d.name})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"11px",color:o.colorTextTertiary,textTransform:"uppercase",fontWeight:600,marginBottom:"4px"},children:"Amount"}),e.jsx("div",{style:{fontSize:"14px",fontWeight:500,color:o.colorText,fontFamily:"monospace"},children:b(t==null?void 0:t.amount)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"11px",color:o.colorTextTertiary,textTransform:"uppercase",fontWeight:600,marginBottom:"4px"},children:"Purpose"}),e.jsx("div",{style:{fontSize:"14px",fontWeight:500,color:o.colorText},children:t==null?void 0:t.purpose})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"11px",color:o.colorTextTertiary,textTransform:"uppercase",fontWeight:600,marginBottom:"4px"},children:"Status"}),e.jsx(X,{color:"orange",style:{fontSize:"11px",fontWeight:500,margin:0},children:t==null?void 0:t.status})]})]})}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("div",{style:{fontSize:"13px",color:o.colorTextSecondary,marginBottom:"8px"},children:"To confirm deletion, please type the member's name:"}),e.jsx("div",{style:{fontSize:"14px",fontWeight:600,color:o.colorText,marginBottom:"8px",padding:"8px 12px",background:o.colorBgElevated,border:`1px solid ${o.colorBorder}`,borderRadius:"4px",fontFamily:"monospace"},children:(pe=t==null?void 0:t.member)==null?void 0:pe.name})]}),e.jsx(P,{placeholder:`Type "${(xe=t==null?void 0:t.member)==null?void 0:xe.name}" to confirm`,value:D.confirmText,onChange:Ee=>L(We=>({...We,confirmText:Ee.target.value})),style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})]}),okText:"Delete Loan",okType:"danger"};default:return{}}},Pe=r=>{p(r),q.get(route("admin-portal.financials"),{...x,tab:r},{preserveState:!0,preserveScroll:!0})},De=[{title:"Member",dataIndex:"name",key:"name",width:200},{title:"Email",dataIndex:"email",key:"email",width:200},{title:"Phone",dataIndex:"phone_number",key:"phone_number",width:150},{title:"Monthly Contributions",key:"monthly_total",width:150,render:(r,t)=>{const u=a[t.id]||0;return b(u)}},{title:"Actions",key:"actions",width:120,render:(r,t)=>e.jsx(v,{type:"link",onClick:()=>q.visit(route("admin-portal.member-contributions",{member:t.id,year:Y})),children:"View Details"})}],Re=[{title:"Member",dataIndex:["member","name"],key:"member_name",width:200},{title:"Amount",dataIndex:"amount",key:"amount",width:150,render:r=>b(r)},{title:"Date",dataIndex:"date",key:"date",width:150,render:r=>S(r).format("DD MMM YYYY")},{title:"Purpose",dataIndex:"purpose",key:"purpose",width:250},{title:"Notes",dataIndex:"notes",key:"notes",ellipsis:!0}],Ae=[{title:"Member",dataIndex:["member","name"],key:"member_name",width:180,render:r=>e.jsx("div",{style:{fontWeight:500,fontSize:"14px",color:o.colorText},children:r})},{title:"Principal",dataIndex:"amount",key:"amount",width:120,align:"right",render:r=>e.jsx("div",{style:{fontWeight:500,fontSize:"13px",color:o.colorText,fontFamily:"monospace"},children:b(r)})},{title:"Rate",dataIndex:"interest_rate",key:"interest_rate",width:80,align:"center",render:r=>e.jsxs(X,{color:"blue",style:{fontSize:"11px",fontWeight:500,margin:0},children:[r,"%"]})},{title:"Total Amount",dataIndex:"total_amount",key:"total_amount",width:130,align:"right",render:(r,t)=>e.jsx("div",{style:{fontWeight:600,fontSize:"13px",color:o.colorPrimary,fontFamily:"monospace"},children:b(r||t.amount)})},{title:"Purpose",dataIndex:"purpose",key:"purpose",width:160,ellipsis:!0,render:r=>e.jsx("div",{style:{fontSize:"13px",color:o.colorTextSecondary},children:r})},{title:"Status",dataIndex:"status",key:"status",width:100,align:"center",render:r=>{const u={pending:{color:"orange",text:"Pending"},disbursed:{color:"blue",text:"Disbursed"},repaid:{color:"green",text:"Repaid"}}[r]||{color:"default",text:r==null?void 0:r.toUpperCase()};return e.jsx(X,{color:u.color,style:{fontSize:"11px",fontWeight:500,margin:0,minWidth:"70px",textAlign:"center"},children:u.text})}},{title:"Date",dataIndex:"disbursement_date",key:"disbursement_date",width:100,align:"center",render:(r,t)=>e.jsx("div",{style:{fontSize:"12px",color:o.colorTextTertiary},children:r?S(r).format("MMM DD"):S(t.created_at).format("MMM DD")})},{title:"Actions",key:"actions",width:60,align:"center",fixed:"right",render:(r,t)=>{const u=[];return t.status==="pending"?u.push({key:"disburse",label:"Disburse",icon:e.jsx(je,{}),onClick:()=>J(t,"disburse")},{key:"edit",label:"Edit",icon:e.jsx(He,{}),onClick:()=>ne(t)},{type:"divider"},{key:"delete",label:"Delete",icon:e.jsx(ye,{}),danger:!0,onClick:()=>J(t,"delete")}):t.status==="disbursed"&&u.push({key:"repaid",label:"Mark as Repaid",icon:e.jsx(be,{}),onClick:()=>J(t,"repaid")}),e.jsx(he,{menu:{items:u},trigger:["click"],disabled:u.length===0,placement:"bottomRight",children:e.jsx(v,{type:"text",icon:e.jsx(Se,{}),size:"small",style:{color:o.colorTextTertiary,border:"none"}})})}}],ze=[{title:"Member",dataIndex:["member","name"],key:"member_name",width:200},{title:"Amount",dataIndex:"amount",key:"amount",render:r=>b(r)},{title:"Reason",dataIndex:"reason",key:"reason",width:200},{title:"Month",dataIndex:"penalty_month",key:"penalty_month",render:r=>r?S(r+"-01").format("MMM YYYY"):"N/A"},{title:"Due Date",dataIndex:"due_date",key:"due_date",render:r=>S(r).format("DD MMM YYYY")},{title:"Status",dataIndex:"status",key:"status",render:r=>e.jsx(X,{color:r==="paid"?"green":"orange",children:r.toUpperCase()})},{title:"Actions",key:"actions",width:120,render:(r,t)=>e.jsx(he,{menu:{items:[{key:"mark-paid",label:"Mark as Paid",icon:e.jsx(G,{}),disabled:t.status==="paid",onClick:()=>_e(t)}]},trigger:["click"],children:e.jsx(v,{type:"text",icon:e.jsx(Se,{})})})}],Be=[{title:"Member",dataIndex:["member","name"],key:"member_name",width:200},{title:"Amount",dataIndex:"amount",key:"amount",render:r=>b(r)},{title:"Date",dataIndex:"date",key:"date",render:r=>S(r).format("DD MMM YYYY")},{title:"Description",dataIndex:"description",key:"description",width:200}],Ye=[{key:"contributions",label:"Monthly Contributions",children:e.jsxs("div",{style:{padding:"24px"},children:[e.jsx("div",{style:{marginBottom:"16px",display:"flex",justifyContent:"flex-end"},children:e.jsx(v,{type:"primary",icon:e.jsx(V,{}),onClick:()=>ie("monthly"),size:"large",children:"Add Contribution"})}),e.jsx(R,{style:{marginBottom:"16px"},children:e.jsxs(fe,{gutter:[16,16],align:"middle",children:[e.jsx(A,{xs:24,sm:12,md:8,children:e.jsx(P,{placeholder:"Search by member name...",prefix:e.jsx(ge,{}),value:s,onChange:r=>_(r.target.value),allowClear:!0})}),e.jsx(A,{xs:24,sm:6,md:4,children:e.jsx(M,{placeholder:"Year",value:Y,onChange:r=>E(r),options:ae,style:{width:"100%"}})}),e.jsx(A,{xs:24,sm:6,md:4,children:e.jsx(M,{placeholder:"Month",value:W,onChange:r=>k(r),options:le,style:{width:"100%"}})}),e.jsx(A,{xs:24,md:8,style:{textAlign:"right"},children:e.jsxs(z,{children:[e.jsx(v,{type:"primary",onClick:de,children:"Apply"}),e.jsx(v,{onClick:ce,children:"Clear"})]})})]})}),e.jsx(R,{title:"Monthly Contributions",children:e.jsx(y,{columns:De,dataSource:c.data||c,rowKey:"id",pagination:c.data?{current:c.current_page,pageSize:c.per_page,total:c.total,onChange:r=>{q.get(route("admin-portal.financials"),{...x,page:r})}}:{pageSize:10},scroll:{x:800}})})]})},{key:"other-contributions",label:"Other Contributions",children:e.jsxs("div",{style:{padding:"24px"},children:[e.jsx("div",{style:{marginBottom:"16px",display:"flex",justifyContent:"flex-end"},children:e.jsx(v,{type:"primary",icon:e.jsx(V,{}),onClick:()=>ie("other"),size:"large",children:"Add Other Contribution"})}),e.jsx(R,{style:{marginBottom:"16px"},children:e.jsxs(fe,{gutter:[16,16],align:"middle",children:[e.jsx(A,{xs:24,sm:12,md:8,children:e.jsx(P,{placeholder:"Search by member name...",prefix:e.jsx(ge,{}),value:s,onChange:r=>_(r.target.value),allowClear:!0})}),e.jsx(A,{xs:24,sm:6,md:4,children:e.jsx(M,{placeholder:"Year",value:Y,onChange:r=>E(r),options:ae,style:{width:"100%"}})}),e.jsx(A,{xs:24,sm:6,md:4,children:e.jsx(M,{placeholder:"Month",value:W,onChange:r=>k(r),options:le,style:{width:"100%"}})}),e.jsx(A,{xs:24,md:8,style:{textAlign:"right"},children:e.jsxs(z,{children:[e.jsx(v,{type:"primary",onClick:de,children:"Apply"}),e.jsx(v,{onClick:ce,children:"Clear"})]})})]})}),e.jsx(R,{title:"Other Contributions (Projects, Donations, etc.)",children:e.jsx(y,{columns:Re,dataSource:F.data||[],rowKey:"id",pagination:{pageSize:10},scroll:{x:800},summary:r=>{const t=r.reduce((u,j)=>u+parseFloat(j.amount||0),0);return e.jsx(y.Summary,{fixed:!0,children:e.jsxs(y.Summary.Row,{children:[e.jsx(y.Summary.Cell,{index:0,colSpan:1,children:e.jsx("strong",{children:"Total"})}),e.jsx(y.Summary.Cell,{index:1,children:e.jsx("strong",{children:b(t)})}),e.jsx(y.Summary.Cell,{index:2,colSpan:3})]})})}})})]})},{key:"loans",label:"Loans",children:e.jsx("div",{style:{padding:"24px"},children:e.jsx(R,{title:"Member Loans",extra:e.jsx(v,{type:"primary",icon:e.jsx(V,{}),onClick:()=>re(!0),children:"Create Loan"}),children:e.jsx(y,{columns:Ae,dataSource:h.data||[],rowKey:"id",pagination:{pageSize:10,showSizeChanger:!1,showQuickJumper:!1,size:"small"},scroll:{x:900},size:"small",style:{backgroundColor:o.colorBgContainer},rowClassName:(r,t)=>t%2===0?"":"ant-table-row-striped",summary:r=>{const t=r.reduce((j,d)=>j+parseFloat(d.amount||0),0),u=r.reduce((j,d)=>j+parseFloat(d.total_amount||d.amount||0),0);return e.jsx(y.Summary,{fixed:!0,children:e.jsxs(y.Summary.Row,{style:{backgroundColor:o.colorBgElevated},children:[e.jsx(y.Summary.Cell,{index:0,children:e.jsx("strong",{style:{fontSize:"12px",color:o.colorText},children:"Total"})}),e.jsx(y.Summary.Cell,{index:1,align:"right",children:e.jsx("strong",{style:{fontSize:"12px",color:o.colorText,fontFamily:"monospace"},children:b(t)})}),e.jsx(y.Summary.Cell,{index:2}),e.jsx(y.Summary.Cell,{index:3,align:"right",children:e.jsx("strong",{style:{fontSize:"12px",color:o.colorPrimary,fontFamily:"monospace"},children:b(u)})}),e.jsx(y.Summary.Cell,{index:4,colSpan:4})]})})}})})})},{key:"penalties",label:"Penalties",children:e.jsx("div",{style:{padding:"24px"},children:e.jsx(R,{title:"Member Penalties",children:e.jsx(y,{columns:ze,dataSource:B.data||[],rowKey:"id",pagination:{pageSize:10},scroll:{x:800}})})})},{key:"disaster-payments",label:"Disbursements",children:e.jsx("div",{style:{padding:"24px"},children:e.jsx(R,{title:"Disaster Payments",extra:e.jsx(v,{type:"primary",icon:e.jsx(V,{}),onClick:()=>oe(!0),children:"Add Disbursement"}),children:e.jsx(y,{columns:Be,dataSource:l.data||[],rowKey:"id",pagination:{pageSize:10},scroll:{x:800}})})})}];return e.jsxs(e.Fragment,{children:[e.jsx(Oe,{title:"Contributions - Tabata Welfare Association"}),e.jsxs(Ne,{children:[e.jsx("div",{style:{padding:"24px 0"},children:e.jsx(R,{style:{borderRadius:"12px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.08)"},children:e.jsx(Xe,{items:Ye,activeKey:C,onChange:Pe})})}),$&&e.jsx(Ue,{open:$,onClose:()=>O(!1),members:T,defaultType:ee},ee),e.jsx(Ge,{open:ve||!!se,onClose:()=>{re(!1),ne(null)},members:T,editingLoan:se}),e.jsx(tt,{open:ke,onClose:()=>oe(!1),members:T}),e.jsx(K,{title:Z().title,open:D.open,onCancel:Fe,onOk:Ie,okText:Z().okText,okType:Z().okType,cancelText:"Cancel",confirmLoading:D.loading,okButtonProps:{disabled:D.type==="delete"&&D.confirmText!==((ue=(me=D.loan)==null?void 0:me.member)==null?void 0:ue.name)},centered:!0,width:520,styles:{mask:{backgroundColor:"rgba(0, 0, 0, 0.45)"},body:{backgroundColor:o.colorBgContainer,padding:"20px"}},children:Z().content})]})]})}export{Zt as default};
