import{r as s,t as D,R as J,j as e,Q as ee,S as g}from"./app-Cfy4TXUM.js";import{I as te,B as b,A as ae,S as le,T as ne,D as oe}from"./AdminSidebarLayout-Buj-taLG.js";import{F as d}from"./index-BM3_YHPt.js";import{I as S}from"./index-BWhN2zcf.js";import{S as p}from"./index-BH-hJvoT.js";import{T as re}from"./index-Dbm_9vxK.js";import{S as se}from"./index-BoXNcQYL.js";import{s as ce}from"./index-CMJhgVxZ.js";import{C as ie,R as de}from"./index-mG9EyX9P.js";import{R as ue}from"./useIcons-C0CVJH8d.js";import{F as pe}from"./Table-BDJDT3yO.js";import{E as $}from"./index-BqBQ4c5d.js";import{M as N,R as me}from"./index-BTuzFoE5.js";import{T}from"./index-eYiOuDe6.js";import{R as he}from"./MoreOutlined-BWZw2gaf.js";import{R as xe}from"./EditOutlined-DIT7bWP5.js";import{R as ge}from"./CheckCircleOutlined-D3khjOz4.js";import{T as ye}from"./index-BAjCEJt5.js";import"./SessionTimeout-Dn5jdFb_.js";import"./Modal-dSY3wv-x.js";import"./transition-CwSGfga5.js";import"./PrimaryButton-D3tyYlDf.js";import"./SecondaryButton-HhmXi8wu.js";import"./CSSMotionList-CIWGNMjx.js";import"./useForm-WxDJKNk0.js";import"./row-DnGM8N7d.js";import"./CheckCircleFilled-JrBW7ofW.js";import"./InfoCircleFilled-Ce035z5p.js";import"./Input-CfZxHJYv.js";import"./getAllowClear-CEhEtxYT.js";import"./EyeOutlined-c0yod4UM.js";import"./TextArea-kKKIj_tr.js";import"./DownOutlined-D7IvzF20.js";import"./scrollTo-CLqcVzDY.js";import"./index-Du1U9e5C.js";var fe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372 0-89 31.3-170.8 83.5-234.8l523.3 523.3C682.8 852.7 601 884 512 884zm288.5-137.2L277.2 223.5C341.2 171.3 423 140 512 140c205.4 0 372 166.6 372 372 0 89-31.3 170.8-83.5 234.8z"}}]},name:"stop",theme:"outlined"};function w(){return w=Object.assign?Object.assign.bind():function(n){for(var c=1;c<arguments.length;c++){var i=arguments[c];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},w.apply(this,arguments)}const be=(n,c)=>s.createElement(te,w({},n,{ref:c,icon:fe})),ve=s.forwardRef(be),{TextArea:Ce}=S,{Option:C}=p,M=[{value:"asset",label:"Asset",normalBalance:"debit"},{value:"liability",label:"Liability",normalBalance:"credit"},{value:"equity",label:"Equity",normalBalance:"credit"},{value:"revenue",label:"Revenue",normalBalance:"credit"},{value:"expense",label:"Expense",normalBalance:"debit"}],Se={asset:["Current Asset","Fixed Asset","Intangible Asset","Other Asset"],liability:["Current Liability","Long-term Liability","Other Liability"],equity:["Owner's Equity","Retained Earnings","Capital","Drawings"],revenue:["Operating Revenue","Non-operating Revenue","Other Income"],expense:["Operating Expense","Non-operating Expense","Cost of Goods Sold"]};function je({account:n,parentAccounts:c,onSubmit:i,onCancel:o}){var y;const[m]=d.useForm(),{token:r}=D.useToken(),[u,h]=J.useState((n==null?void 0:n.account_type)||null);s.useEffect(()=>{n?(m.setFieldsValue({...n,is_active:n.is_active??!0}),h(n.account_type)):(m.resetFields(),m.setFieldsValue({is_active:!0}))},[n,m]);const x=l=>{h(l);const f=M.find(j=>j.value===l);f&&m.setFieldValue("normal_balance",f.normalBalance),m.setFieldValue("account_subtype",null)},A=l=>{i(l)};return e.jsxs(d,{form:m,layout:"vertical",onFinish:A,initialValues:{is_active:!0,opening_balance:0},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"account_code",label:"Account Code",rules:[{required:!0,message:"Please enter account code"}],children:e.jsx(S,{placeholder:"e.g., 1000, 1100, 2000",style:{backgroundColor:r.colorBgContainer,color:r.colorText}})}),e.jsx(d.Item,{name:"account_name",label:"Account Name",rules:[{required:!0,message:"Please enter account name"}],children:e.jsx(S,{placeholder:"e.g., Cash, Accounts Receivable",style:{backgroundColor:r.colorBgContainer,color:r.colorText}})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"account_type",label:"Account Type",rules:[{required:!0,message:"Please select account type"}],children:e.jsx(p,{placeholder:"Select type",onChange:x,style:{backgroundColor:r.colorBgContainer},children:M.map(l=>e.jsx(C,{value:l.value,children:l.label},l.value))})}),e.jsx(d.Item,{name:"account_subtype",label:"Account Subtype",children:e.jsx(p,{placeholder:"Select subtype (optional)",disabled:!u,style:{backgroundColor:r.colorBgContainer},allowClear:!0,children:u&&((y=Se[u])==null?void 0:y.map(l=>e.jsx(C,{value:l,children:l},l)))})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"normal_balance",label:"Normal Balance",rules:[{required:!0,message:"Please select normal balance"}],children:e.jsxs(p,{placeholder:"Select normal balance",style:{backgroundColor:r.colorBgContainer},children:[e.jsx(C,{value:"debit",children:"Debit"}),e.jsx(C,{value:"credit",children:"Credit"})]})}),e.jsx(d.Item,{name:"opening_balance",label:"Opening Balance (TZS)",children:e.jsx(re,{style:{width:"100%",backgroundColor:r.colorBgContainer,color:r.colorText},formatter:l=>`${l}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:l=>l.replace(/,/g,""),placeholder:"0.00"})})]}),e.jsx(d.Item,{name:"parent_account_id",label:"Parent Account (Optional)",children:e.jsx(p,{placeholder:"Select parent account",style:{backgroundColor:r.colorBgContainer},allowClear:!0,showSearch:!0,optionFilterProp:"children",children:c==null?void 0:c.map(l=>e.jsxs(C,{value:l.id,children:[l.account_code," - ",l.account_name]},l.id))})}),e.jsx(d.Item,{name:"description",label:"Description",children:e.jsx(Ce,{rows:3,placeholder:"Account description and purpose",style:{backgroundColor:r.colorBgContainer,color:r.colorText}})}),e.jsx(d.Item,{name:"is_active",label:"Active Status",valuePropName:"checked",children:e.jsx(se,{checkedChildren:"Active",unCheckedChildren:"Inactive"})}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"24px"},children:[e.jsx(b,{onClick:o,children:"Cancel"}),e.jsxs(b,{type:"primary",htmlType:"submit",children:[n?"Update":"Create"," Account"]})]})]})}const{Text:ot}=ye,I=[{value:"asset",label:"Asset",color:"blue"},{value:"liability",label:"Liability",color:"red"},{value:"equity",label:"Equity",color:"purple"},{value:"revenue",label:"Revenue",color:"green"},{value:"expense",label:"Expense",color:"orange"}];function rt({accounts:n,parentAccounts:c,filters:i}){D.useToken();const[o,m]=ce.useMessage(),[r,u]=s.useState(!1),[h,x]=s.useState(null),[A,y]=s.useState(!1),[l,f]=s.useState(null),[j,_]=s.useState(""),[k,E]=s.useState(i.search||""),[R,B]=s.useState(i.type||null),[L,q]=s.useState(i.subtype||null),[O,F]=s.useState(i.status||null),P=()=>{g.get("/admin-portal/chart-of-accounts",{search:k,type:R,subtype:L,status:O},{preserveState:!0,preserveScroll:!0})},V=()=>{E(""),B(null),q(null),F(null),g.get("/admin-portal/chart-of-accounts",{},{preserveState:!0,preserveScroll:!0})},U=()=>{x(null),u(!0)},z=t=>{x(t),u(!0)},Y=t=>{h?g.put(`/admin-portal/chart-of-accounts/${h.id}`,t,{preserveScroll:!0,onSuccess:()=>{u(!1),x(null),o.success("Account updated successfully")},onError:a=>{console.error("Validation errors:",a),o.error("Failed to update account. Please check the form.")}}):g.post("/admin-portal/chart-of-accounts",t,{preserveScroll:!0,onSuccess:()=>{u(!1),o.success("Account created successfully")},onError:a=>{console.error("Validation errors:",a),o.error("Failed to create account. Please check the form.")}})},G=t=>{f(t),_(""),y(!0)},H=()=>{l&&g.delete(`/admin-portal/chart-of-accounts/${l.id}`,{onSuccess:()=>{y(!1),f(null),_(""),o.success("Account deleted successfully")},onError:t=>{const a=(t==null?void 0:t.message)||"Failed to delete account";o.error(a)}})},Q=t=>{g.post(`/admin-portal/chart-of-accounts/${t.id}/toggle-status`,{},{onSuccess:()=>{const a=t.is_active?"deactivated":"activated";o.success(`Account ${a} successfully`)},onError:a=>{const v=(a==null?void 0:a.message)||"Failed to update account status";o.error(v)}})},W=t=>{const a=I.find(v=>v.value===t);return(a==null?void 0:a.color)||"default"},Z=t=>{const a=I.find(v=>v.value===t);return(a==null?void 0:a.label)||t},K=t=>[{key:"edit",label:"Edit",icon:e.jsx(xe,{}),onClick:()=>z(t),disabled:t.is_system_account},{key:"toggle-status",label:t.is_active?"Deactivate":"Activate",icon:t.is_active?e.jsx(ve,{}):e.jsx(ge,{}),onClick:()=>Q(t),disabled:t.is_system_account},{key:"delete",label:"Delete",icon:e.jsx(me,{}),danger:!0,onClick:()=>G(t),disabled:t.is_system_account}],X=[{title:"Code",dataIndex:"account_code",key:"account_code",width:100,sorter:(t,a)=>t.account_code.localeCompare(a.account_code)},{title:"Account Name",dataIndex:"account_name",key:"account_name",width:220,ellipsis:!0,render:(t,a)=>e.jsxs("div",{children:[e.jsx("div",{children:t}),a.is_system_account&&e.jsx(T,{color:"gold",style:{fontSize:"10px",marginTop:"4px"},children:"SYSTEM"})]})},{title:"Type",dataIndex:"account_type",key:"account_type",width:110,render:t=>e.jsx(T,{color:W(t),children:Z(t).toUpperCase()})},{title:"Subtype",dataIndex:"account_subtype",key:"account_subtype",width:150,ellipsis:!0,render:t=>t||"-"},{title:"Parent Account",dataIndex:"parent_account",key:"parent_account",width:150,ellipsis:!0,render:(t,a)=>a.parent_account?e.jsx(ne,{title:`${a.parent_account.account_code} - ${a.parent_account.account_name}`,children:a.parent_account.account_code}):"-"},{title:"Normal Balance",dataIndex:"normal_balance",key:"normal_balance",width:110,render:t=>e.jsx(T,{color:t==="debit"?"blue":"green",children:t.toUpperCase()})},{title:"Current Balance",dataIndex:"current_balance",key:"current_balance",width:140,align:"right",render:t=>`TZS ${parseFloat(t).toLocaleString()}`},{title:"Status",dataIndex:"is_active",key:"is_active",width:90,render:t=>e.jsx(T,{color:t?"green":"red",children:t?"ACTIVE":"INACTIVE"})},{title:"Actions",key:"actions",width:80,fixed:"right",render:(t,a)=>e.jsx(oe,{menu:{items:K(a)},trigger:["click"],children:e.jsx(b,{type:"text",icon:e.jsx(he,{})})})}];return e.jsxs(e.Fragment,{children:[e.jsx(ee,{title:"Chart of Accounts - Tabata Welfare Association"}),e.jsxs(ae,{children:[m,e.jsxs(ie,{children:[e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px"},children:[e.jsxs(le,{wrap:!0,children:[e.jsx(S,{placeholder:"Search accounts...",prefix:e.jsx(ue,{}),value:k,onChange:t=>E(t.target.value),onPressEnter:P,style:{width:250},allowClear:!0}),e.jsx(p,{placeholder:"Type",value:R,onChange:B,style:{width:130},allowClear:!0,children:I.map(t=>e.jsx(p.Option,{value:t.value,children:t.label},t.value))}),e.jsxs(p,{placeholder:"Status",value:O,onChange:F,style:{width:120},allowClear:!0,children:[e.jsx(p.Option,{value:"active",children:"Active"}),e.jsx(p.Option,{value:"inactive",children:"Inactive"})]}),e.jsx(b,{onClick:P,type:"primary",children:"Search"}),e.jsx(b,{onClick:V,children:"Reset"})]}),e.jsx(b,{type:"primary",icon:e.jsx(de,{}),onClick:U,children:"Add Account"})]}),e.jsx(pe,{columns:X,dataSource:n.data,rowKey:"id",pagination:{current:n.current_page,pageSize:n.per_page,total:n.total,showSizeChanger:!1,showTotal:t=>`Total ${t} accounts`,onChange:t=>{g.get("/admin-portal/chart-of-accounts",{...i,page:t},{preserveState:!0,preserveScroll:!0})}},locale:{emptyText:e.jsx($,{description:"No accounts found",image:$.PRESENTED_IMAGE_SIMPLE})},scroll:{x:1300}})]}),e.jsx(N,{title:h?"Edit Account":"Add New Account",open:r,onCancel:()=>{u(!1),x(null)},footer:null,width:700,styles:{body:{maxHeight:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden",paddingRight:"24px"}},children:e.jsx(je,{account:h,parentAccounts:c,onSubmit:Y,onCancel:()=>{u(!1),x(null)}})}),e.jsxs(N,{title:"Delete Account",open:A,onCancel:()=>{y(!1),f(null),_("")},onOk:H,okText:"Delete",okButtonProps:{danger:!0,disabled:j!==(l==null?void 0:l.account_name)},children:[e.jsxs("p",{children:['Are you sure you want to delete "',l==null?void 0:l.account_name,'"?']}),e.jsx("p",{children:"Type the account name to confirm:"}),e.jsx(S,{value:j,onChange:t=>_(t.target.value),placeholder:"Type account name here"})]})]})]})}export{rt as default};
