import{t as O,r as i,j as e,S as a}from"./app-BCoYgWpy.js";import{A as N,S as I,B as u,D as U}from"./AdminSidebarLayout-DNChDxSB.js";import{s as L}from"./index-BrLv-dAc.js";import{F as x}from"./index-DI36EE_o.js";import{C as q,R as G}from"./index-sjOIDGU-.js";import{I as h}from"./index-FAD_XdFo.js";import{R as H}from"./useIcons-DvOyxxY9.js";import{F as K}from"./Table-vIq5QbJH.js";import{E as P}from"./index-DLbe-hQ7.js";import{M as E,R as V}from"./index-DgKfZZJz.js";import{R as W}from"./KeyOutlined-CdU-hYG4.js";import{T as Z}from"./index-BLkqHKOC.js";import{B as J}from"./index-Cl56zeFa.js";import{R as Q}from"./MoreOutlined-BuyOgnSF.js";import{R as X}from"./EditOutlined-B9fMtCwG.js";import"./SessionTimeout-BSdDJ2Oa.js";import"./Modal-BszroB66.js";import"./transition-CN7I8a8f.js";import"./PrimaryButton-CfU57GbV.js";import"./SecondaryButton-BtrCzkae.js";import"./CheckCircleFilled-DuKIAkof.js";import"./InfoCircleFilled-BB_XiD_I.js";import"./CSSMotionList-D0-oo0HB.js";import"./useForm-DTPPr3dT.js";import"./row-DvslNah_.js";import"./Input-CgSciwW_.js";import"./getAllowClear-D2seDeQM.js";import"./EyeOutlined-vMzgx86n.js";import"./TextArea-D136Oc2B.js";import"./DownOutlined-CEBftIuV.js";import"./index-D7Cm7sns.js";import"./scrollTo-BdSh8p5n.js";import"./index-CfrNP3w0.js";const{Text:Y}=Z,{TextArea:ee}=h;function be({permissions:c,filters:j}){const{token:R}=O.useToken(),[n,T]=L.useMessage(),[v,l]=i.useState(!1),[m,d]=i.useState(null),[F,f]=i.useState(!1),[r,g]=i.useState(null),[S,p]=i.useState(""),[o]=x.useForm(),[C,w]=i.useState(j.search||""),k=()=>{a.get("/admin-portal/permissions",{search:C},{preserveState:!0,preserveScroll:!0})},M=()=>{w(""),a.get("/admin-portal/permissions",{},{preserveState:!0,preserveScroll:!0})},A=()=>{d(null),o.resetFields(),l(!0)},_=s=>{d(s),o.setFieldsValue({name:s.name,description:s.description}),l(!0)},b=()=>{o.validateFields().then(s=>{m?a.put(`/admin-portal/permissions/${m.id}`,s,{preserveScroll:!0,onSuccess:()=>{l(!1),d(null),o.resetFields(),n.success("Permission updated successfully")},onError:t=>{const y=(t==null?void 0:t.message)||"Failed to update permission";n.error(y)}}):a.post("/admin-portal/permissions",s,{preserveScroll:!0,onSuccess:()=>{l(!1),o.resetFields(),n.success("Permission created successfully")},onError:t=>{const y=(t==null?void 0:t.message)||"Failed to create permission";n.error(y)}})})},D=s=>{g(s),p(""),f(!0)},z=()=>{r&&a.delete(`/admin-portal/permissions/${r.id}`,{onSuccess:()=>{f(!1),g(null),p(""),n.success("Permission deleted successfully")},onError:s=>{const t=(s==null?void 0:s.message)||"Failed to delete permission";n.error(t)}})},$=s=>[{key:"edit",label:"Edit",icon:e.jsx(X,{}),onClick:()=>_(s)},{key:"delete",label:"Delete",icon:e.jsx(V,{}),danger:!0,onClick:()=>D(s)}],B=[{title:"Permission Name",dataIndex:"name",key:"name",width:220,render:s=>e.jsxs(I,{children:[e.jsx(W,{style:{fontSize:"14px"}}),e.jsx(Y,{strong:!0,style:{fontSize:"13px"},children:s})]})},{title:"Description",dataIndex:"description",key:"description",ellipsis:!0,render:s=>e.jsx("span",{style:{fontSize:"13px"},children:s||"-"})},{title:"Assigned Roles",dataIndex:"roles_count",key:"roles_count",width:130,align:"center",render:s=>e.jsx(J,{count:s,showZero:!0,style:{backgroundColor:R.colorPrimary},overflowCount:999})},{title:"Actions",key:"actions",width:70,fixed:"right",render:(s,t)=>e.jsx(U,{menu:{items:$(t)},trigger:["click"],children:e.jsx(u,{type:"text",size:"small",icon:e.jsx(Q,{})})})}];return e.jsxs(N,{children:[T,e.jsxs(q,{children:[e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px"},children:[e.jsxs(I,{wrap:!0,children:[e.jsx(h,{placeholder:"Search permissions...",prefix:e.jsx(H,{}),value:C,onChange:s=>w(s.target.value),onPressEnter:k,style:{width:250},allowClear:!0}),e.jsx(u,{onClick:k,type:"primary",children:"Search"}),e.jsx(u,{onClick:M,children:"Reset"})]}),e.jsx(u,{type:"primary",icon:e.jsx(G,{}),onClick:A,children:"Add Permission"})]}),e.jsx(K,{columns:B,dataSource:c.data,rowKey:"id",size:"small",pagination:{current:c.current_page,pageSize:c.per_page,total:c.total,showSizeChanger:!1,showTotal:s=>e.jsxs("span",{style:{fontSize:"13px"},children:["Total ",s," permissions"]}),onChange:s=>{a.get("/admin-portal/permissions",{...j,page:s},{preserveState:!0,preserveScroll:!0})}},locale:{emptyText:e.jsx(P,{description:"No permissions found",image:P.PRESENTED_IMAGE_SIMPLE})}})]}),e.jsx(E,{title:m?"Edit Permission":"Add New Permission",open:v,onCancel:()=>{l(!1),d(null),o.resetFields()},onOk:b,okText:m?"Update":"Create",width:600,children:e.jsxs(x,{form:o,layout:"vertical",style:{marginTop:"24px"},children:[e.jsx(x.Item,{label:"Permission Name",name:"name",rules:[{required:!0,message:"Please enter permission name"},{pattern:/^[a-z_]+$/,message:"Use lowercase with underscores only (e.g., manage_users)"}],extra:"Use lowercase letters and underscores only (e.g., manage_users)",children:e.jsx(h,{placeholder:"e.g., manage_users"})}),e.jsx(x.Item,{label:"Description",name:"description",children:e.jsx(ee,{rows:3,placeholder:"Brief description of this permission"})})]})}),e.jsxs(E,{title:"Delete Permission",open:F,onCancel:()=>{f(!1),g(null),p("")},onOk:z,okText:"Delete",okButtonProps:{danger:!0,disabled:S!==(r==null?void 0:r.name)},children:[e.jsxs("p",{children:['Are you sure you want to delete permission "',r==null?void 0:r.name,'"?']}),e.jsx("p",{children:"Type the permission name to confirm:"}),e.jsx(h,{value:S,onChange:s=>p(s.target.value),placeholder:"Type permission name here"})]})]})}export{be as default};
