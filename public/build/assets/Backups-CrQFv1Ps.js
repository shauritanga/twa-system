import{r,j as e}from"./app-CCWscn4N.js";import{S as z,F as h}from"./SidebarLayout-D4nqS7b6.js";import{F as H}from"./ClockIcon-DeeQpFHg.js";import{F as p}from"./DocumentDuplicateIcon-CLLTadgE.js";import{F as K}from"./CheckCircleIcon-Ba1qBm0g.js";import{F as b}from"./ExclamationTriangleIcon-ChxHdgS_.js";import{F as T}from"./TrashIcon-DME0PLII.js";import"./SessionTimeout-72mUHhjZ.js";import"./Modal-CTkSowC8.js";import"./transition-BcOJrHw_.js";import"./PrimaryButton-0XQdD5oU.js";import"./SecondaryButton-DbLXN_Wj.js";function X({title:d,titleId:n,...l},i){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":n},l),d?r.createElement("title",{id:n},d):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9.75v6.75m0 0-3-3m3 3 3-3m-8.25 6a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z"}))}const I=r.forwardRef(X);function P({title:d,titleId:n,...l},i){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":n},l),d?r.createElement("title",{id:n},d):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 17.25v-.228a4.5 4.5 0 0 0-.12-1.03l-2.268-9.64a3.375 3.375 0 0 0-3.285-2.602H7.923a3.375 3.375 0 0 0-3.285 2.602l-2.268 9.64a4.5 4.5 0 0 0-.12 1.03v.228m19.5 0a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3m19.5 0a3 3 0 0 0-3-3H5.25a3 3 0 0 0-3 3m16.5 0h.008v.008h-.008v-.008Zm-3 0h.008v.008h-.008v-.008Z"}))}const Z=r.forwardRef(P);function ne({backups:d,settings:n}){const[l,i]=r.useState(d||[]),[f,y]=r.useState(!1),[k,w]=r.useState(!1),[o,j]=r.useState(!1),[N,v]=r.useState(""),[C,R]=r.useState("success"),[E,x]=r.useState(!1),[O,m]=r.useState(!1),[F,g]=r.useState(null),s=(a,t="success")=>{v(a),R(t),setTimeout(()=>v(""),5e3)},c=async()=>{try{const t=await(await fetch("/admin/backups/list")).json();t.success&&i(t.backups)}catch(a){console.error("Failed to refresh backups:",a)}},S=async()=>{y(!0);try{const t=await(await fetch("/admin/backups/create",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).json();t.success?(s(t.message,"success"),await c()):s(t.message,"error")}catch{s("Failed to create backup","error")}finally{y(!1)}},$=async()=>{w(!0);try{const t=await(await fetch("/admin/backups/create-database",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).json();t.success?(s(t.message,"success"),await c()):s(t.message,"error")}catch{s("Failed to create database backup","error")}finally{w(!1)}},A=a=>{g(a),x(!0)},M=async()=>{try{const t=await(await fetch(`/admin/backups/${F}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).json();t.success?(s(t.message,"success"),await c()):s(t.message,"error")}catch{s("Failed to delete backup","error")}finally{x(!1),g(null)}},L=()=>{m(!0)},_=async()=>{j(!0);try{const t=await(await fetch("/admin/backups/clean",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).json();t.success?(s(t.message,"success"),await c()):s(t.message,"error")}catch{s("Failed to clean old backups","error")}finally{j(!1),m(!1)}},q=a=>{window.location.href=`/admin/backups/download/${a}`};return e.jsx(z,{children:e.jsxs("div",{className:"p-6 w-full",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Backup Management"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Create, manage, and download system backups"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("div",{className:`px-4 py-2 rounded-lg text-sm font-medium border ${n.auto_backup_enabled?"bg-green-50 text-green-700 border-green-200 dark:bg-green-900/20 dark:text-green-400 dark:border-green-800":"bg-gray-50 text-gray-700 border-gray-200 dark:bg-gray-900/20 dark:text-gray-400 dark:border-gray-700"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-2 h-2 rounded-full mr-2 ${n.auto_backup_enabled?"bg-green-500":"bg-gray-400"}`}),"Auto Backup: ",n.auto_backup_enabled?"Enabled":"Disabled"]})}),e.jsx("div",{className:"px-4 py-2 rounded-lg text-sm font-medium bg-blue-50 text-blue-700 border border-blue-200 dark:bg-blue-900/20 dark:text-blue-400 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Frequency: ",n.backup_frequency]})}),e.jsx("div",{className:"px-4 py-2 rounded-lg text-sm font-medium bg-purple-50 text-purple-700 border border-purple-200 dark:bg-purple-900/20 dark:text-purple-400 dark:border-purple-800",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"Total Backups: ",l.length]})})]})]})}),N&&e.jsx("div",{className:`mb-6 p-4 rounded-lg border ${C==="success"?"bg-green-50 border-green-200 text-green-700 dark:bg-green-900/20 dark:border-green-800 dark:text-green-400":"bg-red-50 border-red-200 text-red-700 dark:bg-red-900/20 dark:border-red-800 dark:text-red-400"}`,children:e.jsxs("div",{className:"flex items-center",children:[C==="success"?e.jsx(K,{className:"w-5 h-5 mr-2"}):e.jsx(b,{className:"w-5 h-5 mr-2"}),N]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsx("button",{onClick:S,disabled:f,className:"flex items-center justify-center px-6 py-4 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 disabled:from-gray-400 disabled:to-gray-500 text-white font-medium rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 disabled:cursor-not-allowed",children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"w-5 h-5 mr-2"}),"Full Backup"]})}),e.jsx("button",{onClick:$,disabled:k,className:"flex items-center justify-center px-6 py-4 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 disabled:from-gray-400 disabled:to-gray-500 text-white font-medium rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 disabled:cursor-not-allowed",children:k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-5 h-5 mr-2"}),"Database Only"]})}),e.jsx("button",{onClick:L,disabled:o,className:"flex items-center justify-center px-6 py-4 bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 disabled:from-gray-400 disabled:to-gray-500 text-white font-medium rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 disabled:cursor-not-allowed",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Cleaning..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-5 h-5 mr-2"}),"Clean Old"]})}),e.jsxs("button",{onClick:c,className:"flex items-center justify-center px-6 py-4 bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-medium rounded-lg shadow-lg hover:shadow-xl transition-all duration-200",children:[e.jsx(p,{className:"w-5 h-5 mr-2"}),"Refresh List"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Available Backups"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 text-sm mt-1",children:[l.length," backup",l.length!==1?"s":""," available"]})]}),l.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(h,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No backups found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Create your first backup to get started"}),e.jsxs("button",{onClick:S,className:"inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200",children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"Create Backup"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full min-w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Filename"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Size"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Created Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Created Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Age"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:l.map((a,t)=>{const u=new Date(a.created_at),B=a.filename.includes("database")?"Database":"Full System",D=Date.now()-u.getTime()<24*60*60*1e3;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-150",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{className:"w-5 h-5 text-gray-400 mr-3 flex-shrink-0"}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white truncate block",children:a.filename})})]})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${B==="Database"?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400":"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400"}`,children:B})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:a.size}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:u.toLocaleDateString()}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:u.toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:a.age}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${D?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400":"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-400"}`,children:D?"Recent":"Archived"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsxs("button",{onClick:()=>q(a.filename),className:"inline-flex items-center px-3 py-1.5 bg-blue-100 hover:bg-blue-200 dark:bg-blue-900/20 dark:hover:bg-blue-900/40 text-blue-700 dark:text-blue-400 text-xs font-medium rounded-md transition-colors duration-200",title:"Download backup",children:[e.jsx(I,{className:"w-4 h-4 mr-1"}),"Download"]}),e.jsxs("button",{onClick:()=>A(a.filename),className:"inline-flex items-center px-3 py-1.5 bg-red-100 hover:bg-red-200 dark:bg-red-900/20 dark:hover:bg-red-900/40 text-red-700 dark:text-red-400 text-xs font-medium rounded-md transition-colors duration-200",title:"Delete backup",children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),"Delete"]})]})})]},t)})})]})})]}),E&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-red-100 dark:bg-red-900/20 rounded-full flex items-center justify-center",children:e.jsx(b,{className:"w-6 h-6 text-red-600 dark:text-red-400"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Delete Backup"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"This action cannot be undone"})]})]}),e.jsxs("p",{className:"text-gray-700 dark:text-gray-300 mb-6",children:["Are you sure you want to delete the backup file ",e.jsx("strong",{children:F}),"? This action cannot be undone and the backup will be permanently removed."]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{x(!1),g(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors duration-200",children:"Cancel"}),e.jsx("button",{onClick:M,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-lg transition-colors duration-200",children:"Delete Backup"})]})]})})}),O&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-orange-100 dark:bg-orange-900/20 rounded-full flex items-center justify-center",children:e.jsx(b,{className:"w-6 h-6 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Clean Old Backups"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Remove expired backup files"})]})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-6",children:"This will permanently delete all backup files that exceed the retention period configured in your backup settings. This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>m(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors duration-200",children:"Cancel"}),e.jsx("button",{onClick:_,disabled:o,className:"px-4 py-2 text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 rounded-lg transition-colors duration-200 disabled:cursor-not-allowed",children:o?"Cleaning...":"Clean Old Backups"})]})]})})})]})})}export{ne as default};
