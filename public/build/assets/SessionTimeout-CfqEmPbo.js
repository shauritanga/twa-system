import{r,j as e}from"./app-D2e3E3XV.js";import{M as v}from"./Modal-J3vqZBmM.js";import{P as k}from"./PrimaryButton-CAxNNQMa.js";import{S}from"./SecondaryButton-DEXX7yh7.js";function b({enabled:o=!0}){const[a,d]=r.useState(!1),[c,l]=r.useState(0),[u,g]=r.useState(15),[x,h]=r.useState(!1),w=r.useCallback(s=>{const t=Math.floor(s/60),n=s%60;return t>0?`${t}:${n.toString().padStart(2,"0")}`:`${n}s`},[]),m=r.useCallback(async()=>{var s;if(o)try{const t=await fetch(route("session.warning"),{method:"GET",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content")},credentials:"same-origin"});if(t.ok){const n=await t.json();n.show_warning&&(d(!0),l(n.remaining_seconds),g(n.timeout_minutes))}else t.status===401&&(window.location.href="/")}catch(t){console.error("Error checking session warning:",t)}},[o]),y=async()=>{var s;h(!0);try{const t=await fetch(route("session.extend"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content")},credentials:"same-origin"});if(t.ok){const n=await t.json();n.success&&(d(!1),l(n.new_remaining_seconds))}else t.status===401&&(window.location.href="/")}catch(t){console.error("Error extending session:",t)}finally{h(!1)}},j=()=>{window.location.href=route("logout.alt")};return r.useEffect(()=>{if(!a||c<=0)return;const s=setInterval(()=>{l(t=>{const n=t-1;return n<=0?(window.location.href=route("logout.alt"),0):n})},1e3);return()=>clearInterval(s)},[a,c]),r.useEffect(()=>{if(!o)return;m();const s=setInterval(m,3e4);return()=>clearInterval(s)},[o,m]),r.useEffect(()=>{if(!o)return;const s=["mousedown","mousemove","keypress","scroll","touchstart","click"];let t=Date.now();const n=()=>{var f;const i=Date.now();i-t>3e4&&(t=i,fetch(route("session.heartbeat"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":(f=document.querySelector('meta[name="csrf-token"]'))==null?void 0:f.getAttribute("content")},credentials:"same-origin"}).catch(p=>{console.error("Error sending heartbeat:",p)}))};return s.forEach(i=>{document.addEventListener(i,n,!0)}),()=>{s.forEach(i=>{document.removeEventListener(i,n,!0)})}},[o]),!o||!a?null:e.jsx(v,{show:a,onClose:()=>{},maxWidth:"md",closeable:!1,children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-8 w-8 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Session Timeout Warning"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Your session will expire due to inactivity. You will be automatically logged out in:"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-red-100 dark:bg-red-900/20 rounded-full mb-2",children:e.jsx("span",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:w(c)})}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Session timeout: ",u," minutes of inactivity"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between space-x-4",children:[e.jsx(S,{onClick:j,className:"flex-1",children:"Logout Now"}),e.jsx(k,{onClick:y,disabled:x,className:"flex-1",children:x?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Extending..."]}):"Stay Logged In"})]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:['Click "Stay Logged In" to extend your session by another ',u," minutes."]})})]})})}export{b as S};
