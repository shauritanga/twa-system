import{r as i,t as K,j as e,Q as L,S as u}from"./app-D2e3E3XV.js";import{I as C,A as Q,C as d,S as I,B as f,R as W,D as G}from"./AdminSidebarLayout-COqDSJm5.js";import{s as N}from"./index-BCmZvyIU.js";import{R as Z,C as h}from"./row-C-LMzcQh.js";import{S as x}from"./index-Vi_lAG7p.js";import{A as J}from"./index-Dv79h3uU.js";import{F as U}from"./Table-BwkSv8cC.js";import{M as D,R as X}from"./index-DsYq67bJ.js";import{I as Y}from"./index-BvjKgjyF.js";import{R as ee}from"./ExclamationCircleOutlined-JAQupyzN.js";import{R as te}from"./MoreOutlined-DoUi7suo.js";import{R as ae}from"./DownloadOutlined-CK9diUBp.js";import"./SessionTimeout-CfqEmPbo.js";import"./Modal-J3vqZBmM.js";import"./transition-BB8nYaSI.js";import"./PrimaryButton-CAxNNQMa.js";import"./SecondaryButton-DEXX7yh7.js";import"./CheckCircleFilled-BiH3Zm4C.js";import"./InfoCircleFilled-bVzp4Yp4.js";import"./CSSMotionList-1BX_Nue5.js";import"./index-dQJIm9ox.js";import"./index-DD8aZ74l.js";import"./useIcons-Bk-sqBIx.js";import"./getAllowClear-BoT9aE4f.js";import"./DownOutlined-D3g4QtBj.js";import"./useForm-D6sLoAH1.js";import"./index-B8k0MQXY.js";import"./Input-xs5RiVsA.js";import"./EyeOutlined-ByHKmIV0.js";import"./TextArea-Ba86vcsD.js";var se={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M899.1 869.6l-53-305.6H864c14.4 0 26-11.6 26-26V346c0-14.4-11.6-26-26-26H618V138c0-14.4-11.6-26-26-26H432c-14.4 0-26 11.6-26 26v182H160c-14.4 0-26 11.6-26 26v192c0 14.4 11.6 26 26 26h17.9l-53 305.6a25.95 25.95 0 0025.6 30.4h723c1.5 0 3-.1 4.4-.4a25.88 25.88 0 0021.2-30zM204 390h272V182h72v208h272v104H204V390zm468 440V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H416V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H202.8l45.1-260H776l45.1 260H672z"}}]},name:"clear",theme:"outlined"};function k(){return k=Object.assign?Object.assign.bind():function(n){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(n[a]=r[a])}return n},k.apply(this,arguments)}const ne=(n,s)=>i.createElement(C,k({},n,{ref:s,icon:se})),oe=i.forwardRef(ne);var re={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M624 706.3h-74.1V464c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v242.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.7a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-download",theme:"outlined"};function w(){return w=Object.assign?Object.assign.bind():function(n){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(n[a]=r[a])}return n},w.apply(this,arguments)}const le=(n,s)=>i.createElement(C,w({},n,{ref:s,icon:re})),ie=i.forwardRef(le);var ce={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-600 72h560v208H232V136zm560 480H232V408h560v208zm0 272H232V680h560v208zM304 240a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"database",theme:"outlined"};function v(){return v=Object.assign?Object.assign.bind():function(n){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(n[a]=r[a])}return n},v.apply(this,arguments)}const de=(n,s)=>i.createElement(C,v({},n,{ref:s,icon:ce})),R=i.forwardRef(de);function Pe({backups:n,settings:s}){const{token:r}=K.useToken(),[a,H]=N.useMessage(),[z,p]=i.useState(!1),[M,g]=i.useState(!1),[c,j]=i.useState(null),[S,m]=i.useState(""),T=()=>{p(!0),a.loading("Creating backup...",0),window.axios.post("/admin-portal/backups/create").then(t=>{a.destroy(),a.success(t.data.message),u.reload({only:["backups"]})}).catch(t=>{var o,l;a.destroy(),a.error(((l=(o=t.response)==null?void 0:o.data)==null?void 0:l.message)||"Failed to create backup")}).finally(()=>{p(!1)})},$=()=>{p(!0),a.loading("Creating database backup...",0),window.axios.post("/admin-portal/backups/create-database").then(t=>{a.destroy(),a.success(t.data.message),u.reload({only:["backups"]})}).catch(t=>{var o,l;a.destroy(),a.error(((l=(o=t.response)==null?void 0:o.data)==null?void 0:l.message)||"Failed to create database backup")}).finally(()=>{p(!1)})},F=t=>{window.location.href=`/admin-portal/backups/download/${t}`,a.success("Downloading backup...")},A=t=>{j(t),m(""),g(!0)},V=()=>{c&&window.axios.delete(`/admin-portal/backups/${c.filename}`).then(t=>{a.success(t.data.message),g(!1),j(null),m(""),u.reload({only:["backups"]})}).catch(t=>{var o,l;a.error(((l=(o=t.response)==null?void 0:o.data)==null?void 0:l.message)||"Failed to delete backup")})},_=()=>{D.confirm({title:"Clean Old Backups",icon:e.jsx(ee,{}),content:"This will delete all backups older than the retention period. Continue?",okText:"Clean",okType:"danger",onOk(){return window.axios.post("/admin-portal/backups/clean").then(t=>{a.success(t.data.message),u.reload({only:["backups"]})}).catch(t=>{var o,l;a.error(((l=(o=t.response)==null?void 0:o.data)==null?void 0:l.message)||"Failed to clean backups")})}})},E=t=>[{key:"download",label:"Download",icon:e.jsx(ae,{}),onClick:()=>F(t.filename)},{key:"delete",label:"Delete",icon:e.jsx(X,{}),danger:!0,onClick:()=>A(t)}],P=[{title:"Filename",dataIndex:"filename",key:"filename",ellipsis:!0,render:t=>e.jsx("span",{style:{fontSize:"13px",fontFamily:"monospace"},children:t})},{title:"Size",dataIndex:"size",key:"size",width:120,render:t=>e.jsx("span",{style:{fontSize:"13px"},children:t})},{title:"Created",dataIndex:"age",key:"age",width:150,render:t=>e.jsx("span",{style:{fontSize:"13px"},children:t})},{title:"Actions",key:"actions",width:70,fixed:"right",render:(t,o)=>e.jsx(G,{menu:{items:E(o)},trigger:["click"],children:e.jsx(f,{type:"text",size:"small",icon:e.jsx(te,{})})})}],q=n.reduce((t,o)=>{var B;const l=o.size.match(/[\d.]+/),b=l?parseFloat(l[0]):0,O=(B=o.size.match(/[A-Z]+/))==null?void 0:B[0];let y=b;return O==="GB"&&(y=b*1024),O==="KB"&&(y=b/1024),t+y},0);return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:"Backup Management - Tabata Welfare Association"}),e.jsxs(Q,{children:[H,e.jsxs(Z,{gutter:16,style:{marginBottom:24},children:[e.jsx(h,{xs:24,sm:12,lg:6,children:e.jsx(d,{children:e.jsx(x,{title:"Total Backups",value:n.length,prefix:e.jsx(ie,{})})})}),e.jsx(h,{xs:24,sm:12,lg:6,children:e.jsx(d,{children:e.jsx(x,{title:"Total Size",value:q.toFixed(2),suffix:"MB",prefix:e.jsx(R,{})})})}),e.jsx(h,{xs:24,sm:12,lg:6,children:e.jsx(d,{children:e.jsx(x,{title:"Auto Backup",value:s.auto_backup_enabled?"Enabled":"Disabled",valueStyle:{fontSize:"20px",color:s.auto_backup_enabled?r.colorSuccess:r.colorTextSecondary}})})}),e.jsx(h,{xs:24,sm:12,lg:6,children:e.jsx(d,{children:e.jsx(x,{title:"Frequency",value:s.backup_frequency,valueStyle:{fontSize:"20px",textTransform:"capitalize"}})})})]}),e.jsx(J,{message:"Backup Information",description:"Backups include your database and important files. Database-only backups are faster and smaller. Download backups regularly and store them securely.",type:"info",showIcon:!0,closable:!0,style:{marginBottom:24}}),e.jsxs(d,{children:[e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px"},children:[e.jsx(I,{wrap:!0,children:e.jsx(f,{icon:e.jsx(oe,{}),onClick:_,disabled:n.length===0,children:"Clean Old"})}),e.jsxs(I,{wrap:!0,children:[e.jsx(f,{type:"default",icon:e.jsx(R,{}),onClick:$,loading:z,children:"Database Only"}),e.jsx(f,{type:"primary",icon:e.jsx(W,{}),onClick:T,loading:z,children:"Full Backup"})]})]}),e.jsx(U,{columns:P,dataSource:n,rowKey:"filename",size:"small",pagination:{pageSize:10,showSizeChanger:!1,showTotal:t=>e.jsxs("span",{style:{fontSize:"13px"},children:["Total ",t," backups"]})},locale:{emptyText:"No backups found. Create your first backup to get started."}})]}),e.jsxs(D,{title:"Delete Backup",open:M,onCancel:()=>{g(!1),j(null),m("")},onOk:V,okText:"Delete",okButtonProps:{danger:!0,disabled:S!==(c==null?void 0:c.filename)},children:[e.jsx("p",{children:"Are you sure you want to delete this backup?"}),e.jsx("p",{children:e.jsx("strong",{children:c==null?void 0:c.filename})}),e.jsx("p",{children:"Type the filename to confirm:"}),e.jsx(Y,{value:S,onChange:t=>m(t.target.value),placeholder:"Type filename here"})]})]})]})}export{Pe as default};
