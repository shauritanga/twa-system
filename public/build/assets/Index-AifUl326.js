import{a as O,r as i,j as e,S as a}from"./app-CCWscn4N.js";import{A as N,C as U,S as I,B as u,c as L,D as q}from"./AdminSidebarLayout-BHFbP-0Z.js";import{s as G}from"./index-BhyvampS.js";import{F as x}from"./index-C7rJnUG_.js";import{I as h}from"./index-BFcOIicW.js";import{R as H}from"./useIcons-Bh5YfX0K.js";import{F as K}from"./Table-DUVIRzZL.js";import{E as P}from"./index-CdwOtgdH.js";import{M as E}from"./index-BhSHgn0Z.js";import{R as V}from"./KeyOutlined-B5jQXFV0.js";import{T as W}from"./index-iEk3Z0oW.js";import{B as Z}from"./index-D1VSToI4.js";import{R as J}from"./MoreOutlined-D2Cbkv-l.js";import{R as Q}from"./EditOutlined-BgapihRa.js";import{R as X}from"./DeleteOutlined-S1oeFgow.js";import"./SessionTimeout-72mUHhjZ.js";import"./Modal-CTkSowC8.js";import"./transition-BcOJrHw_.js";import"./PrimaryButton-0XQdD5oU.js";import"./SecondaryButton-DbLXN_Wj.js";import"./CheckCircleFilled-B-8ZM7Vi.js";import"./InfoCircleFilled-BBeUonew.js";import"./CSSMotionList-CEJCmY9t.js";import"./useForm-CpR6UdBL.js";import"./row-BLaRi8TG.js";import"./Input-Br3Lt1rS.js";import"./getAllowClear-ggc3xdDv.js";import"./EyeOutlined-BXjcMdGf.js";import"./TextArea-n8YGhIra.js";import"./DownOutlined-B9GtLQuW.js";import"./index-C-HA1eIq.js";import"./index-5hnhc-Y9.js";const{Text:Y}=W,{TextArea:ee}=h;function _e({permissions:c,filters:j}){const{token:T}=O.useToken(),[n,R]=G.useMessage(),[v,l]=i.useState(!1),[m,d]=i.useState(null),[F,f]=i.useState(!1),[r,g]=i.useState(null),[S,p]=i.useState(""),[o]=x.useForm(),[C,w]=i.useState(j.search||""),k=()=>{a.get("/admin-portal/permissions",{search:C},{preserveState:!0,preserveScroll:!0})},M=()=>{w(""),a.get("/admin-portal/permissions",{},{preserveState:!0,preserveScroll:!0})},A=()=>{d(null),o.resetFields(),l(!0)},_=s=>{d(s),o.setFieldsValue({name:s.name,description:s.description}),l(!0)},b=()=>{o.validateFields().then(s=>{m?a.put(`/admin-portal/permissions/${m.id}`,s,{preserveScroll:!0,onSuccess:()=>{l(!1),d(null),o.resetFields(),n.success("Permission updated successfully")},onError:t=>{const y=(t==null?void 0:t.message)||"Failed to update permission";n.error(y)}}):a.post("/admin-portal/permissions",s,{preserveScroll:!0,onSuccess:()=>{l(!1),o.resetFields(),n.success("Permission created successfully")},onError:t=>{const y=(t==null?void 0:t.message)||"Failed to create permission";n.error(y)}})})},D=s=>{g(s),p(""),f(!0)},z=()=>{r&&a.delete(`/admin-portal/permissions/${r.id}`,{onSuccess:()=>{f(!1),g(null),p(""),n.success("Permission deleted successfully")},onError:s=>{const t=(s==null?void 0:s.message)||"Failed to delete permission";n.error(t)}})},$=s=>[{key:"edit",label:"Edit",icon:e.jsx(Q,{}),onClick:()=>_(s)},{key:"delete",label:"Delete",icon:e.jsx(X,{}),danger:!0,onClick:()=>D(s)}],B=[{title:"Permission Name",dataIndex:"name",key:"name",width:220,render:s=>e.jsxs(I,{children:[e.jsx(V,{style:{fontSize:"14px"}}),e.jsx(Y,{strong:!0,style:{fontSize:"13px"},children:s})]})},{title:"Description",dataIndex:"description",key:"description",ellipsis:!0,render:s=>e.jsx("span",{style:{fontSize:"13px"},children:s||"-"})},{title:"Assigned Roles",dataIndex:"roles_count",key:"roles_count",width:130,align:"center",render:s=>e.jsx(Z,{count:s,showZero:!0,style:{backgroundColor:T.colorPrimary},overflowCount:999})},{title:"Actions",key:"actions",width:70,fixed:"right",render:(s,t)=>e.jsx(q,{menu:{items:$(t)},trigger:["click"],children:e.jsx(u,{type:"text",size:"small",icon:e.jsx(J,{})})})}];return e.jsxs(N,{children:[R,e.jsxs(U,{children:[e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px"},children:[e.jsxs(I,{wrap:!0,children:[e.jsx(h,{placeholder:"Search permissions...",prefix:e.jsx(H,{}),value:C,onChange:s=>w(s.target.value),onPressEnter:k,style:{width:250},allowClear:!0}),e.jsx(u,{onClick:k,type:"primary",children:"Search"}),e.jsx(u,{onClick:M,children:"Reset"})]}),e.jsx(u,{type:"primary",icon:e.jsx(L,{}),onClick:A,children:"Add Permission"})]}),e.jsx(K,{columns:B,dataSource:c.data,rowKey:"id",size:"small",pagination:{current:c.current_page,pageSize:c.per_page,total:c.total,showSizeChanger:!1,showTotal:s=>e.jsxs("span",{style:{fontSize:"13px"},children:["Total ",s," permissions"]}),onChange:s=>{a.get("/admin-portal/permissions",{...j,page:s},{preserveState:!0,preserveScroll:!0})}},locale:{emptyText:e.jsx(P,{description:"No permissions found",image:P.PRESENTED_IMAGE_SIMPLE})}})]}),e.jsx(E,{title:m?"Edit Permission":"Add New Permission",open:v,onCancel:()=>{l(!1),d(null),o.resetFields()},onOk:b,okText:m?"Update":"Create",width:600,children:e.jsxs(x,{form:o,layout:"vertical",style:{marginTop:"24px"},children:[e.jsx(x.Item,{label:"Permission Name",name:"name",rules:[{required:!0,message:"Please enter permission name"},{pattern:/^[a-z_]+$/,message:"Use lowercase with underscores only (e.g., manage_users)"}],extra:"Use lowercase letters and underscores only (e.g., manage_users)",children:e.jsx(h,{placeholder:"e.g., manage_users"})}),e.jsx(x.Item,{label:"Description",name:"description",children:e.jsx(ee,{rows:3,placeholder:"Brief description of this permission"})})]})}),e.jsxs(E,{title:"Delete Permission",open:F,onCancel:()=>{f(!1),g(null),p("")},onOk:z,okText:"Delete",okButtonProps:{danger:!0,disabled:S!==(r==null?void 0:r.name)},children:[e.jsxs("p",{children:['Are you sure you want to delete permission "',r==null?void 0:r.name,'"?']}),e.jsx("p",{children:"Type the permission name to confirm:"}),e.jsx(h,{value:S,onChange:s=>p(s.target.value),placeholder:"Type permission name here"})]})]})}export{_e as default};
