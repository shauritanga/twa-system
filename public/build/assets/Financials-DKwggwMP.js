import{d as ee,f as Oe,g as He,e as Pe,r as h,h as ie,c as T,R as C,k as ze,l as qe,m as Ge,n as We,J as Me,j as o,a as Xe,S as J}from"./app-CCWscn4N.js";import{r as Q,f as Ve,m as Ze,s as Ke,t as Ue,l as Ne,k as Fe,v as Je,j as De,w as ae,x as Qe,y as et,z as Se,E as tt,F as ot,G as nt,S as te,n as st,H as at,J as rt,B as Y,c as ne,C as H,A as it,T as lt}from"./AdminSidebarLayout-BHFbP-0Z.js";import{d as Z}from"./dayjs.min-Be2yCFt4.js";import{F as w}from"./index-C7rJnUG_.js";import{M as he}from"./index-BhSHgn0Z.js";import{A as fe}from"./index-CijJxMn4.js";import{R as ct}from"./InfoCircleOutlined-BEo2mVkY.js";import{I as q}from"./index-BFcOIicW.js";import{S as A}from"./index-C-HA1eIq.js";import{T as ge}from"./index-Djf7ccgm.js";import{D as be}from"./index-D2nthcHU.js";import{N as dt,u as mt,a as ut,A as pt,s as O}from"./index-BhyvampS.js";import{R as ft}from"./CheckCircleFilled-B-8ZM7Vi.js";import{R as ht,a as gt}from"./InfoCircleFilled-BBeUonew.js";import{R as Ee}from"./CheckCircleOutlined-jfc3C_4A.js";import{R as bt}from"./ExclamationCircleOutlined-CTyvqMsv.js";import{P as yt}from"./progress-KqQtMOrv.js";import{R as je,C as z}from"./row-BLaRi8TG.js";import{R as we}from"./useIcons-Bh5YfX0K.js";import{F as _}from"./Table-DUVIRzZL.js";import{T as $e}from"./index-CCn2kg36.js";import"./SessionTimeout-72mUHhjZ.js";import"./Modal-CTkSowC8.js";import"./transition-BcOJrHw_.js";import"./PrimaryButton-0XQdD5oU.js";import"./SecondaryButton-DbLXN_Wj.js";import"./CSSMotionList-CEJCmY9t.js";import"./useForm-CpR6UdBL.js";import"./Input-Br3Lt1rS.js";import"./getAllowClear-ggc3xdDv.js";import"./EyeOutlined-BXjcMdGf.js";import"./TextArea-n8YGhIra.js";import"./index-CdwOtgdH.js";import"./DownOutlined-B9GtLQuW.js";import"./CalendarOutlined-eixNbCoN.js";import"./ClockCircleOutlined-BGBypZha.js";import"./index-5hnhc-Y9.js";const xt=e=>{const{componentCls:t,notificationMarginEdge:n,animationMaxHeight:a}=e,f=`${t}-notice`,u=new Q("antNotificationFadeIn",{"0%":{transform:"translate3d(100%, 0, 0)",opacity:0},"100%":{transform:"translate3d(0, 0, 0)",opacity:1}}),s=new Q("antNotificationTopFadeIn",{"0%":{top:-a,opacity:0},"100%":{top:0,opacity:1}}),d=new Q("antNotificationBottomFadeIn",{"0%":{bottom:e.calc(a).mul(-1).equal(),opacity:0},"100%":{bottom:0,opacity:1}}),i=new Q("antNotificationLeftFadeIn",{"0%":{transform:"translate3d(-100%, 0, 0)",opacity:0},"100%":{transform:"translate3d(0, 0, 0)",opacity:1}});return{[t]:{[`&${t}-top, &${t}-bottom`]:{marginInline:0,[f]:{marginInline:"auto auto"}},[`&${t}-top`]:{[`${t}-fade-enter${t}-fade-enter-active, ${t}-fade-appear${t}-fade-appear-active`]:{animationName:s}},[`&${t}-bottom`]:{[`${t}-fade-enter${t}-fade-enter-active, ${t}-fade-appear${t}-fade-appear-active`]:{animationName:d}},[`&${t}-topRight, &${t}-bottomRight`]:{[`${t}-fade-enter${t}-fade-enter-active, ${t}-fade-appear${t}-fade-appear-active`]:{animationName:u}},[`&${t}-topLeft, &${t}-bottomLeft`]:{marginRight:{value:0,_skip_check_:!0},marginLeft:{value:n,_skip_check_:!0},[f]:{marginInlineEnd:"auto",marginInlineStart:0},[`${t}-fade-enter${t}-fade-enter-active, ${t}-fade-appear${t}-fade-appear-active`]:{animationName:i}}}}},Ct=["top","topLeft","topRight","bottom","bottomLeft","bottomRight"],St={topLeft:"left",topRight:"right",bottomLeft:"left",bottomRight:"right",top:"left",bottom:"left"},jt=(e,t)=>{const{componentCls:n}=e;return{[`${n}-${t}`]:{[`&${n}-stack > ${n}-notice-wrapper`]:{[t.startsWith("top")?"top":"bottom"]:0,[St[t]]:{value:0,_skip_check_:!0}}}}},wt=e=>{const t={};for(let n=1;n<e.notificationStackLayer;n++)t[`&:nth-last-child(${n+1})`]={overflow:"hidden",[`& > ${e.componentCls}-notice`]:{opacity:0,transition:`opacity ${e.motionDurationMid}`}};return{[`&:not(:nth-last-child(-n+${e.notificationStackLayer}))`]:{opacity:0,overflow:"hidden",color:"transparent",pointerEvents:"none"},...t}},$t=e=>{const t={};for(let n=1;n<e.notificationStackLayer;n++)t[`&:nth-last-child(${n+1})`]={background:e.colorBgBlur,backdropFilter:"blur(10px)","-webkit-backdrop-filter":"blur(10px)"};return{...t}},vt=e=>{const{componentCls:t}=e;return{[`${t}-stack`]:{[`& > ${t}-notice-wrapper`]:{transition:`transform ${e.motionDurationSlow}, backdrop-filter 0s`,willChange:"transform, opacity",position:"absolute",...wt(e)}},[`${t}-stack:not(${t}-stack-expanded)`]:{[`& > ${t}-notice-wrapper`]:{...$t(e)}},[`${t}-stack${t}-stack-expanded`]:{[`& > ${t}-notice-wrapper`]:{"&:not(:nth-last-child(-n + 1))":{opacity:1,overflow:"unset",color:"inherit",pointerEvents:"auto",[`& > ${e.componentCls}-notice`]:{opacity:1}},"&:after":{content:'""',position:"absolute",height:e.margin,width:"100%",insetInline:0,bottom:e.calc(e.margin).mul(-1).equal(),background:"transparent",pointerEvents:"auto"}}},...Ct.map(n=>jt(e,n)).reduce((n,a)=>({...n,...a}),{})}},Te=e=>{const{iconCls:t,componentCls:n,boxShadow:a,fontSizeLG:f,notificationMarginBottom:u,borderRadiusLG:s,colorSuccess:d,colorInfo:i,colorWarning:m,colorError:r,colorTextHeading:p,notificationBg:S,notificationPadding:x,notificationMarginEdge:g,progressBg:l,notificationProgressHeight:y,fontSize:I,lineHeight:$,width:P,notificationIconSize:j,colorText:v,colorSuccessBg:M,colorErrorBg:F,colorInfoBg:k,colorWarningBg:D}=e,b=`${n}-notice`;return{position:"relative",marginBottom:u,marginInlineStart:"auto",background:S,borderRadius:s,boxShadow:a,[b]:{padding:x,width:P,maxWidth:`calc(100vw - ${ee(e.calc(g).mul(2).equal())})`,lineHeight:$,wordWrap:"break-word",borderRadius:s,overflow:"hidden","&-success":M?{background:M}:{},"&-error":F?{background:F}:{},"&-info":k?{background:k}:{},"&-warning":D?{background:D}:{}},[`${b}-title`]:{marginBottom:e.marginXS,color:p,fontSize:f,lineHeight:e.lineHeightLG},[`${b}-description`]:{fontSize:I,color:v,marginTop:e.marginXS},[`${b}-closable ${b}-title`]:{paddingInlineEnd:e.paddingLG},[`${b}-with-icon ${b}-title`]:{marginBottom:e.marginXS,marginInlineStart:e.calc(e.marginSM).add(j).equal(),fontSize:f},[`${b}-with-icon ${b}-description`]:{marginInlineStart:e.calc(e.marginSM).add(j).equal(),fontSize:I},[`${b}-icon`]:{position:"absolute",fontSize:j,lineHeight:1,[`&-success${t}`]:{color:d},[`&-info${t}`]:{color:i},[`&-warning${t}`]:{color:m},[`&-error${t}`]:{color:r}},[`${b}-close`]:{position:"absolute",top:e.notificationPaddingVertical,insetInlineEnd:e.notificationPaddingHorizontal,color:e.colorIcon,outline:"none",width:e.notificationCloseButtonSize,height:e.notificationCloseButtonSize,borderRadius:e.borderRadiusSM,transition:`background-color ${e.motionDurationMid}, color ${e.motionDurationMid}`,display:"flex",alignItems:"center",justifyContent:"center",background:"none",border:"none","&:hover":{color:e.colorIconHover,backgroundColor:e.colorBgTextHover},"&:active":{backgroundColor:e.colorBgTextActive},...He(e)},[`${b}-progress`]:{position:"absolute",display:"block",appearance:"none",inlineSize:`calc(100% - ${ee(s)} * 2)`,left:{_skip_check_:!0,value:s},right:{_skip_check_:!0,value:s},bottom:0,blockSize:y,border:0,"&, &::-webkit-progress-bar":{borderRadius:s,backgroundColor:"rgba(0, 0, 0, 0.04)"},"&::-moz-progress-bar":{background:l},"&::-webkit-progress-value":{borderRadius:s,background:l}},[`${b}-actions`]:{float:"right",marginTop:e.marginSM}}},It=e=>{const{componentCls:t,notificationMarginBottom:n,notificationMarginEdge:a,motionDurationMid:f,motionEaseInOut:u}=e,s=`${t}-notice`,d=new Q("antNotificationFadeOut",{"0%":{maxHeight:e.animationMaxHeight,marginBottom:n},"100%":{maxHeight:0,marginBottom:0,paddingTop:0,paddingBottom:0,opacity:0}});return[{[t]:{...Oe(e),position:"fixed",zIndex:e.zIndexPopup,marginRight:{value:a,_skip_check_:!0},[`${t}-hook-holder`]:{position:"relative"},[`${t}-fade-appear-prepare`]:{opacity:"0 !important"},[`${t}-fade-enter, ${t}-fade-appear`]:{animationDuration:e.motionDurationMid,animationTimingFunction:u,animationFillMode:"both",opacity:0,animationPlayState:"paused"},[`${t}-fade-leave`]:{animationTimingFunction:u,animationFillMode:"both",animationDuration:f,animationPlayState:"paused"},[`${t}-fade-enter${t}-fade-enter-active, ${t}-fade-appear${t}-fade-appear-active`]:{animationPlayState:"running"},[`${t}-fade-leave${t}-fade-leave-active`]:{animationName:d,animationPlayState:"running"},"&-rtl":{direction:"rtl",[`${s}-actions`]:{float:"left"}}}},{[t]:{[`${s}-wrapper`]:Te(e)}}]},ke=e=>({zIndexPopup:e.zIndexPopupBase+Ke+50,width:384,progressBg:`linear-gradient(90deg, ${e.colorPrimaryBorderHover}, ${e.colorPrimary})`,colorSuccessBg:void 0,colorErrorBg:void 0,colorInfoBg:void 0,colorWarningBg:void 0}),Re=e=>{const t=e.paddingMD,n=e.paddingLG;return Ze(e,{notificationBg:e.colorBgElevated,notificationPaddingVertical:t,notificationPaddingHorizontal:n,notificationIconSize:e.calc(e.fontSizeLG).mul(e.lineHeightLG).equal(),notificationCloseButtonSize:e.calc(e.controlHeightLG).mul(.55).equal(),notificationMarginBottom:e.margin,notificationPadding:`${ee(e.paddingMD)} ${ee(e.paddingContentHorizontalLG)}`,notificationMarginEdge:e.marginLG,animationMaxHeight:150,notificationStackLayer:3,notificationProgressHeight:2})},_e=Ve("Notification",e=>{const t=Re(e);return[It(t),xt(t),vt(t)]},ke),Pt=Ue(["Notification","PurePanel"],e=>{const t=`${e.componentCls}-notice`,n=Re(e);return{[`${t}-pure-panel`]:{...Te(n),width:n.width,maxWidth:`calc(100vw - ${ee(e.calc(n.notificationMarginEdge).mul(2).equal())})`,margin:0}}},ke);function ye(e,t){return t===null||t===!1?null:t||h.createElement(De,{className:`${e}-close-icon`})}const Mt={success:ft,info:gt,error:Qe,warning:ht},Ae=e=>{const{prefixCls:t,icon:n,type:a,title:f,description:u,actions:s,role:d="alert",styles:i,classNames:m}=e;let r=null;return n?r=h.createElement("span",{className:T(`${t}-icon`,m.icon),style:i.icon},n):a&&(r=h.createElement(Mt[a]||null,{className:T(`${t}-icon`,m.icon,`${t}-icon-${a}`),style:i.icon})),h.createElement("div",{className:T({[`${t}-with-icon`]:r}),role:d},r,h.createElement("div",{className:T(`${t}-title`,m.title),style:i.title},f),u&&h.createElement("div",{className:T(`${t}-description`,m.description),style:i.description},u),s&&h.createElement("div",{className:T(`${t}-actions`,m.actions),style:i.actions},s))},Nt=e=>{const{prefixCls:t,icon:n,type:a,message:f,title:u,description:s,btn:d,actions:i,closeIcon:m,className:r,style:p,styles:S,classNames:x,closable:g,...l}=e,{getPrefixCls:y,className:I,style:$,classNames:P,styles:j}=Pe("notification"),[v,M]=Ne([P,x],[j,S],{props:e}),{notification:F}=h.useContext(ie),k=i??d,D=u??f,b=t||y("notification"),B=`${b}-notice`,L=Fe(b),[R,G]=_e(b,L),[W,X,,V]=Je(ae(e),ae(F),{closable:!0,closeIcon:h.createElement(De,{className:`${b}-close-icon`}),closeIconRender:U=>ye(b,U)}),K=W?{onClose:g&&typeof g=="object"?g==null?void 0:g.onClose:void 0,closeIcon:X,...V}:!1;return h.createElement("div",{className:T(`${B}-pure-panel`,R,r,G,L,v.root),style:M.root},h.createElement(Pt,{prefixCls:b}),h.createElement(dt,{style:{...$,...p},...l,prefixCls:b,eventKey:"pure",duration:null,closable:K,className:T(r,I),content:h.createElement(Ae,{classNames:v,styles:M,prefixCls:B,icon:n,type:a,title:D,description:s,actions:k})}))};function Ft(e,t,n){let a;switch(e){case"top":a={left:"50%",transform:"translateX(-50%)",right:"auto",top:t,bottom:"auto"};break;case"topLeft":a={left:0,top:t,bottom:"auto"};break;case"topRight":a={right:0,top:t,bottom:"auto"};break;case"bottom":a={left:"50%",transform:"translateX(-50%)",right:"auto",top:"auto",bottom:n};break;case"bottomLeft":a={left:0,top:"auto",bottom:n};break;default:a={right:0,top:"auto",bottom:n};break}return a}function Dt(e){return{motionName:`${e}-fade`}}function Et(e,t,n){return typeof e<"u"?e:typeof(t==null?void 0:t.closeIcon)<"u"?t.closeIcon:n==null?void 0:n.closeIcon}const ve=24,Tt=4.5,kt="topRight",Rt=({children:e,prefixCls:t})=>{const n=Fe(t),[a,f]=_e(t,n);return C.createElement(ut,{classNames:{list:T(a,f,n)}},e)},_t=(e,{prefixCls:t,key:n})=>C.createElement(Rt,{prefixCls:t,key:n},e),At=C.forwardRef((e,t)=>{const{top:n,bottom:a,prefixCls:f,getContainer:u,maxCount:s,rtl:d,onAllRemoved:i,stack:m,duration:r=Tt,pauseOnHover:p=!0,showProgress:S}=e,{getPrefixCls:x,getPopupContainer:g,direction:l}=Pe("notification"),{notification:y}=h.useContext(ie),[,I]=ze(),$=f||x("notification"),P=h.useMemo(()=>typeof r=="number"&&r>0?r:!1,[r]),j=B=>Ft(B,n??ve,a??ve),v=()=>T({[`${$}-rtl`]:d??l==="rtl"}),M=()=>Dt($),[F,k]=mt({prefixCls:$,style:j,className:v,motion:M,closable:{closeIcon:ye($)},duration:P,getContainer:()=>(u==null?void 0:u())||(g==null?void 0:g())||document.body,maxCount:s,pauseOnHover:p,showProgress:S,onAllRemoved:i,renderNotifications:_t,stack:m===!1?!1:{threshold:typeof m=="object"?m==null?void 0:m.threshold:void 0,offset:8,gap:I.margin}}),[D,b]=Ne([y==null?void 0:y.classNames,e==null?void 0:e.classNames],[y==null?void 0:y.styles,e==null?void 0:e.styles],{props:e});return C.useImperativeHandle(t,()=>({...F,prefixCls:$,notification:y,classNames:D,styles:b})),k});function Be(e){const t=C.useRef(null);qe();const{notification:n}=C.useContext(ie);return[C.useMemo(()=>{const f=i=>{if(!t.current)return;const{open:m,prefixCls:r,notification:p,classNames:S,styles:x}=t.current,g=(p==null?void 0:p.className)||{},l=(p==null?void 0:p.style)||{},y=`${r}-notice`,{title:I,message:$,description:P,icon:j,type:v,btn:M,actions:F,className:k,style:D,role:b="alert",closeIcon:B,closable:L,classNames:R={},styles:G={},...W}=i,X=I??$,V=F??M,K=ye(y,Et(B,e,p)),[U,le,,ce]=et(ae({...e||{},...i}),ae(n),{closable:!0,closeIcon:K}),de=U?{onClose:L&&typeof L=="object"?L.onClose:void 0,closeIcon:le,...ce}:!1,me=Se(R,{props:i}),ue=Se(G,{props:i}),c=tt(void 0,S,me),E=ot(x,ue);return m({placement:(e==null?void 0:e.placement)??kt,...W,content:C.createElement(Ae,{prefixCls:y,icon:j,type:v,title:X,description:P,actions:V,role:b,classNames:c,styles:E}),className:T({[`${y}-${v}`]:v},k,g,c.root),style:{...l,...E.root,...D},closable:de})},s={open:f,destroy:i=>{var m,r;i!==void 0?(m=t.current)==null||m.close(i):(r=t.current)==null||r.destroy()}};return["success","info","warning","error"].forEach(i=>{s[i]=m=>f({...m,type:i})}),s},[e,n]),C.createElement(At,{key:"notification-holder",...e,ref:t})]}function Bt(e){return Be(e)}let N=null,se=e=>e(),re=[],oe={};function Ie(){const{getContainer:e,rtl:t,maxCount:n,top:a,bottom:f,showProgress:u,pauseOnHover:s}=oe,d=(e==null?void 0:e())||document.body;return{getContainer:()=>d,rtl:t,maxCount:n,top:a,bottom:f,showProgress:u,pauseOnHover:s}}const Lt=C.forwardRef((e,t)=>{const{notificationConfig:n,sync:a}=e,{getPrefixCls:f}=h.useContext(ie),u=oe.prefixCls||f("notification"),s=h.useContext(pt),[d,i]=Be({...n,prefixCls:u,...s.notification});return C.useEffect(a,[]),C.useImperativeHandle(t,()=>{const m={...d};return Object.keys(m).forEach(r=>{m[r]=(...p)=>(a(),d[r].apply(d,p))}),{instance:m,sync:a}}),i}),Yt=C.forwardRef((e,t)=>{const[n,a]=C.useState(Ie),f=()=>{a(Ie)};C.useEffect(f,[]);const u=We(),s=u.getRootPrefixCls(),d=u.getIconPrefixCls(),i=u.getTheme(),m=C.createElement(Lt,{ref:t,sync:f,notificationConfig:n});return C.createElement(Ge,{prefixCls:s,iconPrefixCls:d,theme:i},u.holderRender?u.holderRender(m):m)}),xe=()=>{if(!N){const e=document.createDocumentFragment(),t={fragment:e};N=t,se(()=>{nt(C.createElement(Yt,{ref:n=>{const{instance:a,sync:f}=n||{};Promise.resolve().then(()=>{!t.instance&&a&&(t.instance=a,t.sync=f,xe())})}}),e)});return}N.instance&&(re.forEach(e=>{switch(e.type){case"open":{se(()=>{N.instance.open({...oe,...e.config})});break}case"destroy":se(()=>{var t;(t=N==null?void 0:N.instance)==null||t.destroy(e.key)});break}}),re=[])};function Ot(e){oe={...oe,...e},se(()=>{var t;(t=N==null?void 0:N.sync)==null||t.call(N)})}function Le(e){re.push({type:"open",config:e}),xe()}const Ht=e=>{re.push({type:"destroy",key:e}),xe()},zt=["success","info","warning","error"],qt={open:Le,destroy:Ht,config:Ot,useNotification:Bt,_InternalPanelDoNotUseOrYouWillBeFired:Nt},Ce=qt;zt.forEach(e=>{Ce[e]=t=>Le({...t,type:e})});const{TextArea:Gt}=q,{Option:Wt}=A;function Xt({open:e,onClose:t,members:n,defaultType:a="monthly"}){const{props:f}=Me(),u=f.settings||{},s=u.monthly_contribution_amount?parseFloat(u.monthly_contribution_amount.value):5e4,[d]=w.useForm(),[i,m]=h.useState(!1),[r,p]=h.useState(a);C.useEffect(()=>{e&&p(a)},[e,a]),C.useEffect(()=>{e&&setTimeout(()=>{d.resetFields();const l={member_id:void 0,date:Z(),notes:""};r==="monthly"?(l.amount=s,l.purpose="Monthly Contribution"):(l.amount=void 0,l.purpose=""),d.setFieldsValue(l)},0)},[e,r,s,d]);const S=l=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(l||0),x=async l=>{var I,$,P;m(!0);const y={member_id:l.member_id,type:r,amount:l.amount,date:l.date.format("YYYY-MM-DD"),purpose:l.purpose,notes:l.notes||""};try{(await window.axios.post(route("contributions.store"),y,{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}})).data.success&&(Ce.success({message:"Success!",description:"Contribution recorded successfully!",icon:o.jsx(Ee,{style:{color:"#52c41a"}}),placement:"topRight",duration:3}),d.resetFields(),t(),setTimeout(()=>{window.location.reload()},1500))}catch(j){if(console.error("Error:",j),((I=j.response)==null?void 0:I.status)===422){const v=j.response.data.errors;Object.keys(v).forEach(M=>{O.error(v[M][0])})}else(P=($=j.response)==null?void 0:$.data)!=null&&P.message?O.error(j.response.data.message):O.error("Failed to record contribution. Please try again.")}finally{m(!1)}},g=()=>{d.resetFields(),t()};return C.useEffect(()=>{e||d.resetFields()},[e,d]),o.jsx(he,{title:o.jsxs(te,{children:[o.jsx(st,{style:{color:"#1890ff"}}),o.jsx("span",{children:r==="monthly"?"Add Monthly Contribution":"Add Other Contribution"})]}),open:e,onCancel:g,onOk:()=>d.submit(),confirmLoading:i,okText:r==="monthly"?"Add Monthly Contribution":"Add Other Contribution",cancelText:"Cancel",width:600,styles:{body:{maxHeight:"70vh",overflowY:"auto"}},centered:!0,destroyOnClose:!0,children:o.jsxs(w,{form:d,layout:"vertical",onFinish:x,children:[o.jsx(fe,{message:r==="monthly"?"Monthly Contribution":"Other Contribution",description:r==="monthly"?"System handles multiple payments and advance payments automatically. Excess amounts are distributed to future months.":"Record special projects, donations, or other non-monthly contributions.",type:"info",icon:o.jsx(ct,{}),showIcon:!0,style:{marginBottom:24}}),o.jsx(w.Item,{name:"type",hidden:!0,initialValue:r,children:o.jsx(q,{})}),o.jsx(w.Item,{label:"Member",name:"member_id",rules:[{required:!0,message:"Please select a member"}],children:o.jsx(A,{showSearch:!0,placeholder:"Select a member",optionFilterProp:"children",filterOption:(l,y)=>y.children.toLowerCase().includes(l.toLowerCase()),children:n.map(l=>o.jsx(Wt,{value:l.id,children:l.name},l.id))})}),o.jsx(w.Item,{label:"Amount (TZS)",name:"amount",rules:[{required:!0,message:"Please enter an amount"},{type:"number",min:0,message:"Amount must be positive"}],extra:r==="monthly"?`Monthly contribution: ${S(s)} • Smart distribution enabled`:"Enter amount for special contribution",children:o.jsx(ge,{style:{width:"100%"},placeholder:"Enter amount",formatter:l=>`${l}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:l=>l.replace(/\$\s?|(,*)/g,""),prefix:"TZS"})}),o.jsx(w.Item,{label:"Date",name:"date",rules:[{required:!0,message:"Please select a date"}],children:o.jsx(be,{style:{width:"100%"},format:"YYYY-MM-DD"})}),o.jsx(w.Item,{label:"Purpose",name:"purpose",rules:[{required:!0,message:"Please enter a purpose"}],children:o.jsx(q,{placeholder:r==="monthly"?"Monthly Contribution":"Enter purpose (e.g., Building Fund, Equipment)",autoComplete:"new-password",style:{backgroundColor:"transparent"},styles:{input:{backgroundColor:"transparent",WebkitBoxShadow:"none",boxShadow:"none"}}})}),o.jsx(w.Item,{label:"Notes (Optional)",name:"notes",children:o.jsx(Gt,{rows:3,placeholder:"Additional notes about this contribution..."})})]},`form-${r}`)},`contribution-form-${r}-${e}`)}const{Option:Vt}=A;function Zt({open:e,onClose:t,members:n}){const[a]=w.useForm(),[f,u]=h.useState(!1),s=async i=>{var r,p,S;u(!0);const m={member_id:i.member_id,amount:i.amount,reason:i.reason,due_date:i.due_date.format("YYYY-MM-DD")};try{(await window.axios.post(route("debts.store"),m,{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}})).data.success&&(Ce.success({message:"Success!",description:"Debt added successfully!",icon:o.jsx(Ee,{style:{color:"#52c41a"}}),placement:"topRight",duration:3}),a.resetFields(),t(),setTimeout(()=>{window.location.reload()},1500))}catch(x){if(console.error("Error:",x),((r=x.response)==null?void 0:r.status)===422){const g=x.response.data.errors;Object.keys(g).forEach(l=>{O.error(g[l][0])})}else(S=(p=x.response)==null?void 0:p.data)!=null&&S.message?O.error(x.response.data.message):O.error("Failed to add debt. Please try again.")}finally{u(!1)}},d=()=>{a.resetFields(),t()};return o.jsx(he,{title:o.jsxs(te,{children:[o.jsx(bt,{style:{color:"#ff4d4f"}}),o.jsx("span",{children:"Add Debt"})]}),open:e,onCancel:d,onOk:()=>a.submit(),confirmLoading:f,okText:"Add Debt",cancelText:"Cancel",width:600,okButtonProps:{danger:!0},styles:{body:{maxHeight:"70vh",overflowY:"auto"}},centered:!0,children:o.jsxs(w,{form:a,layout:"vertical",onFinish:s,initialValues:{due_date:Z().add(30,"days")},children:[o.jsx(w.Item,{label:"Member",name:"member_id",rules:[{required:!0,message:"Please select a member"}],children:o.jsx(A,{showSearch:!0,placeholder:"Select a member",optionFilterProp:"children",filterOption:(i,m)=>m.children.toLowerCase().includes(i.toLowerCase()),children:((n==null?void 0:n.data)||n||[]).map(i=>o.jsx(Vt,{value:i.id,children:i.name},i.id))})}),o.jsx(w.Item,{label:"Amount (TZS)",name:"amount",rules:[{required:!0,message:"Please enter an amount"},{type:"number",min:0,message:"Amount must be positive"}],children:o.jsx(ge,{style:{width:"100%"},placeholder:"Enter debt amount",formatter:i=>`${i}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:i=>i.replace(/\$\s?|(,*)/g,""),prefix:"TZS"})}),o.jsx(w.Item,{label:"Reason",name:"reason",rules:[{required:!0,message:"Please enter a reason"}],children:o.jsx(q,{placeholder:"Enter reason for debt"})}),o.jsx(w.Item,{label:"Due Date",name:"due_date",rules:[{required:!0,message:"Please select a due date"}],children:o.jsx(be,{style:{width:"100%"},format:"YYYY-MM-DD",disabledDate:i=>i&&i<Z().startOf("day")})})]})})}const{Option:Kt}=A;function Ut({open:e,onClose:t,members:n}){const[a]=w.useForm(),[f,u]=h.useState(!1),[s,d]=h.useState({isProcessing:!1,total:0,sent:0,failed:0,currentStep:"idle",errors:[]}),i=async r=>{var S,x;u(!0),d({isProcessing:!0,total:0,sent:0,failed:0,currentStep:"creating",errors:[]});const p={member_id:r.member_id,amount:r.amount,date:r.date.format("YYYY-MM-DD"),purpose:r.purpose};try{const l=(await window.axios.post(route("disaster-payments.store"),p,{headers:{"X-Requested-With":"XMLHttpRequest"}})).data;l.success&&(d({isProcessing:!1,total:l.email_results.total,sent:l.email_results.sent,failed:l.email_results.failed,currentStep:"complete",errors:l.email_results.errors||[]}),O.success(`Disbursement recorded! Notifications sent to ${l.email_results.sent} members.`),setTimeout(()=>{a.resetFields(),t(),window.location.reload()},3e3))}catch(g){console.error("Error:",g),d({isProcessing:!1,total:0,sent:0,failed:0,currentStep:"idle",errors:[]}),(x=(S=g.response)==null?void 0:S.data)!=null&&x.errors?Object.keys(g.response.data.errors).forEach(l=>{O.error(g.response.data.errors[l][0])}):O.error("Failed to record disbursement. Please try again.")}finally{u(!1)}},m=()=>{s.isProcessing||(a.resetFields(),d({isProcessing:!1,total:0,sent:0,failed:0,currentStep:"idle",errors:[]}),t())};return o.jsx(he,{title:o.jsxs(te,{children:[o.jsx(rt,{style:{color:"#1890ff"}}),o.jsx("span",{children:"Add Disbursement"})]}),open:e,onCancel:m,onOk:()=>a.submit(),confirmLoading:f||s.isProcessing,okText:s.isProcessing?"Processing...":"Add Disbursement",cancelText:"Cancel",width:600,closable:!s.isProcessing,maskClosable:!s.isProcessing,styles:{body:{maxHeight:"70vh",overflowY:"auto"}},centered:!0,children:o.jsxs(w,{form:a,layout:"vertical",onFinish:i,initialValues:{date:Z()},children:[o.jsx(w.Item,{label:"Member",name:"member_id",rules:[{required:!0,message:"Please select a member"}],children:o.jsx(A,{showSearch:!0,placeholder:"Select a member",optionFilterProp:"children",filterOption:(r,p)=>p.children.toLowerCase().includes(r.toLowerCase()),disabled:s.isProcessing,children:n.map(r=>o.jsx(Kt,{value:r.id,children:r.name},r.id))})}),o.jsx(w.Item,{label:"Amount (TZS)",name:"amount",rules:[{required:!0,message:"Please enter an amount"},{type:"number",min:0,message:"Amount must be positive"}],children:o.jsx(ge,{style:{width:"100%"},placeholder:"Enter disbursement amount",formatter:r=>`${r}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:r=>r.replace(/\$\s?|(,*)/g,""),prefix:"TZS",disabled:s.isProcessing})}),o.jsx(w.Item,{label:"Date",name:"date",rules:[{required:!0,message:"Please select a date"}],children:o.jsx(be,{style:{width:"100%"},format:"YYYY-MM-DD",disabled:s.isProcessing})}),o.jsx(w.Item,{label:"Purpose",name:"purpose",rules:[{required:!0,message:"Please enter a purpose"}],children:o.jsx(q,{placeholder:"Purpose of disbursement (e.g., Medical Emergency, Funeral)",disabled:s.isProcessing})}),s.isProcessing&&o.jsx(fe,{message:s.currentStep==="creating"?"Creating disbursement...":"Sending email notifications...",description:s.total>0&&o.jsxs("div",{style:{marginTop:12},children:[o.jsx(yt,{percent:Math.round(s.sent/s.total*100),status:"active"}),o.jsxs("div",{style:{marginTop:8,fontSize:12},children:["Sent ",s.sent," of ",s.total," notifications",s.failed>0&&` (${s.failed} failed)`]})]}),type:"info",icon:o.jsx(at,{}),showIcon:!0}),s.currentStep==="complete"&&o.jsx(fe,{message:"Email Notifications Complete",description:o.jsxs("div",{children:[o.jsxs("div",{children:["✅ Successfully sent to ",s.sent," members"]}),s.failed>0&&o.jsxs("div",{style:{color:"#fa8c16"},children:["⚠️ Failed to send to ",s.failed," members"]})]}),type:"success",showIcon:!0})]})})}function _o(){const{members:e=[],allMembers:t=[],monthlyContributionsByMonth:n={},memberMonthlyTotal:a={},memberOtherTotal:f={},otherContributions:u={},otherContributionsSummary:s=[],debts:d={},penalties:i={},disasterPayments:m={},statistics:r={},filters:p={}}=Me().props;Xe.useToken();const[S,x]=h.useState(p.tab||"contributions"),[g,l]=h.useState(p.search||""),[y,I]=h.useState(p.year||new Date().getFullYear()),[$,P]=h.useState(p.month||"");C.useEffect(()=>{p.tab&&p.tab!==S&&x(p.tab)},[p.tab]);const[j,v]=h.useState(!1),[M,F]=h.useState("monthly"),[k,D]=h.useState(!1),[b,B]=h.useState(!1),L=c=>{j?(v(!1),setTimeout(()=>{F(c),v(!0)},100)):(F(c),v(!0))},R=c=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(c||0),G=Array.from({length:new Date().getFullYear()-2018+1},(c,E)=>({label:String(2018+E),value:2018+E})).reverse(),W=[{label:"All Months",value:""},{label:"January",value:1},{label:"February",value:2},{label:"March",value:3},{label:"April",value:4},{label:"May",value:5},{label:"June",value:6},{label:"July",value:7},{label:"August",value:8},{label:"September",value:9},{label:"October",value:10},{label:"November",value:11},{label:"December",value:12}],X=()=>{J.get(route("admin-portal.financials"),{search:g,year:y,month:$,tab:S})},V=()=>{l(""),I(new Date().getFullYear()),P(""),J.get(route("admin-portal.financials"),{tab:S})},K=c=>{x(c),J.get(route("admin-portal.financials"),{...p,tab:c},{preserveState:!0,preserveScroll:!0})},U=[{title:"Member",dataIndex:"name",key:"name",width:200},{title:"Email",dataIndex:"email",key:"email",width:200},{title:"Phone",dataIndex:"phone_number",key:"phone_number",width:150},{title:"Monthly Contributions",key:"monthly_total",width:150,render:(c,E)=>{const pe=a[E.id]||0;return R(pe)}},{title:"Actions",key:"actions",width:120,render:(c,E)=>o.jsx(Y,{type:"link",onClick:()=>J.visit(route("admin-portal.member-contributions",{member:E.id,year:y})),children:"View Details"})}],le=[{title:"Member",dataIndex:["member","name"],key:"member_name",width:200},{title:"Amount",dataIndex:"amount",key:"amount",width:150,render:c=>R(c)},{title:"Date",dataIndex:"date",key:"date",width:150,render:c=>Z(c).format("DD MMM YYYY")},{title:"Purpose",dataIndex:"purpose",key:"purpose",width:250},{title:"Notes",dataIndex:"notes",key:"notes",ellipsis:!0}],ce=[{title:"Member",dataIndex:["member","name"],key:"member_name",width:200},{title:"Amount",dataIndex:"amount",key:"amount",render:c=>R(c)},{title:"Reason",dataIndex:"reason",key:"reason",width:200},{title:"Status",dataIndex:"status",key:"status",render:c=>o.jsx($e,{color:c==="paid"?"green":"red",children:c})}],de=[{title:"Member",dataIndex:["member","name"],key:"member_name",width:200},{title:"Amount",dataIndex:"amount",key:"amount",render:c=>R(c)},{title:"Reason",dataIndex:"reason",key:"reason",width:200},{title:"Status",dataIndex:"status",key:"status",render:c=>o.jsx($e,{color:c==="paid"?"green":"orange",children:c})}],me=[{title:"Member",dataIndex:["member","name"],key:"member_name",width:200},{title:"Amount",dataIndex:"amount",key:"amount",render:c=>R(c)},{title:"Date",dataIndex:"date",key:"date",render:c=>Z(c).format("DD MMM YYYY")},{title:"Description",dataIndex:"description",key:"description",width:200}],ue=[{key:"contributions",label:"Monthly Contributions",children:o.jsxs("div",{style:{padding:"24px"},children:[o.jsx("div",{style:{marginBottom:"16px",display:"flex",justifyContent:"flex-end"},children:o.jsx(Y,{type:"primary",icon:o.jsx(ne,{}),onClick:()=>L("monthly"),size:"large",children:"Add Contribution"})}),o.jsx(H,{style:{marginBottom:"16px"},children:o.jsxs(je,{gutter:[16,16],align:"middle",children:[o.jsx(z,{xs:24,sm:12,md:8,children:o.jsx(q,{placeholder:"Search by member name...",prefix:o.jsx(we,{}),value:g,onChange:c=>l(c.target.value),allowClear:!0})}),o.jsx(z,{xs:24,sm:6,md:4,children:o.jsx(A,{placeholder:"Year",value:y,onChange:c=>I(c),options:G,style:{width:"100%"}})}),o.jsx(z,{xs:24,sm:6,md:4,children:o.jsx(A,{placeholder:"Month",value:$,onChange:c=>P(c),options:W,style:{width:"100%"}})}),o.jsx(z,{xs:24,md:8,style:{textAlign:"right"},children:o.jsxs(te,{children:[o.jsx(Y,{type:"primary",onClick:X,children:"Apply"}),o.jsx(Y,{onClick:V,children:"Clear"})]})})]})}),o.jsx(H,{title:"Monthly Contributions",children:o.jsx(_,{columns:U,dataSource:e.data||e,rowKey:"id",pagination:e.data?{current:e.current_page,pageSize:e.per_page,total:e.total,onChange:c=>{J.get(route("admin-portal.financials"),{...p,page:c})}}:{pageSize:10},scroll:{x:800}})})]})},{key:"other-contributions",label:"Other Contributions",children:o.jsxs("div",{style:{padding:"24px"},children:[o.jsx("div",{style:{marginBottom:"16px",display:"flex",justifyContent:"flex-end"},children:o.jsx(Y,{type:"primary",icon:o.jsx(ne,{}),onClick:()=>L("other"),size:"large",children:"Add Other Contribution"})}),o.jsx(H,{style:{marginBottom:"16px"},children:o.jsxs(je,{gutter:[16,16],align:"middle",children:[o.jsx(z,{xs:24,sm:12,md:8,children:o.jsx(q,{placeholder:"Search by member name...",prefix:o.jsx(we,{}),value:g,onChange:c=>l(c.target.value),allowClear:!0})}),o.jsx(z,{xs:24,sm:6,md:4,children:o.jsx(A,{placeholder:"Year",value:y,onChange:c=>I(c),options:G,style:{width:"100%"}})}),o.jsx(z,{xs:24,sm:6,md:4,children:o.jsx(A,{placeholder:"Month",value:$,onChange:c=>P(c),options:W,style:{width:"100%"}})}),o.jsx(z,{xs:24,md:8,style:{textAlign:"right"},children:o.jsxs(te,{children:[o.jsx(Y,{type:"primary",onClick:X,children:"Apply"}),o.jsx(Y,{onClick:V,children:"Clear"})]})})]})}),o.jsx(H,{title:"Other Contributions (Projects, Donations, etc.)",children:o.jsx(_,{columns:le,dataSource:u.data||[],rowKey:"id",pagination:{pageSize:10},scroll:{x:800},summary:c=>{const E=c.reduce((pe,Ye)=>pe+parseFloat(Ye.amount||0),0);return o.jsx(_.Summary,{fixed:!0,children:o.jsxs(_.Summary.Row,{children:[o.jsx(_.Summary.Cell,{index:0,colSpan:1,children:o.jsx("strong",{children:"Total"})}),o.jsx(_.Summary.Cell,{index:1,children:o.jsx("strong",{children:R(E)})}),o.jsx(_.Summary.Cell,{index:2,colSpan:3})]})})}})})]})},{key:"debts",label:"Debts",children:o.jsx("div",{style:{padding:"24px"},children:o.jsx(H,{title:"Member Debts",extra:o.jsx(Y,{type:"primary",danger:!0,icon:o.jsx(ne,{}),onClick:()=>D(!0),children:"Add Debt"}),children:o.jsx(_,{columns:ce,dataSource:d.data||[],rowKey:"id",pagination:{pageSize:10},scroll:{x:800}})})})},{key:"penalties",label:"Penalties",children:o.jsx("div",{style:{padding:"24px"},children:o.jsx(H,{title:"Member Penalties",children:o.jsx(_,{columns:de,dataSource:i.data||[],rowKey:"id",pagination:{pageSize:10},scroll:{x:800}})})})},{key:"disaster-payments",label:"Disbursements",children:o.jsx("div",{style:{padding:"24px"},children:o.jsx(H,{title:"Disaster Payments",extra:o.jsx(Y,{type:"primary",icon:o.jsx(ne,{}),onClick:()=>B(!0),children:"Add Disbursement"}),children:o.jsx(_,{columns:me,dataSource:m.data||[],rowKey:"id",pagination:{pageSize:10},scroll:{x:800}})})})}];return o.jsxs(it,{children:[o.jsx("div",{style:{padding:"24px 0"},children:o.jsx(H,{style:{borderRadius:"12px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.08)"},children:o.jsx(lt,{items:ue,activeKey:S,onChange:K})})}),j&&o.jsx(Xt,{open:j,onClose:()=>v(!1),members:t,defaultType:M},M),o.jsx(Zt,{open:k,onClose:()=>D(!1),members:t}),o.jsx(Ut,{open:b,onClose:()=>B(!1),members:t})]})}export{_o as default};
