import{a as se,r,j as s,S as a}from"./app-CCWscn4N.js";import{A as te,C as oe,S as C,B as g,c as re,D as ne}from"./AdminSidebarLayout-BHFbP-0Z.js";import{s as le}from"./index-BhyvampS.js";import{F as c}from"./index-C7rJnUG_.js";import{I as y}from"./index-BFcOIicW.js";import{R as ie}from"./useIcons-Bh5YfX0K.js";import{F as ae}from"./Table-DUVIRzZL.js";import{E as $}from"./index-CdwOtgdH.js";import{M as k}from"./index-BhSHgn0Z.js";import{S as z}from"./index-C-HA1eIq.js";import{R as D}from"./KeyOutlined-B5jQXFV0.js";import{T as ce}from"./index-iEk3Z0oW.js";import{R as de}from"./SafetyOutlined-Do-rKYWA.js";import{T as pe}from"./index-CCn2kg36.js";import{B as A}from"./index-D1VSToI4.js";import{R as me}from"./MoreOutlined-D2Cbkv-l.js";import{R as ue}from"./EditOutlined-BgapihRa.js";import{R as he}from"./DeleteOutlined-S1oeFgow.js";import"./SessionTimeout-72mUHhjZ.js";import"./Modal-CTkSowC8.js";import"./transition-BcOJrHw_.js";import"./PrimaryButton-0XQdD5oU.js";import"./SecondaryButton-DbLXN_Wj.js";import"./CheckCircleFilled-B-8ZM7Vi.js";import"./InfoCircleFilled-BBeUonew.js";import"./CSSMotionList-CEJCmY9t.js";import"./useForm-CpR6UdBL.js";import"./row-BLaRi8TG.js";import"./Input-Br3Lt1rS.js";import"./getAllowClear-ggc3xdDv.js";import"./EyeOutlined-BXjcMdGf.js";import"./TextArea-n8YGhIra.js";import"./DownOutlined-B9GtLQuW.js";import"./index-5hnhc-Y9.js";const{Text:O}=ce,{TextArea:xe}=y;function We({roles:m,allPermissions:B,filters:F}){const{token:v}=se.useToken(),[o,N]=le.useMessage(),[U,d]=r.useState(!1),[u,h]=r.useState(null),[q,S]=r.useState(!1),[n,j]=r.useState(null),[I,x]=r.useState(""),[H,R]=r.useState(!1),[f,w]=r.useState(null),[L,T]=r.useState([]),[l]=c.useForm(),[p]=c.useForm(),[E,M]=r.useState(F.search||""),P=()=>{a.get("/admin-portal/roles",{search:E},{preserveState:!0,preserveScroll:!0})},V=()=>{M(""),a.get("/admin-portal/roles",{},{preserveState:!0,preserveScroll:!0})},Y=()=>{h(null),l.resetFields(),d(!0)},Z=e=>{h(e),l.setFieldsValue({name:e.name,description:e.description}),d(!0)},G=()=>{l.validateFields().then(e=>{u?a.put(`/admin-portal/roles/${u.id}`,e,{preserveScroll:!0,onSuccess:()=>{d(!1),h(null),l.resetFields(),o.success("Role updated successfully")},onError:t=>{const i=(t==null?void 0:t.message)||"Failed to update role";o.error(i)}}):a.post("/admin-portal/roles",e,{preserveScroll:!0,onSuccess:()=>{d(!1),l.resetFields(),o.success("Role created successfully")},onError:t=>{const i=(t==null?void 0:t.message)||"Failed to create role";o.error(i)}})})},K=e=>{j(e),x(""),S(!0)},W=()=>{n&&a.delete(`/admin-portal/roles/${n.id}`,{onSuccess:()=>{S(!1),j(null),x(""),o.success("Role deleted successfully")},onError:e=>{const t=(e==null?void 0:e.message)||"Failed to delete role";o.error(t)}})},J=e=>{console.log("Fetching permissions for role:",e.id),window.axios.get(`/admin-portal/roles/${e.id}/permissions`).then(t=>{console.log("Response received:",t);const{role:i,permissions:_}=t.data;w(i),T(_),p.setFieldsValue({permissions:_}),R(!0)}).catch(t=>{console.error("Full error object:",t),console.error("Error response:",t.response),console.error("Error message:",t.message),o.error("Failed to load role permissions")})},Q=()=>{p.validateFields().then(e=>{a.post(`/admin-portal/roles/${f.id}/sync-permissions`,e,{preserveScroll:!0,onSuccess:()=>{R(!1),w(null),p.resetFields(),o.success("Permissions updated successfully")},onError:t=>{const i=(t==null?void 0:t.message)||"Failed to update permissions";o.error(i)}})})},b=e=>["admin","secretary","member"].includes(e),X=e=>{const t=[{key:"permissions",label:"Manage Permissions",icon:s.jsx(D,{}),onClick:()=>J(e)}];return b(e.name)||(t.push({key:"edit",label:"Edit",icon:s.jsx(ue,{}),onClick:()=>Z(e)}),t.push({key:"delete",label:"Delete",icon:s.jsx(he,{}),danger:!0,onClick:()=>K(e)})),t},ee=[{title:"Role Name",dataIndex:"name",key:"name",width:180,render:e=>s.jsxs(C,{children:[s.jsx(de,{style:{fontSize:"14px"}}),s.jsx(O,{strong:!0,style:{fontSize:"13px"},children:e}),b(e)&&s.jsx(pe,{color:"gold",style:{fontSize:"10px"},children:"SYSTEM"})]})},{title:"Description",dataIndex:"description",key:"description",ellipsis:!0,render:e=>s.jsx("span",{style:{fontSize:"13px"},children:e||"-"})},{title:"Users",dataIndex:"users_count",key:"users_count",width:100,align:"center",render:e=>s.jsx(A,{count:e,showZero:!0,style:{backgroundColor:v.colorPrimary},overflowCount:999})},{title:"Permissions",dataIndex:"permissions_count",key:"permissions_count",width:120,align:"center",render:e=>s.jsx(A,{count:e,showZero:!0,style:{backgroundColor:v.colorSuccess},overflowCount:999})},{title:"Actions",key:"actions",width:70,fixed:"right",render:(e,t)=>s.jsx(ne,{menu:{items:X(t)},trigger:["click"],children:s.jsx(g,{type:"text",size:"small",icon:s.jsx(me,{})})})}];return s.jsxs(te,{children:[N,s.jsxs(oe,{children:[s.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px"},children:[s.jsxs(C,{wrap:!0,children:[s.jsx(y,{placeholder:"Search roles...",prefix:s.jsx(ie,{}),value:E,onChange:e=>M(e.target.value),onPressEnter:P,style:{width:250},allowClear:!0}),s.jsx(g,{onClick:P,type:"primary",children:"Search"}),s.jsx(g,{onClick:V,children:"Reset"})]}),s.jsx(g,{type:"primary",icon:s.jsx(re,{}),onClick:Y,children:"Add Role"})]}),s.jsx(ae,{columns:ee,dataSource:m.data,rowKey:"id",size:"small",pagination:{current:m.current_page,pageSize:m.per_page,total:m.total,showSizeChanger:!1,showTotal:e=>s.jsxs("span",{style:{fontSize:"13px"},children:["Total ",e," roles"]}),onChange:e=>{a.get("/admin-portal/roles",{...F,page:e},{preserveState:!0,preserveScroll:!0})}},locale:{emptyText:s.jsx($,{description:"No roles found",image:$.PRESENTED_IMAGE_SIMPLE})}})]}),s.jsx(k,{title:u?"Edit Role":"Add New Role",open:U,onCancel:()=>{d(!1),h(null),l.resetFields()},onOk:G,okText:u?"Update":"Create",width:600,children:s.jsxs(c,{form:l,layout:"vertical",style:{marginTop:"24px"},children:[s.jsx(c.Item,{label:"Role Name",name:"name",rules:[{required:!0,message:"Please enter role name"},{pattern:/^[a-z_]+$/,message:"Use lowercase with underscores only (e.g., custom_role)"}],extra:"Use lowercase letters and underscores only (e.g., custom_role)",children:s.jsx(y,{placeholder:"e.g., custom_role"})}),s.jsx(c.Item,{label:"Description",name:"description",children:s.jsx(xe,{rows:3,placeholder:"Brief description of this role"})})]})}),s.jsxs(k,{title:"Delete Role",open:q,onCancel:()=>{S(!1),j(null),x("")},onOk:W,okText:"Delete",okButtonProps:{danger:!0,disabled:I!==(n==null?void 0:n.name)},children:[s.jsxs("p",{children:['Are you sure you want to delete role "',n==null?void 0:n.name,'"?']}),s.jsx("p",{children:"Type the role name to confirm:"}),s.jsx(y,{value:I,onChange:e=>x(e.target.value),placeholder:"Type role name here"})]}),s.jsx(k,{title:`Manage Permissions: ${(f==null?void 0:f.name)||""}`,open:H,onCancel:()=>{R(!1),w(null),p.resetFields()},onOk:Q,okText:"Update Permissions",width:700,styles:{body:{maxHeight:"calc(100vh - 250px)",overflowY:"auto"}},children:s.jsx(c,{form:p,layout:"vertical",style:{marginTop:"24px"},children:s.jsx(c.Item,{label:`Select Permissions (${L.length} selected)`,name:"permissions",rules:[{required:!0,message:"Please select at least one permission"}],children:s.jsx(z,{mode:"multiple",placeholder:"Select permissions",style:{width:"100%"},onChange:T,optionFilterProp:"children",showSearch:!0,children:B.map(e=>s.jsx(z.Option,{value:e.id,children:s.jsxs(C,{children:[s.jsx(D,{style:{fontSize:"12px"}}),s.jsx("span",{children:e.name}),e.description&&s.jsxs(O,{type:"secondary",style:{fontSize:"11px"},children:["- ",e.description]})]})},e.id))})})})})]})}export{We as default};
