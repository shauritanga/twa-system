import{a as $,r as p,j as e,S as u}from"./app-CCWscn4N.js";import{B as g,A as W,C as J,S as Q,c as ee,D as te,n as re}from"./AdminSidebarLayout-BHFbP-0Z.js";import{d as C}from"./dayjs.min-Be2yCFt4.js";import{F as c}from"./index-C7rJnUG_.js";import{I as S}from"./index-BFcOIicW.js";import{T as oe}from"./index-Djf7ccgm.js";import{D as F}from"./index-D2nthcHU.js";import{S as m}from"./index-C-HA1eIq.js";import{U as ae}from"./index-gadxCu6H.js";import{R as se}from"./UploadOutlined-Ccf63Knl.js";import{s as ne}from"./index-BhyvampS.js";import{R as le}from"./useIcons-Bh5YfX0K.js";import{F as ie}from"./Table-DUVIRzZL.js";import{E as P}from"./index-CdwOtgdH.js";import{M as A}from"./index-BhSHgn0Z.js";import{T as ce}from"./index-CCn2kg36.js";import{R as de}from"./MoreOutlined-D2Cbkv-l.js";import{R as pe}from"./CheckCircleOutlined-jfc3C_4A.js";import{R as me}from"./CloseCircleOutlined-9LFhVxSu.js";import{R as ue}from"./DownloadOutlined-DAAaMqUK.js";import{R as xe}from"./DeleteOutlined-S1oeFgow.js";import{R as he}from"./EditOutlined-BgapihRa.js";import{T as fe}from"./index-iEk3Z0oW.js";import"./SessionTimeout-72mUHhjZ.js";import"./Modal-CTkSowC8.js";import"./transition-BcOJrHw_.js";import"./PrimaryButton-0XQdD5oU.js";import"./SecondaryButton-DbLXN_Wj.js";import"./CSSMotionList-CEJCmY9t.js";import"./useForm-CpR6UdBL.js";import"./row-BLaRi8TG.js";import"./CheckCircleFilled-B-8ZM7Vi.js";import"./InfoCircleFilled-BBeUonew.js";import"./Input-Br3Lt1rS.js";import"./getAllowClear-ggc3xdDv.js";import"./EyeOutlined-BXjcMdGf.js";import"./TextArea-n8YGhIra.js";import"./DownOutlined-B9GtLQuW.js";import"./CalendarOutlined-eixNbCoN.js";import"./ClockCircleOutlined-BGBypZha.js";import"./progress-KqQtMOrv.js";import"./index-5hnhc-Y9.js";const{TextArea:O}=S,{Option:Y}=m,ge=["Utilities","Maintenance","Events","Salaries","Office Supplies","Transportation","Communication","Insurance","Legal & Professional","Marketing","Training","Other"],je=["Cash","Bank Transfer","Mobile Money","Cheque","Credit Card"];function ye({expense:n,onSubmit:d,onCancel:a}){const[j]=c.useForm(),{token:o}=$.useToken();p.useEffect(()=>{n?j.setFieldsValue({...n,expense_date:n.expense_date?C(n.expense_date):null}):j.resetFields()},[n,j]);const x=r=>{const l=new FormData;Object.keys(r).forEach(s=>{var y;r[s]!==void 0&&r[s]!==null&&(s==="expense_date"?l.append(s,r[s].format("YYYY-MM-DD")):s==="receipt"&&((y=r[s])!=null&&y.file)?l.append(s,r[s].file.originFileObj):s!=="receipt"&&l.append(s,r[s]))}),n&&l.append("_method","PUT"),d(l)};return e.jsxs(c,{form:j,layout:"vertical",onFinish:x,initialValues:{expense_date:C(),category:"Other"},children:[e.jsx(c.Item,{name:"title",label:"Expense Title",rules:[{required:!0,message:"Please enter expense title"}],children:e.jsx(S,{placeholder:"e.g., Office Rent Payment",style:{backgroundColor:o.colorBgContainer,color:o.colorText}})}),e.jsx(c.Item,{name:"description",label:"Description",children:e.jsx(O,{rows:3,placeholder:"Detailed description of the expense",style:{backgroundColor:o.colorBgContainer,color:o.colorText}})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(c.Item,{name:"amount",label:"Amount (TZS)",rules:[{required:!0,message:"Please enter amount"}],children:e.jsx(oe,{style:{width:"100%",backgroundColor:o.colorBgContainer,color:o.colorText},min:0,formatter:r=>`${r}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:r=>r.replace(/,/g,""),placeholder:"0.00"})}),e.jsx(c.Item,{name:"expense_date",label:"Expense Date",rules:[{required:!0,message:"Please select date"}],children:e.jsx(F,{style:{width:"100%",backgroundColor:o.colorBgContainer,color:o.colorText}})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(c.Item,{name:"category",label:"Category",rules:[{required:!0,message:"Please select category"}],children:e.jsx(m,{placeholder:"Select category",style:{backgroundColor:o.colorBgContainer},children:ge.map(r=>e.jsx(Y,{value:r,children:r},r))})}),e.jsx(c.Item,{name:"payment_method",label:"Payment Method",children:e.jsx(m,{placeholder:"Select payment method",allowClear:!0,style:{backgroundColor:o.colorBgContainer},children:je.map(r=>e.jsx(Y,{value:r,children:r},r))})})]}),e.jsx(c.Item,{name:"vendor",label:"Vendor/Payee",children:e.jsx(S,{placeholder:"Name of vendor or person paid",style:{backgroundColor:o.colorBgContainer,color:o.colorText}})}),e.jsx(c.Item,{name:"receipt",label:"Receipt/Attachment",valuePropName:"file",children:e.jsx(ae,{maxCount:1,beforeUpload:()=>!1,accept:".pdf,.jpg,.jpeg,.png",children:e.jsx(g,{icon:e.jsx(se,{}),children:"Upload Receipt"})})}),e.jsx(c.Item,{name:"notes",label:"Additional Notes",children:e.jsx(O,{rows:2,placeholder:"Any additional information",style:{backgroundColor:o.colorBgContainer,color:o.colorText}})}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"24px"},children:[e.jsx(g,{onClick:a,children:"Cancel"}),e.jsxs(g,{type:"primary",htmlType:"submit",children:[n?"Update":"Create"," Expense"]})]})]})}const{RangePicker:Ce}=F,{Text:dt}=fe,Se=["Utilities","Maintenance","Events","Salaries","Office Supplies","Transportation","Communication","Insurance","Legal & Professional","Marketing","Training","Other"];function pt({expenses:n,filters:d}){$.useToken();const[a,j]=ne.useMessage(),[o,x]=p.useState(!1),[r,l]=p.useState(null),[s,y]=p.useState(!1),[h,T]=p.useState(null),[k,E]=p.useState(""),[v,b]=p.useState(d.search||""),[I,w]=p.useState(d.category||null),[M,R]=p.useState(d.status||null),[f,D]=p.useState(d.start_date&&d.end_date?[C(d.start_date),C(d.end_date)]:null),_=()=>{var t,i;u.get("/admin-portal/expenses",{search:v,category:I,status:M,start_date:(t=f==null?void 0:f[0])==null?void 0:t.format("YYYY-MM-DD"),end_date:(i=f==null?void 0:f[1])==null?void 0:i.format("YYYY-MM-DD")},{preserveState:!0,preserveScroll:!0})},B=()=>{b(""),w(null),R(null),D(null),u.get("/admin-portal/expenses",{},{preserveState:!0,preserveScroll:!0})},N=()=>{l(null),x(!0)},U=t=>{l(t),x(!0)},q=t=>{r?u.post(`/admin-portal/expenses/${r.id}`,t,{onSuccess:()=>{x(!1),l(null),a.success("Expense updated successfully")},onError:()=>{a.error("Failed to update expense")}}):u.post("/admin-portal/expenses",t,{onSuccess:()=>{x(!1),a.success("Expense created successfully")},onError:()=>{a.error("Failed to create expense")}})},L=t=>{T(t),E(""),y(!0)},V=()=>{h&&u.delete(`/admin-portal/expenses/${h.id}`,{onSuccess:()=>{y(!1),T(null),E(""),a.success("Expense deleted successfully")},onError:()=>{a.error("Failed to delete expense")}})},G=t=>{u.post(`/admin-portal/expenses/${t.id}/approve`,{},{onSuccess:()=>{a.success("Expense approved successfully")},onError:()=>{a.error("Failed to approve expense")}})},H=t=>{u.post(`/admin-portal/expenses/${t.id}/reject`,{},{onSuccess:()=>{a.success("Expense rejected successfully")},onError:()=>{a.error("Failed to reject expense")}})},X=t=>{u.post(`/admin-portal/expenses/${t.id}/mark-as-paid`,{},{onSuccess:()=>{a.success("Expense marked as paid successfully")},onError:()=>{a.error("Failed to mark expense as paid")}})},z=t=>({pending:"orange",approved:"blue",paid:"green",rejected:"red"})[t]||"default",Z=t=>{const i=[{key:"edit",label:"Edit",icon:e.jsx(he,{}),onClick:()=>U(t)}];return t.status==="pending"&&i.push({key:"approve",label:"Approve",icon:e.jsx(pe,{}),onClick:()=>G(t)},{key:"reject",label:"Reject",icon:e.jsx(me,{}),onClick:()=>H(t)}),t.status==="approved"&&i.push({key:"mark-paid",label:"Mark as Paid",icon:e.jsx(re,{}),onClick:()=>X(t)}),t.receipt_path&&i.push({key:"download",label:"Download Receipt",icon:e.jsx(ue,{}),onClick:()=>window.open(`/storage/${t.receipt_path}`,"_blank")}),i.push({key:"delete",label:"Delete",icon:e.jsx(xe,{}),danger:!0,onClick:()=>L(t)}),i},K=[{title:"Date",dataIndex:"expense_date",key:"expense_date",width:110,render:t=>C(t).format("MMM DD, YYYY")},{title:"Title",dataIndex:"title",key:"title",width:200,ellipsis:!0},{title:"Category",dataIndex:"category",key:"category",width:130},{title:"Vendor",dataIndex:"vendor",key:"vendor",width:130,ellipsis:!0,render:t=>t||"-"},{title:"Amount",dataIndex:"amount",key:"amount",width:130,align:"right",render:t=>`TZS ${parseFloat(t).toLocaleString()}`},{title:"Status",dataIndex:"status",key:"status",width:100,render:t=>e.jsx(ce,{color:z(t),children:t.toUpperCase()})},{title:"Created By",dataIndex:"creator",key:"creator",width:130,ellipsis:!0,render:t=>(t==null?void 0:t.name)||"-"},{title:"Actions",key:"actions",width:80,fixed:"right",render:(t,i)=>e.jsx(te,{menu:{items:Z(i)},trigger:["click"],children:e.jsx(g,{type:"text",icon:e.jsx(de,{})})})}];return e.jsxs(W,{children:[j,e.jsxs(J,{children:[e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px"},children:[e.jsxs(Q,{wrap:!0,children:[e.jsx(S,{placeholder:"Search expenses...",prefix:e.jsx(le,{}),value:v,onChange:t=>b(t.target.value),onPressEnter:_,style:{width:250},allowClear:!0}),e.jsx(m,{placeholder:"Category",value:I,onChange:w,style:{width:150},allowClear:!0,children:Se.map(t=>e.jsx(m.Option,{value:t,children:t},t))}),e.jsxs(m,{placeholder:"Status",value:M,onChange:R,style:{width:120},allowClear:!0,children:[e.jsx(m.Option,{value:"pending",children:"Pending"}),e.jsx(m.Option,{value:"approved",children:"Approved"}),e.jsx(m.Option,{value:"paid",children:"Paid"}),e.jsx(m.Option,{value:"rejected",children:"Rejected"})]}),e.jsx(Ce,{value:f,onChange:D,format:"YYYY-MM-DD"}),e.jsx(g,{onClick:_,type:"primary",children:"Search"}),e.jsx(g,{onClick:B,children:"Reset"})]}),e.jsx(g,{type:"primary",icon:e.jsx(ee,{}),onClick:N,children:"Add Expense"})]}),e.jsx(ie,{columns:K,dataSource:n.data,rowKey:"id",pagination:{current:n.current_page,pageSize:n.per_page,total:n.total,showSizeChanger:!1,showTotal:t=>`Total ${t} expenses`,onChange:t=>{u.get("/admin-portal/expenses",{...d,page:t},{preserveState:!0,preserveScroll:!0})}},locale:{emptyText:e.jsx(P,{description:"No expenses found",image:P.PRESENTED_IMAGE_SIMPLE})},scroll:{x:1100}})]}),e.jsx(A,{title:r?"Edit Expense":"Add New Expense",open:o,onCancel:()=>{x(!1),l(null)},footer:null,width:800,styles:{body:{maxHeight:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden",paddingRight:"24px"}},children:e.jsx(ye,{expense:r,onSubmit:q,onCancel:()=>{x(!1),l(null)}})}),e.jsxs(A,{title:"Delete Expense",open:s,onCancel:()=>{y(!1),T(null),E("")},onOk:V,okText:"Delete",okButtonProps:{danger:!0,disabled:k!==(h==null?void 0:h.title)},children:[e.jsxs("p",{children:['Are you sure you want to delete "',h==null?void 0:h.title,'"?']}),e.jsx("p",{children:"Type the expense title to confirm:"}),e.jsx(S,{value:k,onChange:t=>E(t.target.value),placeholder:"Type expense title here"})]})]})}export{pt as default};
