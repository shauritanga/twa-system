import{a as J,r as c,j as e,S as v,J as re}from"./app-CCWscn4N.js";import{A as le,B as w,c as N,C as U,S as ne,D as se,a as ae}from"./AdminSidebarLayout-BHFbP-0Z.js";import{d as y}from"./dayjs.min-Be2yCFt4.js";import{F as s}from"./index-C7rJnUG_.js";import{M as H}from"./index-BhSHgn0Z.js";import{I as j}from"./index-BFcOIicW.js";import{R as A,C as x}from"./row-BLaRi8TG.js";import{S as p}from"./index-C-HA1eIq.js";import{D as $}from"./index-D2nthcHU.js";import{R,C as ie,F as ce}from"./Table-DUVIRzZL.js";import{U as M}from"./index-gadxCu6H.js";import{R as G}from"./InboxOutlined-DE-_a2QQ.js";import{T as de}from"./index-Djf7ccgm.js";import{s as u}from"./index-BhyvampS.js";import{R as me}from"./useIcons-Bh5YfX0K.js";import{E as W}from"./index-CdwOtgdH.js";import{T as F}from"./index-CCn2kg36.js";import{B as pe}from"./index-D1VSToI4.js";import{R as z}from"./StarOutlined-CiDyMV7B.js";import{R as ue}from"./MoreOutlined-D2Cbkv-l.js";import{R as xe}from"./EyeOutlined-BXjcMdGf.js";import{R as he}from"./EditOutlined-BgapihRa.js";import{R as ge}from"./DeleteOutlined-S1oeFgow.js";import{R as je}from"./CalendarOutlined-eixNbCoN.js";import{R as ye}from"./InfoCircleOutlined-BEo2mVkY.js";import"./SessionTimeout-72mUHhjZ.js";import"./Modal-CTkSowC8.js";import"./transition-BcOJrHw_.js";import"./PrimaryButton-0XQdD5oU.js";import"./SecondaryButton-DbLXN_Wj.js";import"./CSSMotionList-CEJCmY9t.js";import"./useForm-CpR6UdBL.js";import"./CheckCircleFilled-B-8ZM7Vi.js";import"./InfoCircleFilled-BBeUonew.js";import"./Input-Br3Lt1rS.js";import"./getAllowClear-ggc3xdDv.js";import"./TextArea-n8YGhIra.js";import"./ClockCircleOutlined-BGBypZha.js";import"./DownOutlined-B9GtLQuW.js";import"./index-5hnhc-Y9.js";import"./DownloadOutlined-DAAaMqUK.js";import"./progress-KqQtMOrv.js";const{TextArea:fe}=j,{Dragger:q}=M;function Ce({open:g,onCancel:k,announcement:l=null}){const{token:t}=J.useToken(),[i]=s.useForm(),[h,f]=c.useState([]),[C,_]=c.useState([]),[I,b]=c.useState((l==null?void 0:l.media_type)||"none"),[E,O]=c.useState(!1),d=!!l;c.useEffect(()=>{g&&(d?(i.setFieldsValue({title:l.title,content:l.content,type:l.type,status:l.status,link_url:l.link_url,link_text:l.link_text,video_url:l.video_url,media_type:l.media_type,image_alt_text:l.image_alt_text,announcement_date:l.announcement_date?y(l.announcement_date):null,expires_at:l.expires_at?y(l.expires_at):null,is_featured:l.is_featured,sort_order:l.sort_order||0}),b(l.media_type)):(i.resetFields(),f([]),_([]),b("none")))},[g,l,d]);const D=o=>{O(!0);const n=new FormData;if(d&&n.append("_method","PUT"),n.append("title",o.title),n.append("content",o.content),n.append("type",o.type),n.append("status",o.status),n.append("link_url",o.link_url||""),n.append("link_text",o.link_text||""),n.append("media_type",o.media_type),n.append("video_url",o.video_url||""),n.append("image_alt_text",o.image_alt_text||""),n.append("announcement_date",o.announcement_date?y(o.announcement_date).format("YYYY-MM-DD"):""),n.append("expires_at",o.expires_at?y(o.expires_at).format("YYYY-MM-DD"):""),n.append("is_featured",o.is_featured?"1":"0"),n.append("sort_order",o.sort_order||0),h.length>0&&o.media_type==="image"){const a=h[0].originFileObj||h[0];n.append("image_file",a)}if(C.length>0&&o.media_type==="video"){const a=C[0].originFileObj||C[0];n.append("video_file",a)}const T=d?route("admin-portal.announcements.update",l.id):route("admin-portal.announcements.store");v.post(T,n,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{u.success(d?"Announcement updated successfully":"Announcement created successfully"),S()},onError:a=>{console.error("Announcement submission errors:",a),a.title?u.error(a.title):a.image_file?u.error(a.image_file):a.video_file?u.error(a.video_file):u.error(d?"Failed to update announcement":"Failed to create announcement")},onFinish:()=>{O(!1)}})},S=()=>{i.resetFields(),f([]),_([]),b("none"),k()},L={beforeUpload:o=>o.type.startsWith("image/")?o.size/1024/1024<5?(f([{uid:o.uid,name:o.name,status:"done",originFileObj:o}]),!1):(u.error("Image must be smaller than 5MB"),M.LIST_IGNORE):(u.error("You can only upload image files!"),M.LIST_IGNORE),fileList:h,onRemove:()=>{f([])},maxCount:1},B={beforeUpload:o=>o.type.startsWith("video/")?o.size/1024/1024<50?(_([{uid:o.uid,name:o.name,status:"done",originFileObj:o}]),!1):(u.error("Video must be smaller than 50MB"),M.LIST_IGNORE):(u.error("You can only upload video files!"),M.LIST_IGNORE),fileList:C,onRemove:()=>{_([])},maxCount:1};return e.jsx(H,{title:d?"Edit Announcement":"Create Announcement",open:g,onCancel:S,onOk:()=>i.submit(),confirmLoading:E,width:900,centered:!0,okText:d?"Update":"Create",cancelText:"Cancel",destroyOnClose:!0,styles:{body:{maxHeight:"calc(100vh - 240px)",overflowY:"auto",overflowX:"hidden",paddingBottom:"16px",paddingRight:"24px"},mask:{backgroundColor:"rgba(0, 0, 0, 0.45)"}},children:e.jsxs(s,{form:i,layout:"vertical",onFinish:D,initialValues:{type:"general",status:"draft",media_type:"none",is_featured:!1,sort_order:0},style:{color:t.colorText},children:[e.jsx(s.Item,{label:"Title",name:"title",rules:[{required:!0,message:"Please enter announcement title"}],labelCol:{style:{color:t.colorText}},children:e.jsx(j,{placeholder:"Enter announcement title",style:{backgroundColor:t.colorBgContainer,borderColor:t.colorBorder,color:t.colorText}})}),e.jsx(s.Item,{label:"Content",name:"content",rules:[{required:!0,message:"Please enter announcement content"}],labelCol:{style:{color:t.colorText}},children:e.jsx(fe,{rows:6,placeholder:"Enter announcement content",style:{backgroundColor:t.colorBgContainer,borderColor:t.colorBorder,color:t.colorText}})}),e.jsxs(A,{gutter:16,children:[e.jsx(x,{xs:24,sm:12,children:e.jsx(s.Item,{label:"Type",name:"type",rules:[{required:!0,message:"Please select type"}],labelCol:{style:{color:t.colorText}},children:e.jsxs(p,{style:{color:t.colorText},children:[e.jsx(p.Option,{value:"important",children:"Important"}),e.jsx(p.Option,{value:"event",children:"Event"}),e.jsx(p.Option,{value:"update",children:"Update"}),e.jsx(p.Option,{value:"general",children:"General"})]})})}),e.jsx(x,{xs:24,sm:12,children:e.jsx(s.Item,{label:"Status",name:"status",rules:[{required:!0,message:"Please select status"}],labelCol:{style:{color:t.colorText}},children:e.jsxs(p,{style:{color:t.colorText},children:[e.jsx(p.Option,{value:"active",children:"Active"}),e.jsx(p.Option,{value:"inactive",children:"Inactive"}),e.jsx(p.Option,{value:"draft",children:"Draft"})]})})})]}),e.jsxs(A,{gutter:16,children:[e.jsx(x,{xs:24,sm:12,children:e.jsx(s.Item,{label:"Announcement Date",name:"announcement_date",rules:[{required:!0,message:"Please select date"}],labelCol:{style:{color:t.colorText}},children:e.jsx($,{style:{width:"100%",backgroundColor:t.colorBgContainer,borderColor:t.colorBorder,color:t.colorText}})})}),e.jsx(x,{xs:24,sm:12,children:e.jsx(s.Item,{label:"Expires At (Optional)",name:"expires_at",labelCol:{style:{color:t.colorText}},children:e.jsx($,{style:{width:"100%",backgroundColor:t.colorBgContainer,borderColor:t.colorBorder,color:t.colorText}})})})]}),e.jsx(s.Item,{label:"Media Type",name:"media_type",labelCol:{style:{color:t.colorText}},children:e.jsxs(R.Group,{onChange:o=>b(o.target.value),children:[e.jsx(R,{value:"none",children:"None"}),e.jsx(R,{value:"image",children:"Image"}),e.jsx(R,{value:"video",children:"Video File"}),e.jsx(R,{value:"video_url",children:"Video URL"})]})}),I==="image"&&e.jsxs(e.Fragment,{children:[e.jsx(s.Item,{label:"Upload Image",help:d&&l.image_path?`Current: ${l.image_path}`:"JPEG, PNG, GIF, WebP up to 5MB",labelCol:{style:{color:t.colorText}},children:e.jsxs(q,{...L,style:{backgroundColor:t.colorBgContainer,borderColor:t.colorBorder},children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(G,{style:{color:t.colorPrimary}})}),e.jsx("p",{className:"ant-upload-text",style:{color:t.colorText},children:"Click or drag image to upload"})]})}),e.jsx(s.Item,{label:"Image Alt Text",name:"image_alt_text",labelCol:{style:{color:t.colorText}},children:e.jsx(j,{placeholder:"Enter image description",style:{backgroundColor:t.colorBgContainer,borderColor:t.colorBorder,color:t.colorText}})})]}),I==="video"&&e.jsx(s.Item,{label:"Upload Video",help:d&&l.video_path?`Current: ${l.video_path}`:"MP4, AVI, MOV, WMV, FLV, WebM up to 50MB",labelCol:{style:{color:t.colorText}},children:e.jsxs(q,{...B,style:{backgroundColor:t.colorBgContainer,borderColor:t.colorBorder},children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(G,{style:{color:t.colorPrimary}})}),e.jsx("p",{className:"ant-upload-text",style:{color:t.colorText},children:"Click or drag video to upload"})]})}),I==="video_url"&&e.jsx(s.Item,{label:"Video URL",name:"video_url",help:"YouTube, Vimeo, or direct video URL",labelCol:{style:{color:t.colorText}},children:e.jsx(j,{placeholder:"https://www.youtube.com/watch?v=...",style:{backgroundColor:t.colorBgContainer,borderColor:t.colorBorder,color:t.colorText}})}),e.jsxs(A,{gutter:16,children:[e.jsx(x,{xs:24,sm:12,children:e.jsx(s.Item,{label:"Link URL (Optional)",name:"link_url",labelCol:{style:{color:t.colorText}},children:e.jsx(j,{placeholder:"https://example.com",style:{backgroundColor:t.colorBgContainer,borderColor:t.colorBorder,color:t.colorText}})})}),e.jsx(x,{xs:24,sm:12,children:e.jsx(s.Item,{label:"Link Text (Optional)",name:"link_text",labelCol:{style:{color:t.colorText}},children:e.jsx(j,{placeholder:"Read More",style:{backgroundColor:t.colorBgContainer,borderColor:t.colorBorder,color:t.colorText}})})})]}),e.jsxs(A,{gutter:16,children:[e.jsx(x,{xs:24,sm:12,children:e.jsx(s.Item,{name:"is_featured",valuePropName:"checked",children:e.jsx(ie,{style:{color:t.colorText},children:"Featured Announcement"})})}),e.jsx(x,{xs:24,sm:12,children:e.jsx(s.Item,{label:"Sort Order",name:"sort_order",labelCol:{style:{color:t.colorText}},children:e.jsx(de,{min:0,style:{width:"100%",backgroundColor:t.colorBgContainer,borderColor:t.colorBorder,color:t.colorText}})})})]})]})})}function ct(){const{announcements:g={data:[]},filters:k={},types:l={},statuses:t={},flash:i={}}=re().props,{token:h}=J.useToken(),[f,C]=c.useState(k.search||""),[_,I]=c.useState(k.type||""),[b,E]=c.useState(k.status||""),[O,d]=c.useState(!1),[D,S]=c.useState(null),[L,B]=c.useState(!1),[o,n]=c.useState(null),[T,a]=c.useState("");c.useEffect(()=>{i!=null&&i.success&&u.success(i.success),i!=null&&i.error&&u.error(i.error)},[i]);const Y=(r=null)=>{S(r),d(!0)},K=()=>{d(!1),S(null)},V=()=>{v.get(route("admin-portal.announcements.index"),{search:f,type:_,status:b},{preserveState:!0,preserveScroll:!0})},X=()=>{C(""),I(""),E(""),v.get(route("admin-portal.announcements.index"))},Q=r=>{n(r),a(""),B(!0)},Z=()=>{!o||T!==o.title||v.delete(route("admin-portal.announcements.destroy",o.id),{onSuccess:()=>{u.success(`"${o.title}" deleted successfully`),B(!1),n(null),a("")},onError:()=>{u.error("Failed to delete announcement")}})},ee=r=>{const m={important:"red",event:"green",update:"blue",general:"default"},P={important:e.jsx(ye,{}),event:e.jsx(je,{}),update:e.jsx(ae,{}),general:e.jsx(z,{})};return e.jsx(F,{color:m[r],icon:P[r],children:l[r]})},te=r=>r.status==="draft"?e.jsx(F,{color:"default",children:"Draft"}):r.status==="inactive"?e.jsx(F,{color:"warning",children:"Inactive"}):r.expires_at&&y(r.expires_at).isBefore(y())?e.jsx(F,{color:"error",children:"Expired"}):e.jsx(F,{color:"success",children:"Active"}),oe=[{title:"Announcement",dataIndex:"title",key:"title",width:"30%",render:(r,m)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[m.is_featured&&e.jsx(pe,{count:e.jsx(z,{style:{color:h.colorWarning}})}),e.jsx("span",{style:{fontWeight:"bold",color:h.colorText},children:r})]})},{title:"Type",dataIndex:"type",key:"type",width:"12%",render:r=>ee(r)},{title:"Status",key:"status",width:"12%",render:(r,m)=>te(m)},{title:"Date",dataIndex:"announcement_date",key:"announcement_date",width:"12%",render:r=>y(r).format("DD MMM YYYY")},{title:"Expires",dataIndex:"expires_at",key:"expires_at",width:"12%",render:r=>r?y(r).format("DD MMM YYYY"):"-"},{title:"Created By",dataIndex:["creator","name"],key:"creator",width:"12%",ellipsis:!0},{title:"Actions",key:"actions",width:"10%",render:(r,m)=>{const P=[{key:"view",label:"View",icon:e.jsx(xe,{}),onClick:()=>v.visit(route("admin-portal.announcements.show",m.id))},{key:"edit",label:"Edit",icon:e.jsx(he,{}),onClick:()=>Y(m)},{key:"delete",label:"Delete",icon:e.jsx(ge,{}),danger:!0,onClick:()=>Q(m)}];return e.jsx(se,{menu:{items:P},trigger:["click"],children:e.jsx(w,{type:"text",icon:e.jsx(ue,{})})})}}];return e.jsx(le,{children:e.jsxs("div",{style:{padding:"24px 0"},children:[g.data&&g.data.length>0&&e.jsx("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"flex-end"},children:e.jsx(w,{type:"primary",icon:e.jsx(N,{}),size:"large",onClick:()=>Y(),children:"Create Announcement"})}),e.jsx(U,{style:{marginBottom:"24px"},children:e.jsxs(A,{gutter:[16,16],align:"middle",children:[e.jsx(x,{xs:24,sm:12,md:8,children:e.jsx(j,{placeholder:"Search announcements...",prefix:e.jsx(me,{}),value:f,onChange:r=>C(r.target.value),onPressEnter:V,allowClear:!0})}),e.jsx(x,{xs:24,sm:6,md:4,children:e.jsx(p,{placeholder:"Type",value:_||void 0,onChange:I,style:{width:"100%"},allowClear:!0,children:Object.entries(l).map(([r,m])=>e.jsx(p.Option,{value:r,children:m},r))})}),e.jsx(x,{xs:24,sm:6,md:4,children:e.jsx(p,{placeholder:"Status",value:b||void 0,onChange:E,style:{width:"100%"},allowClear:!0,children:Object.entries(t).map(([r,m])=>e.jsx(p.Option,{value:r,children:m},r))})}),e.jsx(x,{xs:24,md:8,style:{textAlign:"right"},children:e.jsxs(ne,{children:[e.jsx(w,{type:"primary",onClick:V,children:"Search"}),e.jsx(w,{onClick:X,children:"Clear"})]})})]})}),e.jsx(U,{children:e.jsx(ce,{columns:oe,dataSource:g.data||[],rowKey:"id",pagination:{current:g.current_page,pageSize:g.per_page,total:g.total,showSizeChanger:!0,showTotal:r=>`Total ${r} announcements`,onChange:r=>{v.get(route("admin-portal.announcements.index"),{...k,page:r})}},locale:{emptyText:e.jsx(W,{image:W.PRESENTED_IMAGE_SIMPLE,description:"No announcements found",children:e.jsx(w,{type:"primary",icon:e.jsx(N,{}),onClick:()=>Y(),children:"Create Your First Announcement"})})}})}),e.jsx(Ce,{open:O,onCancel:K,announcement:D}),e.jsxs(H,{title:"Delete Announcement",open:L,onCancel:()=>{B(!1),n(null),a("")},onOk:Z,okText:"Delete",cancelText:"Cancel",okButtonProps:{danger:!0,disabled:T!==(o==null?void 0:o.title)},centered:!0,styles:{mask:{backgroundColor:"rgba(0, 0, 0, 0.45)"}},children:[e.jsxs("p",{children:['Are you sure you want to delete "',o==null?void 0:o.title,'"?']}),e.jsx("p",{style:{color:h.colorTextSecondary,fontSize:"12px",marginBottom:"16px"},children:"This action cannot be undone. All associated media files will be permanently deleted."}),e.jsx("p",{style:{marginBottom:"8px"},children:"Type the announcement title to confirm:"}),e.jsx(j,{placeholder:"Enter announcement title",value:T,onChange:r=>a(r.target.value),style:{backgroundColor:h.colorBgContainer,borderColor:h.colorBorder,color:h.colorText}})]})]})})}export{ct as default};
