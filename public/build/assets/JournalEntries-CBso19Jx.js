import{r as a,a as te,j as e,S as g}from"./app-CCWscn4N.js";import{I as ye,B as b,c as re,A as ge,C as je,S as be,D as Se}from"./AdminSidebarLayout-BHFbP-0Z.js";import{d as j}from"./dayjs.min-Be2yCFt4.js";import{F as R}from"./index-C7rJnUG_.js";import{D as J}from"./index-D2nthcHU.js";import{I as _}from"./index-BFcOIicW.js";import{F as V}from"./Table-DUVIRzZL.js";import{T as O}from"./index-CCn2kg36.js";import{S as T}from"./index-C-HA1eIq.js";import{T as Q}from"./index-Djf7ccgm.js";import{R as ne}from"./DeleteOutlined-S1oeFgow.js";import{s as ve}from"./index-BhyvampS.js";import{R as we}from"./useIcons-Bh5YfX0K.js";import{E as ee}from"./index-CdwOtgdH.js";import{M as $}from"./index-BhSHgn0Z.js";import{D as k}from"./index-BVXbRpir.js";import{R as Ce}from"./MoreOutlined-D2Cbkv-l.js";import{R as ke}from"./EyeOutlined-BXjcMdGf.js";import{R as Te}from"./EditOutlined-BgapihRa.js";import{R as _e}from"./CheckCircleOutlined-jfc3C_4A.js";import{T as De}from"./index-iEk3Z0oW.js";import"./SessionTimeout-72mUHhjZ.js";import"./Modal-CTkSowC8.js";import"./transition-BcOJrHw_.js";import"./PrimaryButton-0XQdD5oU.js";import"./SecondaryButton-DbLXN_Wj.js";import"./CSSMotionList-CEJCmY9t.js";import"./useForm-CpR6UdBL.js";import"./row-BLaRi8TG.js";import"./CheckCircleFilled-B-8ZM7Vi.js";import"./InfoCircleFilled-BBeUonew.js";import"./CalendarOutlined-eixNbCoN.js";import"./ClockCircleOutlined-BGBypZha.js";import"./Input-Br3Lt1rS.js";import"./getAllowClear-ggc3xdDv.js";import"./TextArea-n8YGhIra.js";import"./DownOutlined-B9GtLQuW.js";import"./index-5hnhc-Y9.js";var Ee={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"};function Z(){return Z=Object.assign?Object.assign.bind():function(l){for(var h=1;h<arguments.length;h++){var p=arguments[h];for(var x in p)Object.prototype.hasOwnProperty.call(p,x)&&(l[x]=p[x])}return l},Z.apply(this,arguments)}const Ie=(l,h)=>a.createElement(ye,Z({},l,{ref:h,icon:Ee})),Re=a.forwardRef(Ie),{TextArea:Me}=_,{Option:Fe}=T;function Ye({entry:l,accounts:h,onSubmit:p,onCancel:x}){const[d]=R.useForm(),{token:f}=te.useToken(),[c,u]=a.useState([]),[y,S]=a.useState(0),[D,E]=a.useState(0);a.useEffect(()=>{l?(d.setFieldsValue({entry_date:l.entry_date?j(l.entry_date):null,reference:l.reference,description:l.description}),u(l.lines||[])):(d.resetFields(),d.setFieldsValue({entry_date:j()}),u([{account_id:null,description:"",debit:0,credit:0}]))},[l,d]),a.useEffect(()=>{const n=c.reduce((s,r)=>s+(parseFloat(r.debit)||0),0),i=c.reduce((s,r)=>s+(parseFloat(r.credit)||0),0);S(n),E(i)},[c]);const m=()=>{u([...c,{account_id:null,description:"",debit:0,credit:0}])},I=n=>{c.length>1&&u(c.filter((i,s)=>s!==n))},v=(n,i,s)=>{const r=[...c];r[n][i]=s,i==="debit"&&s>0?r[n].credit=0:i==="credit"&&s>0&&(r[n].debit=0),u(r)},C=n=>{if(c.some(s=>!s.account_id)||c.some(s=>s.debit>0&&s.credit>0||s.debit===0&&s.credit===0))return;const i={...n,entry_date:n.entry_date.format("YYYY-MM-DD"),lines:c};p(i)},M=Math.abs(y-D)<.01,F=[{title:"Account",dataIndex:"account_id",key:"account_id",width:"30%",render:(n,i,s)=>e.jsx(T,{value:n,onChange:r=>v(s,"account_id",r),placeholder:"Select account",style:{width:"100%"},showSearch:!0,optionFilterProp:"children",filterOption:(r,w)=>w.children.toLowerCase().includes(r.toLowerCase()),children:h==null?void 0:h.map(r=>e.jsxs(Fe,{value:r.id,children:[r.account_code," - ",r.account_name]},r.id))})},{title:"Description",dataIndex:"description",key:"description",width:"25%",render:(n,i,s)=>e.jsx(_,{value:n,onChange:r=>v(s,"description",r.target.value),placeholder:"Line description (optional)"})},{title:"Debit",dataIndex:"debit",key:"debit",width:"18%",render:(n,i,s)=>e.jsx(Q,{value:n,onChange:r=>v(s,"debit",r||0),style:{width:"100%"},min:0,formatter:r=>`${r}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:r=>r.replace(/,/g,""),placeholder:"0.00"})},{title:"Credit",dataIndex:"credit",key:"credit",width:"18%",render:(n,i,s)=>e.jsx(Q,{value:n,onChange:r=>v(s,"credit",r||0),style:{width:"100%"},min:0,formatter:r=>`${r}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:r=>r.replace(/,/g,""),placeholder:"0.00"})},{title:"Action",key:"action",width:"9%",render:(n,i,s)=>e.jsx(b,{type:"text",danger:!0,icon:e.jsx(ne,{}),onClick:()=>I(s),disabled:c.length===1})}];return e.jsxs(R,{form:d,layout:"vertical",onFinish:C,initialValues:{entry_date:j()},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(R.Item,{name:"entry_date",label:"Entry Date",rules:[{required:!0,message:"Please select date"}],children:e.jsx(J,{style:{width:"100%",backgroundColor:f.colorBgContainer,color:f.colorText}})}),e.jsx(R.Item,{name:"reference",label:"Reference",children:e.jsx(_,{placeholder:"Reference number or document",style:{backgroundColor:f.colorBgContainer,color:f.colorText}})})]}),e.jsx(R.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please enter description"}],children:e.jsx(Me,{rows:2,placeholder:"Journal entry description",style:{backgroundColor:f.colorBgContainer,color:f.colorText}})}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[e.jsx("strong",{children:"Journal Entry Lines"}),e.jsx(b,{type:"dashed",icon:e.jsx(re,{}),onClick:m,size:"small",children:"Add Line"})]}),e.jsx(V,{columns:F,dataSource:c,pagination:!1,rowKey:(n,i)=>i,size:"small",bordered:!0,footer:()=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:"bold"},children:[e.jsx("span",{children:"Total:"}),e.jsxs("div",{style:{display:"flex",gap:"16px"},children:[e.jsxs("span",{style:{width:"120px",textAlign:"right"},children:["TZS ",y.toLocaleString()]}),e.jsxs("span",{style:{width:"120px",textAlign:"right"},children:["TZS ",D.toLocaleString()]}),e.jsx("span",{style:{width:"40px"}})]})]})}),e.jsx("div",{style:{marginTop:"8px",textAlign:"right"},children:M?e.jsx(O,{color:"green",children:"✓ Balanced"}):e.jsxs(O,{color:"red",children:["✗ Not Balanced (Difference: TZS ",Math.abs(y-D).toLocaleString(),")"]})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"24px"},children:[e.jsx(b,{onClick:x,children:"Cancel"}),e.jsxs(b,{type:"primary",htmlType:"submit",disabled:!M||c.length<2,children:[l?"Update":"Create"," Entry"]})]})]})}const{Text:bt}=De,{TextArea:Le}=_;function St({entries:l,accounts:h,filters:p}){const{token:x}=te.useToken(),[d,f]=ve.useMessage(),[c,u]=a.useState(!1),[y,S]=a.useState(null),[D,E]=a.useState(!1),[m,I]=a.useState(null),[v,C]=a.useState(""),[M,F]=a.useState(!1),[n,i]=a.useState(null),[s,r]=a.useState(!1),[w,A]=a.useState(null),[Y,L]=a.useState(""),[z,N]=a.useState(p.search||""),[H,q]=a.useState(p.status||null),[B,K]=a.useState(p.date_from?j(p.date_from):null),[P,U]=a.useState(p.date_to?j(p.date_to):null),W=()=>{g.get("/admin-portal/journal-entries",{search:z,status:H,date_from:B?B.format("YYYY-MM-DD"):null,date_to:P?P.format("YYYY-MM-DD"):null},{preserveState:!0,preserveScroll:!0})},se=()=>{N(""),q(null),K(null),U(null),g.get("/admin-portal/journal-entries",{},{preserveState:!0,preserveScroll:!0})},oe=()=>{S(null),u(!0)},ae=t=>{S(t),u(!0)},le=t=>{i(t),F(!0)},ie=t=>{y?g.put(`/admin-portal/journal-entries/${y.id}`,t,{preserveScroll:!0,onSuccess:()=>{u(!1),S(null),d.success("Journal entry updated successfully")},onError:o=>{console.error("Validation errors:",o),d.error("Failed to update entry. Please check the form.")}}):g.post("/admin-portal/journal-entries",t,{preserveScroll:!0,onSuccess:()=>{u(!1),d.success("Journal entry created successfully")},onError:o=>{console.error("Validation errors:",o),d.error("Failed to create entry. Please check the form.")}})},de=t=>{I(t),C(""),E(!0)},ce=()=>{m&&g.delete(`/admin-portal/journal-entries/${m.id}`,{onSuccess:()=>{E(!1),I(null),C(""),d.success("Journal entry deleted successfully")},onError:t=>{const o=(t==null?void 0:t.message)||"Failed to delete entry";d.error(o)}})},pe=t=>{g.post(`/admin-portal/journal-entries/${t.id}/post`,{},{onSuccess:()=>{d.success("Journal entry posted successfully")},onError:o=>{const fe=(o==null?void 0:o.message)||"Failed to post entry";d.error(fe)}})},ue=t=>{A(t),L(""),r(!0)},he=()=>{w&&Y&&g.post(`/admin-portal/journal-entries/${w.id}/reverse`,{reversal_reason:Y},{onSuccess:()=>{r(!1),A(null),L(""),d.success("Journal entry reversed successfully")},onError:t=>{const o=(t==null?void 0:t.message)||"Failed to reverse entry";d.error(o)}})},G=t=>({draft:"default",posted:"green",reversed:"red"})[t]||"default",X=t=>({draft:"Draft",posted:"Posted",reversed:"Reversed"})[t]||t,me=t=>{const o=[];return o.push({key:"view",label:"View Details",icon:e.jsx(ke,{}),onClick:()=>le(t)}),t.status==="draft"&&(o.push({key:"edit",label:"Edit",icon:e.jsx(Te,{}),onClick:()=>ae(t)}),o.push({key:"post",label:"Post Entry",icon:e.jsx(_e,{}),onClick:()=>pe(t)}),o.push({key:"delete",label:"Delete",icon:e.jsx(ne,{}),danger:!0,onClick:()=>de(t)})),t.status==="posted"&&o.push({key:"reverse",label:"Reverse Entry",icon:e.jsx(Re,{}),danger:!0,onClick:()=>ue(t)}),o},xe=[{title:"Entry Number",dataIndex:"entry_number",key:"entry_number",width:140},{title:"Date",dataIndex:"entry_date",key:"entry_date",width:110,render:t=>j(t).format("MMM DD, YYYY")},{title:"Reference",dataIndex:"reference",key:"reference",width:120,ellipsis:!0,render:t=>t||"-"},{title:"Description",dataIndex:"description",key:"description",width:250,ellipsis:!0},{title:"Total Debit",dataIndex:"total_debit",key:"total_debit",width:130,align:"right",render:t=>`TZS ${parseFloat(t).toLocaleString()}`},{title:"Total Credit",dataIndex:"total_credit",key:"total_credit",width:130,align:"right",render:t=>`TZS ${parseFloat(t).toLocaleString()}`},{title:"Status",dataIndex:"status",key:"status",width:100,render:t=>e.jsx(O,{color:G(t),children:X(t).toUpperCase()})},{title:"Actions",key:"actions",width:80,fixed:"right",render:(t,o)=>e.jsx(Se,{menu:{items:me(o)},trigger:["click"],children:e.jsx(b,{type:"text",icon:e.jsx(Ce,{})})})}];return e.jsxs(ge,{children:[f,e.jsxs(je,{children:[e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px"},children:[e.jsxs(be,{wrap:!0,children:[e.jsx(_,{placeholder:"Search entries...",prefix:e.jsx(we,{}),value:z,onChange:t=>N(t.target.value),onPressEnter:W,style:{width:200},allowClear:!0}),e.jsxs(T,{placeholder:"Status",value:H,onChange:q,style:{width:120},allowClear:!0,children:[e.jsx(T.Option,{value:"draft",children:"Draft"}),e.jsx(T.Option,{value:"posted",children:"Posted"}),e.jsx(T.Option,{value:"reversed",children:"Reversed"})]}),e.jsx(J,{placeholder:"From Date",value:B,onChange:K,style:{width:140}}),e.jsx(J,{placeholder:"To Date",value:P,onChange:U,style:{width:140}}),e.jsx(b,{onClick:W,type:"primary",children:"Search"}),e.jsx(b,{onClick:se,children:"Reset"})]}),e.jsx(b,{type:"primary",icon:e.jsx(re,{}),onClick:oe,children:"New Entry"})]}),e.jsx(V,{columns:xe,dataSource:l.data,rowKey:"id",pagination:{current:l.current_page,pageSize:l.per_page,total:l.total,showSizeChanger:!1,showTotal:t=>`Total ${t} entries`,onChange:t=>{g.get("/admin-portal/journal-entries",{...p,page:t},{preserveState:!0,preserveScroll:!0})}},locale:{emptyText:e.jsx(ee,{description:"No journal entries found",image:ee.PRESENTED_IMAGE_SIMPLE})},scroll:{x:1200}})]}),e.jsx($,{title:y?"Edit Journal Entry":"New Journal Entry",open:c,onCancel:()=>{u(!1),S(null)},footer:null,width:1e3,styles:{body:{maxHeight:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden",paddingRight:"24px"}},children:e.jsx(Ye,{entry:y,accounts:h,onSubmit:ie,onCancel:()=>{u(!1),S(null)}})}),e.jsx($,{title:"Journal Entry Details",open:M,onCancel:()=>{F(!1),i(null)},footer:null,width:900,children:n&&e.jsxs("div",{children:[e.jsxs(k,{bordered:!0,column:2,size:"small",children:[e.jsx(k.Item,{label:"Entry Number",children:n.entry_number}),e.jsx(k.Item,{label:"Date",children:j(n.entry_date).format("MMM DD, YYYY")}),e.jsx(k.Item,{label:"Reference",children:n.reference||"-"}),e.jsx(k.Item,{label:"Status",children:e.jsx(O,{color:G(n.status),children:X(n.status).toUpperCase()})}),e.jsx(k.Item,{label:"Description",span:2,children:n.description})]}),e.jsxs("div",{style:{marginTop:"16px"},children:[e.jsx("strong",{children:"Entry Lines:"}),e.jsx(V,{dataSource:n.lines,rowKey:"id",pagination:!1,size:"small",style:{marginTop:"8px"},columns:[{title:"Account",dataIndex:"account",key:"account",render:t=>`${t.account_code} - ${t.account_name}`},{title:"Description",dataIndex:"description",key:"description",render:t=>t||"-"},{title:"Debit",dataIndex:"debit",key:"debit",align:"right",render:t=>t>0?`TZS ${parseFloat(t).toLocaleString()}`:"-"},{title:"Credit",dataIndex:"credit",key:"credit",align:"right",render:t=>t>0?`TZS ${parseFloat(t).toLocaleString()}`:"-"}],footer:()=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:"bold"},children:[e.jsx("span",{children:"Total:"}),e.jsxs("div",{style:{display:"flex",gap:"80px"},children:[e.jsxs("span",{children:["TZS ",parseFloat(n.total_debit).toLocaleString()]}),e.jsxs("span",{children:["TZS ",parseFloat(n.total_credit).toLocaleString()]})]})]})})]}),n.status==="reversed"&&e.jsxs("div",{style:{marginTop:"16px",padding:"12px",backgroundColor:x.colorErrorBg,borderRadius:"4px"},children:[e.jsx("strong",{children:"Reversal Information:"}),e.jsx("p",{style:{margin:"8px 0 0 0"},children:n.reversal_reason}),e.jsxs("p",{style:{margin:"4px 0 0 0",fontSize:"12px",color:x.colorTextSecondary},children:["Reversed on ",j(n.reversed_at).format("MMM DD, YYYY HH:mm")]})]})]})}),e.jsxs($,{title:"Delete Journal Entry",open:D,onCancel:()=>{E(!1),I(null),C("")},onOk:ce,okText:"Delete",okButtonProps:{danger:!0,disabled:v!==(m==null?void 0:m.entry_number)},children:[e.jsxs("p",{children:['Are you sure you want to delete entry "',m==null?void 0:m.entry_number,'"?']}),e.jsx("p",{children:"Type the entry number to confirm:"}),e.jsx(_,{value:v,onChange:t=>C(t.target.value),placeholder:"Type entry number here"})]}),e.jsxs($,{title:"Reverse Journal Entry",open:s,onCancel:()=>{r(!1),A(null),L("")},onOk:he,okText:"Reverse Entry",okButtonProps:{danger:!0,disabled:!Y},children:[e.jsxs("p",{children:['Are you sure you want to reverse entry "',w==null?void 0:w.entry_number,'"?']}),e.jsx("p",{children:"This will reverse all account balance changes. Please provide a reason:"}),e.jsx(Le,{value:Y,onChange:t=>L(t.target.value),placeholder:"Reason for reversal",rows:3,required:!0})]})]})}export{St as default};
