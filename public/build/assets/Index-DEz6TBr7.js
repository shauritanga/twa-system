import{t as q,r as u,j as e,S as _,J as oe,Q as te}from"./app-Cfy4TXUM.js";import{A as re,B as w,S as le,D as ae}from"./AdminSidebarLayout-Buj-taLG.js";import{d as T}from"./dayjs.min-CQ88ldzR.js";import{F as s}from"./index-BM3_YHPt.js";import{M as W,R as se}from"./index-BTuzFoE5.js";import{I as k}from"./index-BWhN2zcf.js";import{R as F,C as x}from"./row-DnGM8N7d.js";import{T as Y}from"./index-Dbm_9vxK.js";import{D as A}from"./index-B7DGN-AY.js";import{S as C}from"./index-BH-hJvoT.js";import{U as D}from"./index-DRzBn8xr.js";import{R as V}from"./InboxOutlined-B1fnU0B3.js";import{C as v,F as ne}from"./Table-BDJDT3yO.js";import{s as p}from"./index-CMJhgVxZ.js";import{R as G,C as U}from"./index-mG9EyX9P.js";import{R as ie}from"./useIcons-C0CVJH8d.js";import{E as X}from"./index-BqBQ4c5d.js";import{T as de}from"./index-eYiOuDe6.js";import{B as ce}from"./index-Bbcj_LX9.js";import{R as me}from"./StarOutlined-BjI1x3Dt.js";import{P as ue}from"./progress-j8EeeJZ1.js";import{R as pe}from"./MoreOutlined-BWZw2gaf.js";import{R as xe}from"./EyeOutlined-c0yod4UM.js";import{R as he}from"./EditOutlined-DIT7bWP5.js";import"./SessionTimeout-Dn5jdFb_.js";import"./Modal-dSY3wv-x.js";import"./transition-CwSGfga5.js";import"./PrimaryButton-D3tyYlDf.js";import"./SecondaryButton-HhmXi8wu.js";import"./CSSMotionList-CIWGNMjx.js";import"./useForm-WxDJKNk0.js";import"./CheckCircleFilled-JrBW7ofW.js";import"./InfoCircleFilled-Ce035z5p.js";import"./Input-CfZxHJYv.js";import"./getAllowClear-CEhEtxYT.js";import"./TextArea-kKKIj_tr.js";import"./DownOutlined-D7IvzF20.js";import"./CalendarOutlined-Dc2SfXVk.js";import"./ClockCircleOutlined-BEpyFDSv.js";import"./DownloadOutlined-wtaD_--B.js";import"./scrollTo-CLqcVzDY.js";import"./index-Du1U9e5C.js";const{TextArea:$}=k,{Dragger:z}=D;function ge({open:h,onCancel:S,campaign:l=null}){const{token:o}=q.useToken(),[c]=s.useForm(),[f,y]=u.useState([]),[b,j]=u.useState([]),[E,I]=u.useState(!1),d=!!l;u.useEffect(()=>{h&&(d?c.setFieldsValue({title:l.title,description:l.description,full_description:l.full_description,goal_amount:l.goal_amount,raised_amount:l.raised_amount,status:l.status,start_date:l.start_date?T(l.start_date):null,end_date:l.end_date?T(l.end_date):null,video_url:l.video_url,payment_methods:l.payment_methods||[],bank_details:l.bank_details,mobile_money_number:l.mobile_money_number,is_featured:l.is_featured,sort_order:l.sort_order||0}):(c.resetFields(),y([]),j([])))},[h,l,d]);const M=t=>{I(!0);const a=new FormData;if(d&&a.append("_method","PUT"),a.append("title",t.title),a.append("description",t.description),a.append("full_description",t.full_description||""),a.append("goal_amount",t.goal_amount),a.append("raised_amount",t.raised_amount||0),a.append("status",t.status),a.append("start_date",t.start_date?T(t.start_date).format("YYYY-MM-DD"):""),a.append("end_date",t.end_date?T(t.end_date).format("YYYY-MM-DD"):""),a.append("video_url",t.video_url||""),a.append("bank_details",t.bank_details||""),a.append("mobile_money_number",t.mobile_money_number||""),a.append("is_featured",t.is_featured?"1":"0"),a.append("sort_order",t.sort_order||0),t.payment_methods&&t.payment_methods.length>0&&t.payment_methods.forEach((n,P)=>{a.append(`payment_methods[${P}]`,n)}),f.length>0){const n=f[0].originFileObj||f[0];a.append("image_file",n)}if(b.length>0){const n=b[0].originFileObj||b[0];a.append("video_file",n)}const g=d?route("admin-portal.fundraising.update",l.id):route("admin-portal.fundraising.store");_.post(g,a,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{p.success(d?"Campaign updated successfully":"Campaign created successfully"),R()},onError:n=>{console.error("Campaign submission errors:",n),n.title?p.error(n.title):n.goal_amount?p.error(n.goal_amount):p.error(d?"Failed to update campaign":"Failed to create campaign")},onFinish:()=>{I(!1)}})},R=()=>{c.resetFields(),y([]),j([]),S()},B={beforeUpload:t=>t.type.startsWith("image/")?t.size/1024/1024<5?(y([{uid:t.uid,name:t.name,status:"done",originFileObj:t}]),!1):(p.error("Image must be smaller than 5MB"),D.LIST_IGNORE):(p.error("You can only upload image files!"),D.LIST_IGNORE),fileList:f,onRemove:()=>{y([])},maxCount:1},m={beforeUpload:t=>t.type.startsWith("video/")?t.size/1024/1024<50?(j([{uid:t.uid,name:t.name,status:"done",originFileObj:t}]),!1):(p.error("Video must be smaller than 50MB"),D.LIST_IGNORE):(p.error("You can only upload video files!"),D.LIST_IGNORE),fileList:b,onRemove:()=>{j([])},maxCount:1};return e.jsx(W,{title:d?"Edit Campaign":"Create Campaign",open:h,onCancel:R,onOk:()=>c.submit(),confirmLoading:E,width:900,centered:!0,okText:d?"Update":"Create",cancelText:"Cancel",destroyOnClose:!0,styles:{body:{maxHeight:"calc(100vh - 240px)",overflowY:"auto",overflowX:"hidden",paddingBottom:"16px",paddingRight:"24px"},mask:{backgroundColor:"rgba(0, 0, 0, 0.45)"}},children:e.jsxs(s,{form:c,layout:"vertical",onFinish:M,initialValues:{status:"draft",is_featured:!1,sort_order:0,raised_amount:0,payment_methods:[]},style:{color:o.colorText},children:[e.jsx(s.Item,{label:"Campaign Title",name:"title",rules:[{required:!0,message:"Please enter campaign title"}],labelCol:{style:{color:o.colorText}},children:e.jsx(k,{placeholder:"Enter campaign title",style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsx(s.Item,{label:"Short Description",name:"description",rules:[{required:!0,message:"Please enter description"}],labelCol:{style:{color:o.colorText}},children:e.jsx($,{rows:3,placeholder:"Brief description for campaign card",style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsx(s.Item,{label:"Full Description",name:"full_description",labelCol:{style:{color:o.colorText}},children:e.jsx($,{rows:6,placeholder:"Detailed campaign description",style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsxs(F,{gutter:16,children:[e.jsx(x,{xs:24,sm:12,children:e.jsx(s.Item,{label:"Goal Amount (TZS)",name:"goal_amount",rules:[{required:!0,message:"Please enter goal amount"}],labelCol:{style:{color:o.colorText}},children:e.jsx(Y,{min:1,style:{width:"100%",backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText},formatter:t=>`${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t.replace(/\$\s?|(,*)/g,"")})})}),d&&e.jsx(x,{xs:24,sm:12,children:e.jsx(s.Item,{label:"Raised Amount (TZS)",name:"raised_amount",rules:[{required:!0,message:"Please enter raised amount"}],labelCol:{style:{color:o.colorText}},children:e.jsx(Y,{min:0,style:{width:"100%",backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText},formatter:t=>`${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t.replace(/\$\s?|(,*)/g,"")})})})]}),e.jsxs(F,{gutter:16,children:[e.jsx(x,{xs:24,sm:12,children:e.jsx(s.Item,{label:"Start Date",name:"start_date",rules:[{required:!0,message:"Please select start date"}],labelCol:{style:{color:o.colorText}},children:e.jsx(A,{style:{width:"100%",backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})})}),e.jsx(x,{xs:24,sm:12,children:e.jsx(s.Item,{label:"End Date (Optional)",name:"end_date",labelCol:{style:{color:o.colorText}},children:e.jsx(A,{style:{width:"100%",backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})})})]}),e.jsx(s.Item,{label:"Status",name:"status",rules:[{required:!0,message:"Please select status"}],labelCol:{style:{color:o.colorText}},children:e.jsxs(C,{style:{color:o.colorText},children:[e.jsx(C.Option,{value:"draft",children:"Draft"}),e.jsx(C.Option,{value:"active",children:"Active"}),e.jsx(C.Option,{value:"paused",children:"Paused"}),e.jsx(C.Option,{value:"completed",children:"Completed"}),e.jsx(C.Option,{value:"cancelled",children:"Cancelled"})]})}),e.jsx(s.Item,{label:"Campaign Image",help:d&&l.image_path?`Current: ${l.image_path}`:"JPEG, PNG, GIF, WebP up to 5MB",labelCol:{style:{color:o.colorText}},children:e.jsxs(z,{...B,style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder},children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(V,{style:{color:o.colorPrimary}})}),e.jsx("p",{className:"ant-upload-text",style:{color:o.colorText},children:"Click or drag image to upload"})]})}),e.jsx(s.Item,{label:"Campaign Video (Optional)",help:d&&l.video_path?`Current: ${l.video_path}`:"MP4, AVI, MOV up to 50MB",labelCol:{style:{color:o.colorText}},children:e.jsxs(z,{...m,style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder},children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(V,{style:{color:o.colorPrimary}})}),e.jsx("p",{className:"ant-upload-text",style:{color:o.colorText},children:"Click or drag video to upload"})]})}),e.jsx(s.Item,{label:"Video URL (Optional)",name:"video_url",help:"YouTube or Vimeo URL",labelCol:{style:{color:o.colorText}},children:e.jsx(k,{placeholder:"https://www.youtube.com/watch?v=...",style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsx(s.Item,{label:"Payment Methods",name:"payment_methods",labelCol:{style:{color:o.colorText}},children:e.jsx(v.Group,{children:e.jsxs(F,{children:[e.jsx(x,{span:12,children:e.jsx(v,{value:"bank_transfer",style:{color:o.colorText},children:"Bank Transfer"})}),e.jsx(x,{span:12,children:e.jsx(v,{value:"mobile_money",style:{color:o.colorText},children:"Mobile Money"})})]})})}),e.jsx(s.Item,{label:"Bank Details",name:"bank_details",labelCol:{style:{color:o.colorText}},children:e.jsx($,{rows:3,placeholder:"Bank name, account number, account name",style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsx(s.Item,{label:"Mobile Money Number",name:"mobile_money_number",labelCol:{style:{color:o.colorText}},children:e.jsx(k,{placeholder:"+255 XXX XXX XXX",style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsxs(F,{gutter:16,children:[e.jsx(x,{xs:24,sm:12,children:e.jsx(s.Item,{name:"is_featured",valuePropName:"checked",children:e.jsx(v,{style:{color:o.colorText},children:"Featured Campaign"})})}),e.jsx(x,{xs:24,sm:12,children:e.jsx(s.Item,{label:"Sort Order",name:"sort_order",labelCol:{style:{color:o.colorText}},children:e.jsx(Y,{min:0,style:{width:"100%",backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})})})]})]})})}function ao(){const{campaigns:h={data:[]},filters:S={},statuses:l={},flash:o={}}=oe().props,{token:c}=q.useToken(),[f,y]=u.useState(S.search||""),[b,j]=u.useState(S.status||""),[E,I]=u.useState(!1),[d,M]=u.useState(null),[R,B]=u.useState(!1),[m,t]=u.useState(null),[a,g]=u.useState("");u.useEffect(()=>{o!=null&&o.success&&p.success(o.success),o!=null&&o.error&&p.error(o.error)},[o]);const n=(r=null)=>{M(r),I(!0)},P=()=>{I(!1),M(null)},L=()=>{_.get(route("admin-portal.fundraising.index"),{search:f,status:b},{preserveState:!0,preserveScroll:!0})},Z=()=>{y(""),j(""),_.get(route("admin-portal.fundraising.index"))},J=r=>{t(r),g(""),B(!0)},Q=()=>{!m||a!==m.title||_.delete(route("admin-portal.fundraising.destroy",m.id),{onSuccess:()=>{p.success(`"${m.title}" deleted successfully`),B(!1),t(null),g("")},onError:()=>{p.error("Failed to delete campaign")}})},N=r=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(r||0),H=r=>{const i={draft:"default",active:"success",paused:"warning",completed:"blue",cancelled:"error"};return e.jsx(de,{color:i[r.status],children:l[r.status]})},K=[{title:"Campaign",dataIndex:"title",key:"title",width:"25%",render:(r,i)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.is_featured&&e.jsx(ce,{count:e.jsx(me,{style:{color:c.colorWarning}})}),e.jsx("span",{style:{fontWeight:"bold",color:c.colorText},children:r})]})},{title:"Goal",dataIndex:"goal_amount",key:"goal_amount",width:"12%",render:r=>N(r)},{title:"Raised",dataIndex:"raised_amount",key:"raised_amount",width:"12%",render:r=>N(r)},{title:"Progress",key:"progress",width:"15%",render:(r,i)=>{const O=i.goal_amount>0?Math.min(100,i.raised_amount/i.goal_amount*100):0;return e.jsx(ue,{percent:O,size:"small",format:ee=>`${ee.toFixed(0)}%`})}},{title:"Status",key:"status",width:"10%",render:(r,i)=>H(i)},{title:"Start Date",dataIndex:"start_date",key:"start_date",width:"12%",render:r=>T(r).format("DD MMM YYYY")},{title:"End Date",dataIndex:"end_date",key:"end_date",width:"12%",render:r=>r?T(r).format("DD MMM YYYY"):"-"},{title:"Actions",key:"actions",width:"10%",render:(r,i)=>{const O=[{key:"view",label:"View",icon:e.jsx(xe,{}),onClick:()=>_.visit(route("admin-portal.fundraising.show",i.id))},{key:"edit",label:"Edit",icon:e.jsx(he,{}),onClick:()=>n(i)},{key:"delete",label:"Delete",icon:e.jsx(se,{}),danger:!0,onClick:()=>J(i)}];return e.jsx(ae,{menu:{items:O},trigger:["click"],children:e.jsx(w,{type:"text",icon:e.jsx(pe,{})})})}}];return e.jsxs(e.Fragment,{children:[e.jsx(te,{title:"Fundraising Campaigns - Tabata Welfare Association"}),e.jsx(re,{children:e.jsxs("div",{style:{padding:"24px 0"},children:[h.data&&h.data.length>0&&e.jsx("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"flex-end"},children:e.jsx(w,{type:"primary",icon:e.jsx(G,{}),size:"large",onClick:()=>n(),children:"Create Campaign"})}),e.jsx(U,{style:{marginBottom:"24px"},children:e.jsxs(F,{gutter:[16,16],align:"middle",children:[e.jsx(x,{xs:24,sm:12,md:10,children:e.jsx(k,{placeholder:"Search campaigns...",prefix:e.jsx(ie,{}),value:f,onChange:r=>y(r.target.value),onPressEnter:L,allowClear:!0})}),e.jsx(x,{xs:24,sm:6,md:6,children:e.jsx(C,{placeholder:"Status",value:b||void 0,onChange:j,style:{width:"100%"},allowClear:!0,children:Object.entries(l).map(([r,i])=>e.jsx(C.Option,{value:r,children:i},r))})}),e.jsx(x,{xs:24,md:8,style:{textAlign:"right"},children:e.jsxs(le,{children:[e.jsx(w,{type:"primary",onClick:L,children:"Search"}),e.jsx(w,{onClick:Z,children:"Clear"})]})})]})}),e.jsx(U,{children:e.jsx(ne,{columns:K,dataSource:h.data||[],rowKey:"id",pagination:{current:h.current_page,pageSize:h.per_page,total:h.total,showSizeChanger:!0,showTotal:r=>`Total ${r} campaigns`,onChange:r=>{_.get(route("admin-portal.fundraising.index"),{...S,page:r})}},locale:{emptyText:e.jsx(X,{image:X.PRESENTED_IMAGE_SIMPLE,description:"No campaigns found",children:e.jsx(w,{type:"primary",icon:e.jsx(G,{}),onClick:()=>n(),children:"Create Your First Campaign"})})}})}),e.jsx(ge,{open:E,onCancel:P,campaign:d}),e.jsxs(W,{title:"Delete Campaign",open:R,onCancel:()=>{B(!1),t(null),g("")},onOk:Q,okText:"Delete",cancelText:"Cancel",okButtonProps:{danger:!0,disabled:a!==(m==null?void 0:m.title)},centered:!0,styles:{mask:{backgroundColor:"rgba(0, 0, 0, 0.45)"}},children:[e.jsxs("p",{children:['Are you sure you want to delete "',m==null?void 0:m.title,'"?']}),e.jsx("p",{style:{color:c.colorTextSecondary,fontSize:"12px",marginBottom:"16px"},children:"This action cannot be undone. All associated media files will be permanently deleted."}),e.jsx("p",{style:{marginBottom:"8px"},children:"Type the campaign title to confirm:"}),e.jsx(k,{placeholder:"Enter campaign title",value:a,onChange:r=>g(r.target.value),style:{backgroundColor:c.colorBgContainer,borderColor:c.colorBorder,color:c.colorText}})]})]})})]})}export{ao as default};
