import{t as F,r as p,j as e,Q as Z,S as m}from"./app-Cfy4TXUM.js";import{B as g,A as K,S as J,D as ee,j as te}from"./AdminSidebarLayout-Buj-taLG.js";import{d as C}from"./dayjs.min-CQ88ldzR.js";import{F as c}from"./index-BM3_YHPt.js";import{I as S}from"./index-BWhN2zcf.js";import{T as re}from"./index-Dbm_9vxK.js";import{D as $}from"./index-B7DGN-AY.js";import{S as u}from"./index-BH-hJvoT.js";import{U as oe}from"./index-DRzBn8xr.js";import{R as ae}from"./UploadOutlined-BiU0ev-p.js";import{s as se}from"./index-CMJhgVxZ.js";import{C as le,R as ne}from"./index-mG9EyX9P.js";import{R as ie}from"./useIcons-C0CVJH8d.js";import{F as ce}from"./Table-BDJDT3yO.js";import{E as A}from"./index-BqBQ4c5d.js";import{M as P,R as de}from"./index-BTuzFoE5.js";import{T as pe}from"./index-eYiOuDe6.js";import{R as ue}from"./MoreOutlined-BWZw2gaf.js";import{R as me}from"./CheckCircleOutlined-D3khjOz4.js";import{R as xe}from"./CloseCircleOutlined-mKdyCeJY.js";import{R as he}from"./DownloadOutlined-wtaD_--B.js";import{R as fe}from"./EditOutlined-DIT7bWP5.js";import{T as ge}from"./index-BAjCEJt5.js";import"./SessionTimeout-Dn5jdFb_.js";import"./Modal-dSY3wv-x.js";import"./transition-CwSGfga5.js";import"./PrimaryButton-D3tyYlDf.js";import"./SecondaryButton-HhmXi8wu.js";import"./CSSMotionList-CIWGNMjx.js";import"./useForm-WxDJKNk0.js";import"./row-DnGM8N7d.js";import"./CheckCircleFilled-JrBW7ofW.js";import"./InfoCircleFilled-Ce035z5p.js";import"./Input-CfZxHJYv.js";import"./getAllowClear-CEhEtxYT.js";import"./EyeOutlined-c0yod4UM.js";import"./TextArea-kKKIj_tr.js";import"./DownOutlined-D7IvzF20.js";import"./CalendarOutlined-Dc2SfXVk.js";import"./ClockCircleOutlined-BEpyFDSv.js";import"./progress-j8EeeJZ1.js";import"./scrollTo-CLqcVzDY.js";import"./index-Du1U9e5C.js";const{TextArea:Y}=S,{Option:O}=u,je=[{value:"office_supplies",label:"Office Supplies"},{value:"utilities",label:"Utilities"},{value:"rent",label:"Rent"},{value:"travel",label:"Travel"},{value:"meals",label:"Meals"},{value:"equipment",label:"Equipment"},{value:"maintenance",label:"Maintenance"},{value:"professional_services",label:"Professional Services"},{value:"insurance",label:"Insurance"},{value:"other",label:"Other"}],ye=["Cash","Bank Transfer","Mobile Money","Cheque","Credit Card"];function Ce({expense:l,onSubmit:d,onCancel:a}){const[j]=c.useForm(),{token:o}=F.useToken();p.useEffect(()=>{l?j.setFieldsValue({...l,expense_date:l.expense_date?C(l.expense_date):null}):j.resetFields()},[l,j]);const x=r=>{const n=new FormData;Object.keys(r).forEach(s=>{var y;r[s]!==void 0&&r[s]!==null&&(s==="expense_date"?n.append(s,r[s].format("YYYY-MM-DD")):s==="receipt"&&((y=r[s])!=null&&y.file)?n.append(s,r[s].file.originFileObj):s!=="receipt"&&n.append(s,r[s]))}),l&&n.append("_method","PUT"),d(n)};return e.jsxs(c,{form:j,layout:"vertical",onFinish:x,initialValues:{expense_date:C(),category:"other"},children:[e.jsx(c.Item,{name:"title",label:"Expense Title",rules:[{required:!0,message:"Please enter expense title"}],children:e.jsx(S,{placeholder:"e.g., Office Rent Payment",style:{backgroundColor:o.colorBgContainer,color:o.colorText}})}),e.jsx(c.Item,{name:"description",label:"Description",children:e.jsx(Y,{rows:3,placeholder:"Detailed description of the expense",style:{backgroundColor:o.colorBgContainer,color:o.colorText}})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(c.Item,{name:"amount",label:"Amount (TZS)",rules:[{required:!0,message:"Please enter amount"}],children:e.jsx(re,{style:{width:"100%",backgroundColor:o.colorBgContainer,color:o.colorText},min:0,formatter:r=>`${r}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:r=>r.replace(/,/g,""),placeholder:"0.00"})}),e.jsx(c.Item,{name:"expense_date",label:"Expense Date",rules:[{required:!0,message:"Please select date"}],children:e.jsx($,{style:{width:"100%",backgroundColor:o.colorBgContainer,color:o.colorText}})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(c.Item,{name:"category",label:"Category",rules:[{required:!0,message:"Please select category"}],children:e.jsx(u,{placeholder:"Select category",style:{backgroundColor:o.colorBgContainer},children:je.map(r=>e.jsx(O,{value:r.value,children:r.label},r.value))})}),e.jsx(c.Item,{name:"payment_method",label:"Payment Method",children:e.jsx(u,{placeholder:"Select payment method",allowClear:!0,style:{backgroundColor:o.colorBgContainer},children:ye.map(r=>e.jsx(O,{value:r,children:r},r))})})]}),e.jsx(c.Item,{name:"vendor",label:"Vendor/Payee",children:e.jsx(S,{placeholder:"Name of vendor or person paid",style:{backgroundColor:o.colorBgContainer,color:o.colorText}})}),e.jsx(c.Item,{name:"receipt",label:"Receipt/Attachment",valuePropName:"file",children:e.jsx(oe,{maxCount:1,beforeUpload:()=>!1,accept:".pdf,.jpg,.jpeg,.png",children:e.jsx(g,{icon:e.jsx(ae,{}),children:"Upload Receipt"})})}),e.jsx(c.Item,{name:"notes",label:"Additional Notes",children:e.jsx(Y,{rows:2,placeholder:"Any additional information",style:{backgroundColor:o.colorBgContainer,color:o.colorText}})}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"24px"},children:[e.jsx(g,{onClick:a,children:"Cancel"}),e.jsxs(g,{type:"primary",htmlType:"submit",children:[l?"Update":"Create"," Expense"]})]})]})}const{RangePicker:Se}=$,{Text:ut}=ge,ve=["Utilities","Maintenance","Events","Salaries","Office Supplies","Transportation","Communication","Insurance","Legal & Professional","Marketing","Training","Other"];function mt({expenses:l,filters:d}){F.useToken();const[a,j]=se.useMessage(),[o,x]=p.useState(!1),[r,n]=p.useState(null),[s,y]=p.useState(!1),[h,E]=p.useState(null),[b,v]=p.useState(""),[T,k]=p.useState(d.search||""),[I,w]=p.useState(d.category||null),[M,R]=p.useState(d.status||null),[f,_]=p.useState(d.start_date&&d.end_date?[C(d.start_date),C(d.end_date)]:null),D=()=>{var t,i;m.get("/admin-portal/expenses",{search:T,category:I,status:M,start_date:(t=f==null?void 0:f[0])==null?void 0:t.format("YYYY-MM-DD"),end_date:(i=f==null?void 0:f[1])==null?void 0:i.format("YYYY-MM-DD")},{preserveState:!0,preserveScroll:!0})},B=()=>{k(""),w(null),R(null),_(null),m.get("/admin-portal/expenses",{},{preserveState:!0,preserveScroll:!0})},N=()=>{n(null),x(!0)},U=t=>{n(t),x(!0)},q=t=>{r?m.post(`/admin-portal/expenses/${r.id}`,t,{onSuccess:()=>{x(!1),n(null),a.success("Expense updated successfully")},onError:()=>{a.error("Failed to update expense")}}):m.post("/admin-portal/expenses",t,{onSuccess:()=>{x(!1),a.success("Expense created successfully")},onError:()=>{a.error("Failed to create expense")}})},L=t=>{E(t),v(""),y(!0)},V=()=>{h&&m.delete(`/admin-portal/expenses/${h.id}`,{onSuccess:()=>{y(!1),E(null),v(""),a.success("Expense deleted successfully")},onError:()=>{a.error("Failed to delete expense")}})},G=t=>{m.post(`/admin-portal/expenses/${t.id}/approve`,{},{onSuccess:()=>{a.success("Expense approved successfully")},onError:()=>{a.error("Failed to approve expense")}})},H=t=>{m.post(`/admin-portal/expenses/${t.id}/reject`,{},{onSuccess:()=>{a.success("Expense rejected successfully")},onError:()=>{a.error("Failed to reject expense")}})},X=t=>{m.post(`/admin-portal/expenses/${t.id}/mark-as-paid`,{},{onSuccess:()=>{a.success("Expense marked as paid successfully")},onError:()=>{a.error("Failed to mark expense as paid")}})},z=t=>({pending:"orange",approved:"blue",paid:"green",rejected:"red"})[t]||"default",Q=t=>{const i=[{key:"edit",label:"Edit",icon:e.jsx(fe,{}),onClick:()=>U(t)}];return t.status==="pending"&&i.push({key:"approve",label:"Approve",icon:e.jsx(me,{}),onClick:()=>G(t)},{key:"reject",label:"Reject",icon:e.jsx(xe,{}),onClick:()=>H(t)}),t.status==="approved"&&i.push({key:"mark-paid",label:"Mark as Paid",icon:e.jsx(te,{}),onClick:()=>X(t)}),t.receipt_path&&i.push({key:"download",label:"Download Receipt",icon:e.jsx(he,{}),onClick:()=>window.open(`/storage/${t.receipt_path}`,"_blank")}),i.push({key:"delete",label:"Delete",icon:e.jsx(de,{}),danger:!0,onClick:()=>L(t)}),i},W=[{title:"Date",dataIndex:"expense_date",key:"expense_date",width:110,render:t=>C(t).format("MMM DD, YYYY")},{title:"Title",dataIndex:"title",key:"title",width:200,ellipsis:!0},{title:"Category",dataIndex:"category",key:"category",width:130},{title:"Vendor",dataIndex:"vendor",key:"vendor",width:130,ellipsis:!0,render:t=>t||"-"},{title:"Amount",dataIndex:"amount",key:"amount",width:130,align:"right",render:t=>`TZS ${parseFloat(t).toLocaleString()}`},{title:"Status",dataIndex:"status",key:"status",width:100,render:t=>e.jsx(pe,{color:z(t),children:t.toUpperCase()})},{title:"Created By",dataIndex:"creator",key:"creator",width:130,ellipsis:!0,render:t=>(t==null?void 0:t.name)||"-"},{title:"Actions",key:"actions",width:80,fixed:"right",render:(t,i)=>e.jsx(ee,{menu:{items:Q(i)},trigger:["click"],children:e.jsx(g,{type:"text",icon:e.jsx(ue,{})})})}];return e.jsxs(e.Fragment,{children:[e.jsx(Z,{title:"Expenses Management - Tabata Welfare Association"}),e.jsxs(K,{children:[j,e.jsxs(le,{children:[e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px"},children:[e.jsxs(J,{wrap:!0,children:[e.jsx(S,{placeholder:"Search expenses...",prefix:e.jsx(ie,{}),value:T,onChange:t=>k(t.target.value),onPressEnter:D,style:{width:250},allowClear:!0}),e.jsx(u,{placeholder:"Category",value:I,onChange:w,style:{width:150},allowClear:!0,children:ve.map(t=>e.jsx(u.Option,{value:t,children:t},t))}),e.jsxs(u,{placeholder:"Status",value:M,onChange:R,style:{width:120},allowClear:!0,children:[e.jsx(u.Option,{value:"pending",children:"Pending"}),e.jsx(u.Option,{value:"approved",children:"Approved"}),e.jsx(u.Option,{value:"paid",children:"Paid"}),e.jsx(u.Option,{value:"rejected",children:"Rejected"})]}),e.jsx(Se,{value:f,onChange:_,format:"YYYY-MM-DD"}),e.jsx(g,{onClick:D,type:"primary",children:"Search"}),e.jsx(g,{onClick:B,children:"Reset"})]}),e.jsx(g,{type:"primary",icon:e.jsx(ne,{}),onClick:N,children:"Add Expense"})]}),e.jsx(ce,{columns:W,dataSource:l.data,rowKey:"id",pagination:{current:l.current_page,pageSize:l.per_page,total:l.total,showSizeChanger:!1,showTotal:t=>`Total ${t} expenses`,onChange:t=>{m.get("/admin-portal/expenses",{...d,page:t},{preserveState:!0,preserveScroll:!0})}},locale:{emptyText:e.jsx(A,{description:"No expenses found",image:A.PRESENTED_IMAGE_SIMPLE})},scroll:{x:1100}})]}),e.jsx(P,{title:r?"Edit Expense":"Add New Expense",open:o,onCancel:()=>{x(!1),n(null)},footer:null,width:800,styles:{body:{maxHeight:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden",paddingRight:"24px"}},children:e.jsx(Ce,{expense:r,onSubmit:q,onCancel:()=>{x(!1),n(null)}})}),e.jsxs(P,{title:"Delete Expense",open:s,onCancel:()=>{y(!1),E(null),v("")},onOk:V,okText:"Delete",okButtonProps:{danger:!0,disabled:b!==(h==null?void 0:h.title)},children:[e.jsxs("p",{children:['Are you sure you want to delete "',h==null?void 0:h.title,'"?']}),e.jsx("p",{children:"Type the expense title to confirm:"}),e.jsx(S,{value:b,onChange:t=>v(t.target.value),placeholder:"Type expense title here"})]})]})]})}export{mt as default};
