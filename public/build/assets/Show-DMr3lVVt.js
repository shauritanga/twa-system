import{J as oe,t as re,r as m,j as e,S as p}from"./app-Cfy4TXUM.js";import{S as M,B as c,A as te,D as w,p as le}from"./AdminSidebarLayout-Buj-taLG.js";import{d as ne}from"./dayjs.min-CQ88ldzR.js";import{F as n}from"./index-BM3_YHPt.js";import{R as se,C as F}from"./row-DnGM8N7d.js";import{C as h,T as ie,R as ae}from"./index-mG9EyX9P.js";import{D as i}from"./index-fZXMI_hl.js";import{D as I}from"./index-DK02w_Sf.js";import{T as A}from"./index-eYiOuDe6.js";import{R as q}from"./CheckCircleOutlined-D3khjOz4.js";import{F as de}from"./Table-BDJDT3yO.js";import{R as ce}from"./DownloadOutlined-wtaD_--B.js";import{B as me}from"./index-esw8YQV4.js";import{R as E}from"./MoreOutlined-BWZw2gaf.js";import{R as pe}from"./EditOutlined-DIT7bWP5.js";import{R as xe,M as b}from"./index-BTuzFoE5.js";import{I as s}from"./index-BWhN2zcf.js";import{S as he}from"./index-BH-hJvoT.js";import{D as P}from"./index-B7DGN-AY.js";import{U as be}from"./index-DRzBn8xr.js";import{R as ue}from"./UploadOutlined-BiU0ev-p.js";import{s as a}from"./index-CMJhgVxZ.js";import{R as fe}from"./CloseCircleOutlined-mKdyCeJY.js";import"./SessionTimeout-Dn5jdFb_.js";import"./Modal-dSY3wv-x.js";import"./transition-CwSGfga5.js";import"./PrimaryButton-D3tyYlDf.js";import"./SecondaryButton-HhmXi8wu.js";import"./CSSMotionList-CIWGNMjx.js";import"./useForm-WxDJKNk0.js";import"./CheckCircleFilled-JrBW7ofW.js";import"./InfoCircleFilled-Ce035z5p.js";import"./DownOutlined-D7IvzF20.js";import"./scrollTo-CLqcVzDY.js";import"./index-Du1U9e5C.js";import"./index-BqBQ4c5d.js";import"./useIcons-C0CVJH8d.js";import"./getAllowClear-CEhEtxYT.js";import"./Input-CfZxHJYv.js";import"./EyeOutlined-c0yod4UM.js";import"./TextArea-kKKIj_tr.js";import"./CalendarOutlined-Dc2SfXVk.js";import"./ClockCircleOutlined-BEpyFDSv.js";import"./progress-j8EeeJZ1.js";function ao(){var R;const{member:t={}}=oe().props,{token:o}=re.useToken(),[y]=n.useForm(),[u]=n.useForm(),[Y,f]=m.useState(!1),[$,j]=m.useState(!1),[B,g]=m.useState(!1),[x,C]=m.useState([]),[_,T]=m.useState(""),[z,k]=m.useState(!1),[N,S]=m.useState(null),[O,D]=m.useState(!1),[v,W]=m.useState("details"),U=()=>{y.setFieldsValue({first_name:t.first_name,middle_name:t.middle_name,surname:t.surname,email:t.email,phone_number:t.phone_number,address:t.address,place_of_birth:t.place_of_birth,sex:t.sex,date_of_birth:t.date_of_birth?ne(t.date_of_birth):null,tribe:t.tribe,occupation:t.occupation,reason_for_membership:t.reason_for_membership}),f(!0)},L=async r=>{var d;g(!0);const l=new FormData;l.append("first_name",r.first_name),l.append("middle_name",r.middle_name||""),l.append("surname",r.surname),l.append("email",r.email),l.append("phone_number",r.phone_number),l.append("address",r.address),l.append("place_of_birth",r.place_of_birth),l.append("sex",r.sex),l.append("date_of_birth",(d=r.date_of_birth)==null?void 0:d.format("YYYY-MM-DD")),l.append("tribe",r.tribe||""),l.append("occupation",r.occupation||""),l.append("reason_for_membership",r.reason_for_membership||""),r.image&&r.image.file&&l.append("image",r.image.file),r.application_form&&r.application_form.file&&l.append("application_form",r.application_form.file),p.post(route("members.update",t.id),l,{onSuccess:()=>{a.success("Member updated successfully"),f(!1)},onError:()=>{a.error("Failed to update member")},onFinish:()=>g(!1)})},K=()=>{u.resetFields(),j(!0)},V=async r=>{var d;g(!0);const l=new FormData;l.append("name",r.name),l.append("relationship",r.relationship||""),l.append("date_of_birth",(d=r.date_of_birth)==null?void 0:d.format("YYYY-MM-DD")),l.append("tribe",r.tribe||""),l.append("residence",r.residence||""),l.append("member_id",t.id),r.image&&r.image.file&&l.append("image",r.image.file),p.post(route("dependents.store"),l,{onSuccess:()=>{a.success("Dependent added successfully"),j(!1),u.resetFields()},onError:()=>{a.error("Failed to add dependent")},onFinish:()=>g(!1)})},H=()=>{if(x.length===0){a.warning("Please select dependents to approve");return}b.confirm({title:"Approve Dependents",content:`Are you sure you want to approve ${x.length} dependent(s)?`,okText:"Yes",cancelText:"No",onOk(){x.forEach(r=>{p.post(route("dependents.approve",r),{},{onSuccess:()=>{a.success("Dependent approved"),C([])},onError:()=>{a.error("Failed to approve dependent")}})})}})},J=r=>{S(r),k(!0)},G=()=>{if(!_.trim()){a.warning("Please provide a rejection reason");return}p.post(route("dependents.reject",N),{reason:_},{onSuccess:()=>{a.success("Dependent rejected"),k(!1),T(""),S(null)},onError:()=>{a.error("Failed to reject dependent")}})},Q=()=>{D(!0)},X=()=>{p.delete(route("members.destroy",t.id),{onSuccess:()=>{a.success("Member archived successfully"),p.visit(route("admin-portal.members.index"))},onError:()=>{a.error("Failed to archive member")}})},Z=[{title:"Dependent",dataIndex:"name",key:"name",render:(r,l)=>e.jsxs(M,{children:[e.jsx(le,{size:"large",src:l.image_path?`/storage/${l.image_path}`:void 0,style:{backgroundColor:o.colorPrimary},children:r.split(" ").map(d=>d[0]).join("").toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:r}),e.jsx("div",{style:{fontSize:"12px",color:o.colorTextSecondary},children:l.relationship})]})]})},{title:"DOB",dataIndex:"date_of_birth",key:"date_of_birth",render:r=>r?new Date(r).toLocaleDateString():"-"},{title:"Tribe",dataIndex:"tribe",key:"tribe"},{title:"Residence",dataIndex:"residence",key:"residence"},{title:"Status",dataIndex:"status",key:"status",render:r=>{const l={approved:"green",rejected:"red",pending:"orange"};return e.jsx(A,{color:l[r]||"default",children:r})}},{title:"Actions",key:"actions",width:80,render:(r,l)=>{const d=[];return l.status==="pending"?(d.push({key:"approve",label:"Approve",icon:e.jsx(q,{}),onClick:()=>{p.post(route("dependents.approve",l.id),{},{onSuccess:()=>a.success("Dependent approved"),onError:()=>a.error("Failed to approve")})}}),d.push({key:"reject",label:"Reject",icon:e.jsx(fe,{}),danger:!0,onClick:()=>J(l.id)})):l.status==="rejected"?d.push({key:"rejected",label:"Rejected",disabled:!0}):l.status==="approved"&&d.push({key:"approved",label:"Approved",disabled:!0}),e.jsx(w,{menu:{items:d},trigger:["click"],children:e.jsx(c,{type:"text",icon:e.jsx(E,{})})})}}],ee=[{key:"details",label:"Member Details",children:e.jsx("div",{style:{marginTop:"16px"},children:e.jsxs(se,{gutter:[16,16],children:[e.jsx(F,{xs:24,md:16,children:e.jsxs(h,{title:"Personal Information",children:[e.jsxs(i,{column:2,size:"small",children:[e.jsx(i.Item,{label:"First Name",children:t.first_name}),e.jsx(i.Item,{label:"Middle Name",children:t.middle_name||"-"}),e.jsx(i.Item,{label:"Surname",children:t.surname}),e.jsx(i.Item,{label:"Sex",children:t.sex}),e.jsx(i.Item,{label:"Date of Birth",children:t.date_of_birth?new Date(t.date_of_birth).toLocaleDateString():"-"}),e.jsx(i.Item,{label:"Place of Birth",children:t.place_of_birth})]}),e.jsx(I,{}),e.jsx("h4",{style:{fontWeight:"bold",marginBottom:"12px"},children:"Contact Information"}),e.jsxs(i,{column:1,size:"small",children:[e.jsx(i.Item,{label:"Email",children:t.email}),e.jsx(i.Item,{label:"Phone",children:t.phone_number}),e.jsx(i.Item,{label:"Address",children:t.address})]}),e.jsx(I,{}),e.jsx("h4",{style:{fontWeight:"bold",marginBottom:"12px"},children:"Additional Information"}),e.jsxs(i,{column:2,size:"small",children:[e.jsx(i.Item,{label:"Tribe",children:t.tribe||"-"}),e.jsx(i.Item,{label:"Occupation",children:t.occupation||"-"})]}),t.reason_for_membership&&e.jsxs(e.Fragment,{children:[e.jsx(I,{}),e.jsx("h4",{style:{fontWeight:"bold",marginBottom:"12px"},children:"Reason for Membership"}),e.jsx("p",{children:t.reason_for_membership})]})]})}),e.jsx(F,{xs:24,md:8,children:e.jsxs(h,{title:"Member Status",children:[e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("div",{style:{color:o.colorTextSecondary,marginBottom:"8px"},children:"Verification Status"}),e.jsx(A,{color:t.is_verified?"green":"orange",style:{fontSize:"14px",padding:"4px 12px"},children:t.is_verified?"Verified":"Pending"})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("div",{style:{color:o.colorTextSecondary,marginBottom:"8px"},children:"Member Since"}),e.jsx("div",{style:{fontWeight:"bold"},children:t.created_at?new Date(t.created_at).toLocaleDateString():"-"})]}),t.image_path&&e.jsxs("div",{children:[e.jsx("div",{style:{color:o.colorTextSecondary,marginBottom:"8px"},children:"Profile Image"}),e.jsx("img",{src:`/storage/${t.image_path}`,alt:t.name,style:{maxWidth:"100%",borderRadius:"8px"}})]})]})})]})})},{key:"dependents",label:`Dependents (${((R=t.dependents)==null?void 0:R.length)||0})`,children:e.jsx("div",{style:{marginTop:"16px"},children:e.jsxs(h,{children:[x.length>0&&e.jsxs(M,{style:{marginBottom:"16px"},children:[e.jsxs(c,{type:"primary",icon:e.jsx(q,{}),onClick:H,children:["Approve Selected (",x.length,")"]}),e.jsx(c,{onClick:()=>C([]),children:"Clear Selection"})]}),e.jsx(de,{columns:Z,dataSource:t.dependents||[],rowKey:"id",pagination:{pageSize:10},rowSelection:{selectedRowKeys:x,onChange:r=>C(r),getCheckboxProps:r=>({disabled:r.status!=="pending"})}})]})})},{key:"documents",label:"Documents",children:e.jsx("div",{style:{marginTop:"16px"},children:e.jsx(h,{children:t.application_form_path?e.jsxs("div",{children:[e.jsx("h4",{style:{fontWeight:"bold",marginBottom:"12px"},children:"Application Form"}),e.jsx(c,{icon:e.jsx(ce,{}),onClick:()=>p.visit(route("admin.members.application-form",t.id)),children:"Download Application Form"})]}):e.jsx("p",{style:{color:o.colorTextSecondary},children:"No application form uploaded"})})})}];return e.jsx(te,{children:e.jsxs("div",{style:{padding:"24px 0"},children:[e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx(me,{items:[{title:e.jsx("span",{onClick:()=>p.visit(route("admin-portal.members.index")),style:{cursor:"pointer",color:o.colorPrimary},children:"Members"})},{title:t.name}],style:{marginBottom:"24px"}}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx(w,{menu:{items:[{key:"edit",label:"Edit Member",icon:e.jsx(pe,{}),onClick:U},{key:"archive",label:"Archive Member",icon:e.jsx(xe,{}),danger:!0,onClick:Q}]},trigger:["click"],children:e.jsx(c,{type:"text",icon:e.jsx(E,{}),size:"large"})})})]}),e.jsx(h,{children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(ie,{items:ee,activeKey:v,onChange:W}),v==="dependents"&&e.jsx("div",{style:{position:"absolute",top:"0",right:"0",display:"flex",alignItems:"center",height:"40px"},children:e.jsx(c,{type:"primary",icon:e.jsx(ae,{}),onClick:K,size:"small",children:"Add Dependent"})})]})}),e.jsx(b,{title:"Edit Member",open:Y,onCancel:()=>f(!1),width:600,centered:!0,footer:[e.jsx(c,{onClick:()=>f(!1),children:"Cancel"},"cancel"),e.jsx(c,{type:"primary",loading:B,onClick:()=>y.submit(),children:"Update Member"},"submit")],styles:{body:{maxHeight:"calc(100vh - 240px)",overflowY:"auto",paddingBottom:"16px"},mask:{backgroundColor:"rgba(0, 0, 0, 0.45)"}},children:e.jsxs(n,{form:y,layout:"vertical",onFinish:L,autoComplete:"off",style:{color:o.colorText},children:[e.jsx(n.Item,{label:"First Name",name:"first_name",rules:[{required:!0,message:"First name is required"}],labelCol:{style:{color:o.colorText}},children:e.jsx(s,{style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsx(n.Item,{label:"Middle Name",name:"middle_name",labelCol:{style:{color:o.colorText}},children:e.jsx(s,{style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsx(n.Item,{label:"Surname",name:"surname",rules:[{required:!0,message:"Surname is required"}],labelCol:{style:{color:o.colorText}},children:e.jsx(s,{style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsx(n.Item,{label:"Sex",name:"sex",rules:[{required:!0,message:"Sex is required"}],labelCol:{style:{color:o.colorText}},children:e.jsx(he,{options:[{label:"Male",value:"Male"},{label:"Female",value:"Female"}],style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsx(n.Item,{label:"Date of Birth",name:"date_of_birth",rules:[{required:!0,message:"Date of birth is required"}],labelCol:{style:{color:o.colorText}},children:e.jsx(P,{style:{width:"100%",backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsx(n.Item,{label:"Place of Birth",name:"place_of_birth",rules:[{required:!0,message:"Place of birth is required"}],labelCol:{style:{color:o.colorText}},children:e.jsx(s,{style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsx(n.Item,{label:"Email",name:"email",rules:[{required:!0,message:"Email is required"},{type:"email",message:"Invalid email format"}],labelCol:{style:{color:o.colorText}},children:e.jsx(s,{style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsx(n.Item,{label:"Phone Number",name:"phone_number",rules:[{required:!0,message:"Phone number is required"}],labelCol:{style:{color:o.colorText}},children:e.jsx(s,{style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsx(n.Item,{label:"Address",name:"address",rules:[{required:!0,message:"Address is required"}],labelCol:{style:{color:o.colorText}},children:e.jsx(s.TextArea,{rows:3,style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsx(n.Item,{label:"Tribe",name:"tribe",labelCol:{style:{color:o.colorText}},children:e.jsx(s,{style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsx(n.Item,{label:"Occupation",name:"occupation",labelCol:{style:{color:o.colorText}},children:e.jsx(s,{style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsx(n.Item,{label:"Reason for Membership",name:"reason_for_membership",labelCol:{style:{color:o.colorText}},children:e.jsx(s.TextArea,{rows:3})})]})}),e.jsx(b,{title:"Add Dependent",open:$,onCancel:()=>j(!1),width:600,centered:!0,footer:[e.jsx(c,{onClick:()=>j(!1),children:"Cancel"},"cancel"),e.jsx(c,{type:"primary",loading:B,onClick:()=>u.submit(),children:"Add Dependent"},"submit")],styles:{body:{maxHeight:"calc(100vh - 240px)",overflowY:"auto",paddingBottom:"16px"},mask:{backgroundColor:"rgba(0, 0, 0, 0.45)"}},children:e.jsxs(n,{form:u,layout:"vertical",onFinish:V,autoComplete:"off",style:{color:o.colorText},children:[e.jsx(n.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Name is required"}],labelCol:{style:{color:o.colorText}},children:e.jsx(s,{placeholder:"Enter dependent name",style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsx(n.Item,{label:"Relationship",name:"relationship",labelCol:{style:{color:o.colorText}},children:e.jsx(s,{placeholder:"e.g., Son, Daughter, Spouse",style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsx(n.Item,{label:"Date of Birth",name:"date_of_birth",labelCol:{style:{color:o.colorText}},children:e.jsx(P,{style:{width:"100%",backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsx(n.Item,{label:"Tribe",name:"tribe",labelCol:{style:{color:o.colorText}},children:e.jsx(s,{style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsx(n.Item,{label:"Residence",name:"residence",labelCol:{style:{color:o.colorText}},children:e.jsx(s,{style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsx(n.Item,{label:"Image",name:"image",valuePropName:"file",labelCol:{style:{color:o.colorText}},children:e.jsx(be,{maxCount:1,accept:"image/*",beforeUpload:()=>!1,children:e.jsx(c,{icon:e.jsx(ue,{}),children:"Upload Image"})})})]})}),e.jsx(b,{title:"Reject Dependent",open:z,onCancel:()=>{k(!1),T("")},onOk:G,okText:"Reject",cancelText:"Cancel",centered:!0,styles:{mask:{backgroundColor:"rgba(0, 0, 0, 0.45)"}},children:e.jsx(n,{layout:"vertical",children:e.jsx(n.Item,{label:"Rejection Reason",required:!0,children:e.jsx(s.TextArea,{rows:4,value:_,onChange:r=>T(r.target.value),placeholder:"Enter reason for rejection"})})})}),e.jsxs(b,{title:"Archive Member",open:O,onCancel:()=>D(!1),onOk:X,okText:"Archive",cancelText:"Cancel",okButtonProps:{danger:!0},centered:!0,styles:{mask:{backgroundColor:"rgba(0, 0, 0, 0.45)"}},children:[e.jsx("p",{children:"Are you sure you want to archive this member?"}),e.jsx("p",{style:{color:o.colorTextSecondary,fontSize:"12px"},children:"This action will soft delete the member record. You can restore it later from the archived members list."})]})]})})}export{ao as default};
