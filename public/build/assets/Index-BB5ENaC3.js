import{t as N,r as u,d as R,j as e,Q,S as x}from"./app-BCoYgWpy.js";import{B as g,A as K,S as X,D as J}from"./AdminSidebarLayout-DNChDxSB.js";import{F as a}from"./index-DI36EE_o.js";import{I as f}from"./index-FAD_XdFo.js";import{S as i}from"./index-D7Cm7sns.js";import{T}from"./index-CW0nKB7r.js";import{D as ee}from"./index-Bxb07XjO.js";import{U as te}from"./index-aid5zWZe.js";import{R as oe}from"./UploadOutlined-BdesYJeh.js";import{s as re}from"./index-BrLv-dAc.js";import{C as se,R as ae}from"./index-sjOIDGU-.js";import{R as le}from"./useIcons-DvOyxxY9.js";import{F as ne}from"./Table-vIq5QbJH.js";import{E as P}from"./index-DLbe-hQ7.js";import{M as B,R as ie}from"./index-DgKfZZJz.js";import{T as ce}from"./index-CrTY8Zdc.js";import{R as de}from"./MoreOutlined-BuyOgnSF.js";import{R as pe}from"./EyeOutlined-vMzgx86n.js";import{R as ue}from"./EditOutlined-B9fMtCwG.js";import{T as me}from"./index-BLkqHKOC.js";import"./SessionTimeout-BSdDJ2Oa.js";import"./Modal-BszroB66.js";import"./transition-CN7I8a8f.js";import"./PrimaryButton-CfU57GbV.js";import"./SecondaryButton-BtrCzkae.js";import"./CSSMotionList-D0-oo0HB.js";import"./useForm-DTPPr3dT.js";import"./row-DvslNah_.js";import"./CheckCircleFilled-DuKIAkof.js";import"./InfoCircleFilled-BB_XiD_I.js";import"./Input-CgSciwW_.js";import"./getAllowClear-D2seDeQM.js";import"./TextArea-D136Oc2B.js";import"./DownOutlined-CEBftIuV.js";import"./CalendarOutlined-j8ZEVuI5.js";import"./ClockCircleOutlined-BZYElUzj.js";import"./DownloadOutlined-VfbeSIaS.js";import"./progress-CIGBDoOc.js";import"./scrollTo-BdSh8p5n.js";import"./index-CfrNP3w0.js";const{TextArea:M}=f,{Option:$}=i,he=["Land","Buildings","Vehicles","Equipment","Furniture","Electronics","Computers","Software","Tools","Other"],xe=["Excellent","Good","Fair","Poor","Needs Repair"];function ge({asset:n,onSubmit:h,onCancel:p}){const[C]=a.useForm(),{token:r}=N.useToken();u.useEffect(()=>{n?C.setFieldsValue({...n,purchase_date:n.purchase_date?R(n.purchase_date):null}):C.resetFields()},[n,C]);const m=o=>{const c=new FormData;Object.keys(o).forEach(l=>{var j,d;o[l]!==void 0&&o[l]!==null&&(l==="purchase_date"?c.append(l,o[l].format("YYYY-MM-DD")):l==="photo"?(d=(j=o[l])==null?void 0:j.file)!=null&&d.originFileObj&&c.append(l,o[l].file.originFileObj):c.append(l,o[l]))}),n&&c.append("_method","PUT"),h(c)};return e.jsxs(a,{form:C,layout:"vertical",onFinish:m,initialValues:{purchase_date:R(),status:"active",condition:"Good"},children:[e.jsx(a.Item,{name:"name",label:"Asset Name",rules:[{required:!0,message:"Please enter asset name"}],children:e.jsx(f,{placeholder:"e.g., Toyota Land Cruiser",style:{backgroundColor:r.colorBgContainer,color:r.colorText}})}),e.jsx(a.Item,{name:"description",label:"Description",children:e.jsx(M,{rows:2,placeholder:"Detailed description of the asset",style:{backgroundColor:r.colorBgContainer,color:r.colorText}})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(a.Item,{name:"category",label:"Category",rules:[{required:!0,message:"Please select category"}],children:e.jsx(i,{placeholder:"Select category",style:{backgroundColor:r.colorBgContainer},children:he.map(o=>e.jsx($,{value:o,children:o},o))})}),e.jsx(a.Item,{name:"serial_number",label:"Serial Number",children:e.jsx(f,{placeholder:"Serial or identification number",style:{backgroundColor:r.colorBgContainer,color:r.colorText}})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(a.Item,{name:"purchase_cost",label:"Purchase Cost (TZS)",rules:[{required:!0,message:"Please enter purchase cost"}],children:e.jsx(T,{style:{width:"100%",backgroundColor:r.colorBgContainer,color:r.colorText},min:0,formatter:o=>`${o}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:o=>o.replace(/,/g,""),placeholder:"0.00"})}),e.jsx(a.Item,{name:"purchase_date",label:"Purchase Date",rules:[{required:!0,message:"Please select date"}],children:e.jsx(ee,{style:{width:"100%",backgroundColor:r.colorBgContainer,color:r.colorText}})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(a.Item,{name:"current_value",label:"Current Value (TZS)",children:e.jsx(T,{style:{width:"100%",backgroundColor:r.colorBgContainer,color:r.colorText},min:0,formatter:o=>`${o}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:o=>o.replace(/,/g,""),placeholder:"Leave empty for auto-calculation"})}),e.jsx(a.Item,{name:"useful_life_years",label:"Useful Life (Years)",children:e.jsx(T,{style:{width:"100%",backgroundColor:r.colorBgContainer,color:r.colorText},min:1,placeholder:"For depreciation calculation"})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(a.Item,{name:"location",label:"Location",children:e.jsx(f,{placeholder:"Where the asset is located",style:{backgroundColor:r.colorBgContainer,color:r.colorText}})}),e.jsx(a.Item,{name:"condition",label:"Condition",children:e.jsx(i,{placeholder:"Select condition",style:{backgroundColor:r.colorBgContainer},children:xe.map(o=>e.jsx($,{value:o,children:o},o))})})]}),e.jsx(a.Item,{name:"supplier",label:"Supplier",children:e.jsx(f,{placeholder:"Supplier or vendor name",style:{backgroundColor:r.colorBgContainer,color:r.colorText}})}),e.jsx(a.Item,{name:"photo",label:"Asset Photo",valuePropName:"file",children:e.jsx(te,{maxCount:1,beforeUpload:()=>!1,accept:".jpg,.jpeg,.png",listType:"picture",children:e.jsx(g,{icon:e.jsx(oe,{}),children:"Upload Photo"})})}),e.jsx(a.Item,{name:"notes",label:"Additional Notes",children:e.jsx(M,{rows:2,placeholder:"Any additional information",style:{backgroundColor:r.colorBgContainer,color:r.colorText}})}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"24px"},children:[e.jsx(g,{onClick:p,children:"Cancel"}),e.jsxs(g,{type:"primary",htmlType:"submit",children:[n?"Update":"Create"," Asset"]})]})]})}const{Text:at}=me,fe=["Land","Buildings","Vehicles","Equipment","Furniture","Electronics","Computers","Software","Tools","Other"],Ce=["Excellent","Good","Fair","Poor","Needs Repair"];function lt({assets:n,filters:h}){N.useToken();const[p,C]=re.useMessage(),[r,m]=u.useState(!1),[o,c]=u.useState(null),[l,j]=u.useState(!1),[d,b]=u.useState(null),[k,y]=u.useState(""),[v,w]=u.useState(h.search||""),[I,A]=u.useState(h.category||null),[_,E]=u.useState(h.status||null),[F,D]=u.useState(h.condition||null),O=()=>{x.get("/admin-portal/assets",{search:v,category:I,status:_,condition:F},{preserveState:!0,preserveScroll:!0})},L=()=>{w(""),A(null),E(null),D(null),x.get("/admin-portal/assets",{},{preserveState:!0,preserveScroll:!0})},U=()=>{c(null),m(!0)},V=t=>{c(t),m(!0)},q=t=>{o?x.post(`/admin-portal/assets/${o.id}`,t,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{m(!1),c(null),p.success("Asset updated successfully")},onError:s=>{console.error("Validation errors:",s),p.error("Failed to update asset. Please check the form.")}}):x.post("/admin-portal/assets",t,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{m(!1),p.success("Asset created successfully")},onError:s=>{console.error("Validation errors:",s),p.error("Failed to create asset. Please check the form.")}})},G=t=>{b(t),y(""),j(!0)},Y=()=>{d&&x.delete(`/admin-portal/assets/${d.id}`,{onSuccess:()=>{j(!1),b(null),y(""),p.success("Asset deleted successfully")},onError:()=>{p.error("Failed to delete asset")}})},S=(t,s)=>{x.post(`/admin-portal/assets/${t.id}/update-status`,{status:s},{onSuccess:()=>{p.success("Asset status updated successfully")},onError:()=>{p.error("Failed to update asset status")}})},Z=t=>({active:"green",under_maintenance:"orange",disposed:"red",sold:"blue"})[t]||"default",W=t=>({active:"Active",under_maintenance:"Under Maintenance",disposed:"Disposed",sold:"Sold"})[t]||t,z=t=>{const s=[{key:"edit",label:"Edit",icon:e.jsx(ue,{}),onClick:()=>V(t)}];return t.photo_path&&s.push({key:"view-photo",label:"View Photo",icon:e.jsx(pe,{}),onClick:()=>window.open(`/storage/${t.photo_path}`,"_blank")}),t.status!=="active"&&s.push({key:"mark-active",label:"Mark as Active",onClick:()=>S(t,"active")}),t.status!=="under_maintenance"&&s.push({key:"mark-maintenance",label:"Mark as Under Maintenance",onClick:()=>S(t,"under_maintenance")}),t.status!=="disposed"&&s.push({key:"mark-disposed",label:"Mark as Disposed",onClick:()=>S(t,"disposed")}),t.status!=="sold"&&s.push({key:"mark-sold",label:"Mark as Sold",onClick:()=>S(t,"sold")}),s.push({key:"delete",label:"Delete",icon:e.jsx(ie,{}),danger:!0,onClick:()=>G(t)}),s},H=[{title:"Asset Code",dataIndex:"asset_code",key:"asset_code",width:110},{title:"Name",dataIndex:"name",key:"name",width:180,ellipsis:!0},{title:"Category",dataIndex:"category",key:"category",width:120},{title:"Location",dataIndex:"location",key:"location",width:130,ellipsis:!0,render:t=>t||"-"},{title:"Purchase Cost",dataIndex:"purchase_cost",key:"purchase_cost",width:130,align:"right",render:t=>`TZS ${parseFloat(t).toLocaleString()}`},{title:"Current Value",dataIndex:"current_value",key:"current_value",width:130,align:"right",render:t=>t?`TZS ${parseFloat(t).toLocaleString()}`:"-"},{title:"Condition",dataIndex:"condition",key:"condition",width:110,render:t=>t||"-"},{title:"Status",dataIndex:"status",key:"status",width:130,render:t=>e.jsx(ce,{color:Z(t),children:W(t).toUpperCase()})},{title:"Actions",key:"actions",width:80,fixed:"right",render:(t,s)=>e.jsx(J,{menu:{items:z(s)},trigger:["click"],children:e.jsx(g,{type:"text",icon:e.jsx(de,{})})})}];return e.jsxs(e.Fragment,{children:[e.jsx(Q,{title:"Assets Management - Tabata Welfare Association"}),e.jsxs(K,{children:[C,e.jsxs(se,{children:[e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px"},children:[e.jsxs(X,{wrap:!0,children:[e.jsx(f,{placeholder:"Search assets...",prefix:e.jsx(le,{}),value:v,onChange:t=>w(t.target.value),onPressEnter:O,style:{width:250},allowClear:!0}),e.jsx(i,{placeholder:"Category",value:I,onChange:A,style:{width:130},allowClear:!0,children:fe.map(t=>e.jsx(i.Option,{value:t,children:t},t))}),e.jsxs(i,{placeholder:"Status",value:_,onChange:E,style:{width:150},allowClear:!0,children:[e.jsx(i.Option,{value:"active",children:"Active"}),e.jsx(i.Option,{value:"under_maintenance",children:"Under Maintenance"}),e.jsx(i.Option,{value:"disposed",children:"Disposed"}),e.jsx(i.Option,{value:"sold",children:"Sold"})]}),e.jsx(i,{placeholder:"Condition",value:F,onChange:D,style:{width:130},allowClear:!0,children:Ce.map(t=>e.jsx(i.Option,{value:t,children:t},t))}),e.jsx(g,{onClick:O,type:"primary",children:"Search"}),e.jsx(g,{onClick:L,children:"Reset"})]}),e.jsx(g,{type:"primary",icon:e.jsx(ae,{}),onClick:U,children:"Add Asset"})]}),e.jsx(ne,{columns:H,dataSource:n.data,rowKey:"id",pagination:{current:n.current_page,pageSize:n.per_page,total:n.total,showSizeChanger:!1,showTotal:t=>`Total ${t} assets`,onChange:t=>{x.get("/admin-portal/assets",{...h,page:t},{preserveState:!0,preserveScroll:!0})}},locale:{emptyText:e.jsx(P,{description:"No assets found",image:P.PRESENTED_IMAGE_SIMPLE})},scroll:{x:1200}})]}),e.jsx(B,{title:o?"Edit Asset":"Add New Asset",open:r,onCancel:()=>{m(!1),c(null)},footer:null,width:800,styles:{body:{maxHeight:"calc(100vh - 200px)",overflowY:"auto",overflowX:"hidden",paddingRight:"24px"}},children:e.jsx(ge,{asset:o,onSubmit:q,onCancel:()=>{m(!1),c(null)}})}),e.jsxs(B,{title:"Delete Asset",open:l,onCancel:()=>{j(!1),b(null),y("")},onOk:Y,okText:"Delete",okButtonProps:{danger:!0,disabled:k!==(d==null?void 0:d.name)},children:[e.jsxs("p",{children:['Are you sure you want to delete "',d==null?void 0:d.name,'"?']}),e.jsx("p",{children:"Type the asset name to confirm:"}),e.jsx(f,{value:k,onChange:t=>y(t.target.value),placeholder:"Type asset name here"})]})]})]})}export{lt as default};
