import{a as Q,r as c,j as e,S,J as de}from"./app-CCWscn4N.js";import{S as M,A as ue,B as _,c as G,C as J,D as me,q as K}from"./AdminSidebarLayout-BHFbP-0Z.js";import{d as Y}from"./dayjs.min-Be2yCFt4.js";import{F as x}from"./index-C7rJnUG_.js";import{M as V}from"./index-BhSHgn0Z.js";import{U as X}from"./index-gadxCu6H.js";import{R as pe}from"./InboxOutlined-DE-_a2QQ.js";import{I as B}from"./index-BFcOIicW.js";import{R as Z,C as P}from"./row-BLaRi8TG.js";import{S as m}from"./index-C-HA1eIq.js";import{D as xe}from"./index-D2nthcHU.js";import{T as I}from"./index-CCn2kg36.js";import{C as he,F as fe}from"./Table-DUVIRzZL.js";import{s as d}from"./index-BhyvampS.js";import{R as ge}from"./useIcons-Bh5YfX0K.js";import{E as H}from"./index-CdwOtgdH.js";import{R as W}from"./CheckCircleOutlined-jfc3C_4A.js";import{R as ye}from"./EyeOutlined-BXjcMdGf.js";import{R as be}from"./EditOutlined-BgapihRa.js";import{R as je}from"./CloseCircleOutlined-9LFhVxSu.js";import{R as Ce}from"./DeleteOutlined-S1oeFgow.js";import{R as Te}from"./MoreOutlined-D2Cbkv-l.js";import{R as Se,a as De,b as ve,c as ke,d as we}from"./FileWordOutlined-k2zIr8tR.js";import"./SessionTimeout-72mUHhjZ.js";import"./Modal-CTkSowC8.js";import"./transition-BcOJrHw_.js";import"./PrimaryButton-0XQdD5oU.js";import"./SecondaryButton-DbLXN_Wj.js";import"./CSSMotionList-CEJCmY9t.js";import"./useForm-CpR6UdBL.js";import"./CheckCircleFilled-B-8ZM7Vi.js";import"./InfoCircleFilled-BBeUonew.js";import"./DownloadOutlined-DAAaMqUK.js";import"./progress-KqQtMOrv.js";import"./getAllowClear-ggc3xdDv.js";import"./Input-Br3Lt1rS.js";import"./TextArea-n8YGhIra.js";import"./CalendarOutlined-eixNbCoN.js";import"./ClockCircleOutlined-BGBypZha.js";import"./DownOutlined-B9GtLQuW.js";import"./index-5hnhc-Y9.js";const{TextArea:Ie}=B,{Dragger:Pe}=X;function Fe({open:h,onCancel:D,document:i=null,categories:A={},visibilityOptions:p={}}){const{token:o}=Q.useToken(),[f]=x.useForm(),[g,C]=c.useState([]),[y,b]=c.useState((i==null?void 0:i.tags)||[]),[T,F]=c.useState(""),[E,O]=c.useState(!1),a=!!i;c.useEffect(()=>{h&&(a?(f.setFieldsValue({title:i.title,description:i.description,category:i.category,visibility:i.visibility,status:i.status,document_date:i.document_date?Y(i.document_date):null}),b(i.tags||[])):(f.resetFields(),C([]),b([])))},[h,i,a]);const L=l=>{if(!a&&g.length===0){d.error("Please select a file to upload");return}O(!0);const s=new FormData;if(a&&s.append("_method","PUT"),s.append("title",l.title),s.append("description",l.description||""),s.append("category",l.category),s.append("visibility",l.visibility),a?s.append("status",l.status):s.append("publish_immediately",l.publish_immediately?"1":"0"),s.append("document_date",l.document_date?Y(l.document_date).format("YYYY-MM-DD"):""),g.length>0){const n=g[0].originFileObj||g[0];s.append("file",n)}y.forEach((n,R)=>{s.append(`tags[${R}]`,n)});const w=a?route("admin-portal.documents.update",i.id):route("admin-portal.documents.store");S.post(w,s,{forceFormData:!0,onSuccess:()=>{d.success(a?"Document updated successfully":"Document uploaded successfully"),v()},onError:n=>{n.file?d.error(n.file):n.title?d.error(n.title):d.error(a?"Failed to update document":"Failed to upload document")},onFinish:()=>{O(!1)}})},v=()=>{f.resetFields(),C([]),b([]),F(""),D()},u={beforeUpload:l=>{if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/plain","image/jpeg","image/png"].includes(l.type))return d.error("Invalid file type. Please upload PDF, DOC, XLS, PPT, TXT, or image files."),X.LIST_IGNORE;if(!(l.size/1024/1024<15))return d.error("File must be smaller than 15MB"),X.LIST_IGNORE;if(!f.getFieldValue("title")){const n=l.name.replace(/\.[^/.]+$/,"");f.setFieldsValue({title:n})}return C([{uid:l.uid,name:l.name,status:"done",originFileObj:l}]),!1},fileList:g,onRemove:()=>{C([])},maxCount:1},k=()=>{T.trim()&&!y.includes(T.trim())&&(b([...y,T.trim()]),F(""))},U=l=>{b(y.filter(s=>s!==l))};return e.jsx(V,{title:a?"Edit Document":"Upload Document",open:h,onCancel:v,onOk:()=>f.submit(),confirmLoading:E,width:900,centered:!0,okText:a?"Update":"Upload",cancelText:"Cancel",destroyOnClose:!0,styles:{body:{maxHeight:"calc(100vh - 240px)",overflowY:"auto",overflowX:"hidden",paddingBottom:"16px",paddingRight:"24px"},mask:{backgroundColor:"rgba(0, 0, 0, 0.45)"}},children:e.jsxs(x,{form:f,layout:"vertical",onFinish:L,initialValues:{visibility:"members_only",publish_immediately:!0,status:"active"},style:{color:o.colorText},children:[e.jsx(x.Item,{label:a?"Replace Document File (Optional)":"Document File",required:!a,help:a?`Current file: ${i==null?void 0:i.file_name}`:"PDF, DOC, XLS, PPT, TXT, JPG, PNG up to 15MB",labelCol:{style:{color:o.colorText}},children:e.jsxs(Pe,{...u,style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder},children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(pe,{style:{color:o.colorPrimary}})}),e.jsx("p",{className:"ant-upload-text",style:{color:o.colorText},children:"Click or drag file to upload"}),e.jsx("p",{className:"ant-upload-hint",style:{color:o.colorTextSecondary},children:"Support for PDF, DOC, XLS, PPT, TXT, and image files"})]})}),e.jsx(x.Item,{label:"Document Title",name:"title",rules:[{required:!0,message:"Please enter document title"}],labelCol:{style:{color:o.colorText}},children:e.jsx(B,{placeholder:"Enter document title",style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsx(x.Item,{label:"Description",name:"description",labelCol:{style:{color:o.colorText}},children:e.jsx(Ie,{rows:3,placeholder:"Enter document description (optional)",style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsxs(Z,{gutter:16,children:[e.jsx(P,{xs:24,sm:12,children:e.jsx(x.Item,{label:"Category",name:"category",rules:[{required:!0,message:"Please select a category"}],labelCol:{style:{color:o.colorText}},children:e.jsx(m,{placeholder:"Select category",style:{color:o.colorText},children:Object.entries(A).map(([l,s])=>e.jsx(m.Option,{value:l,children:s},l))})})}),e.jsx(P,{xs:24,sm:12,children:e.jsx(x.Item,{label:"Visibility",name:"visibility",rules:[{required:!0,message:"Please select visibility"}],labelCol:{style:{color:o.colorText}},children:e.jsx(m,{style:{color:o.colorText},children:Object.entries(p).map(([l,s])=>e.jsx(m.Option,{value:l,children:s},l))})})})]}),a&&e.jsx(x.Item,{label:"Status",name:"status",rules:[{required:!0,message:"Please select status"}],labelCol:{style:{color:o.colorText}},children:e.jsxs(m,{style:{color:o.colorText},children:[e.jsx(m.Option,{value:"active",children:"Active"}),e.jsx(m.Option,{value:"archived",children:"Archived"}),e.jsx(m.Option,{value:"draft",children:"Draft"})]})}),e.jsx(x.Item,{label:"Document Date",name:"document_date",help:"The date this document refers to (e.g., meeting date)",labelCol:{style:{color:o.colorText}},children:e.jsx(xe,{style:{width:"100%",backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})}),e.jsx(x.Item,{label:"Tags",help:"Add tags to help categorize and search for this document",labelCol:{style:{color:o.colorText}},children:e.jsxs(M,{direction:"vertical",style:{width:"100%"},children:[e.jsx("div",{style:{marginBottom:"8px"},children:y.map(l=>e.jsx(I,{closable:!0,onClose:()=>U(l),style:{marginBottom:"4px"},children:l},l))}),e.jsxs(M.Compact,{style:{width:"100%"},children:[e.jsx(B,{placeholder:"Add tags (press Enter to add)",value:T,onChange:l=>F(l.target.value),onPressEnter:k,style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}}),e.jsx("button",{type:"button",onClick:k,style:{padding:"4px 15px",border:`1px solid ${o.colorBorder}`,background:o.colorBgContainer,color:o.colorText,cursor:"pointer",borderRadius:"0 6px 6px 0"},children:"Add"})]})]})}),!a&&e.jsx(x.Item,{name:"publish_immediately",valuePropName:"checked",children:e.jsx(he,{style:{color:o.colorText},children:"Publish immediately (make visible to members)"})})]})})}function yt(){const{documents:h={data:[]},filters:D={},categories:i={},statuses:A={},flash:p={}}=de().props,{token:o}=Q.useToken(),[f,g]=c.useState(D.search||""),[C,y]=c.useState(D.category||""),[b,T]=c.useState(D.status||""),[F,E]=c.useState(!1),[O,a]=c.useState(null),[L,v]=c.useState(!1),[u,k]=c.useState(null),[U,l]=c.useState(!1),[s,w]=c.useState(null),[n,R]=c.useState(null),[z,$]=c.useState("");c.useEffect(()=>{p!=null&&p.success&&d.success(p.success),p!=null&&p.error&&d.error(p.error)},[p]);const N=(t=null)=>{a(t),E(!0)},ee=()=>{E(!1),a(null)},q=()=>{S.get(route("admin-portal.documents.index"),{search:f,category:C,status:b},{preserveState:!0,preserveScroll:!0})},te=()=>{g(""),y(""),T(""),S.get(route("admin-portal.documents.index"))},oe=()=>{!u||z!==u.title||S.delete(route("admin-portal.documents.destroy",u.id),{onSuccess:()=>{d.success(`"${u.title}" deleted successfully`),v(!1),k(null),$("")},onError:()=>{d.error("Failed to delete document")}})},le=t=>{k(t),$(""),v(!0)},re=(t,r)=>{w(t),R(r),l(!0)},se=()=>{if(!s||!n)return;const t=n==="publish"?"admin-portal.documents.publish":"admin-portal.documents.unpublish",r=n==="publish"?"published":"unpublished";S.post(route(t,s.id),{},{onSuccess:()=>{d.success(`"${s.title}" ${r} successfully`),l(!1),w(null),R(null)},onError:()=>{d.error(`Failed to ${n} document`)}})},ie=t=>t?t>=1073741824?(t/1073741824).toFixed(2)+" GB":t>=1048576?(t/1048576).toFixed(2)+" MB":t>=1024?(t/1024).toFixed(2)+" KB":t+" bytes":"0 bytes",ne=t=>{if(!t)return e.jsx(K,{style:{fontSize:"24px",color:o.colorPrimary}});const r=t.split(".").pop().toLowerCase(),j={fontSize:"24px"};return r==="pdf"?e.jsx(Se,{style:{...j,color:"#ff4d4f"}}):["doc","docx"].includes(r)?e.jsx(De,{style:{...j,color:"#1890ff"}}):["xls","xlsx"].includes(r)?e.jsx(ve,{style:{...j,color:"#52c41a"}}):["jpg","jpeg","png","gif"].includes(r)?e.jsx(ke,{style:{...j,color:"#faad14"}}):["txt","md"].includes(r)?e.jsx(we,{style:{...j,color:o.colorPrimary}}):e.jsx(K,{style:{...j,color:o.colorPrimary}})},ae=t=>t.status==="draft"?e.jsx(I,{color:"default",children:"Draft"}):t.status==="archived"?e.jsx(I,{color:"warning",children:"Archived"}):t.published_at?e.jsx(I,{color:"success",icon:e.jsx(W,{}),children:"Published"}):e.jsx(I,{color:"orange",children:"Unpublished"}),ce=[{title:"Document",dataIndex:"title",key:"title",width:"35%",render:(t,r)=>e.jsxs(M,{children:[ne(r.file_name),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",color:o.colorText},children:t}),e.jsxs("div",{style:{fontSize:"12px",color:o.colorTextSecondary},children:[r.file_name," â€¢ ",ie(r.file_size)]})]})]})},{title:"Category",dataIndex:"category_display",key:"category",width:"15%",render:t=>e.jsx(I,{color:"blue",children:t})},{title:"Status",key:"status",width:"15%",render:(t,r)=>ae(r)},{title:"Uploaded By",dataIndex:["uploader","name"],key:"uploader",width:"15%"},{title:"Date",dataIndex:"created_at",key:"created_at",width:"12%",render:t=>Y(t).format("DD MMM YYYY")},{title:"Actions",key:"actions",width:"10%",render:(t,r)=>{const j=[{key:"view",label:"View",icon:e.jsx(ye,{}),onClick:()=>S.visit(route("admin-portal.documents.show",r.id))},{key:"edit",label:"Edit",icon:e.jsx(be,{}),onClick:()=>N(r)},{key:"publish",label:r.published_at?"Unpublish":"Publish",icon:r.published_at?e.jsx(je,{}):e.jsx(W,{}),onClick:()=>re(r,r.published_at?"unpublish":"publish")},{key:"delete",label:"Delete",icon:e.jsx(Ce,{}),danger:!0,onClick:()=>le(r)}];return e.jsx(me,{menu:{items:j},trigger:["click"],children:e.jsx(_,{type:"text",icon:e.jsx(Te,{})})})}}];return e.jsx(ue,{children:e.jsxs("div",{style:{padding:"24px 0"},children:[h.data&&h.data.length>0&&e.jsx("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"flex-end"},children:e.jsx(_,{type:"primary",icon:e.jsx(G,{}),size:"large",onClick:()=>N(),children:"Upload Document"})}),e.jsx(J,{style:{marginBottom:"24px"},children:e.jsxs(Z,{gutter:[16,16],align:"middle",children:[e.jsx(P,{xs:24,sm:12,md:8,children:e.jsx(B,{placeholder:"Search documents...",prefix:e.jsx(ge,{}),value:f,onChange:t=>g(t.target.value),onPressEnter:q,allowClear:!0})}),e.jsx(P,{xs:24,sm:6,md:4,children:e.jsx(m,{placeholder:"Category",value:C||void 0,onChange:y,style:{width:"100%"},allowClear:!0,children:Object.entries(i).map(([t,r])=>e.jsx(m.Option,{value:t,children:r},t))})}),e.jsx(P,{xs:24,sm:6,md:4,children:e.jsx(m,{placeholder:"Status",value:b||void 0,onChange:T,style:{width:"100%"},allowClear:!0,children:Object.entries(A).map(([t,r])=>e.jsx(m.Option,{value:t,children:r},t))})}),e.jsx(P,{xs:24,md:8,style:{textAlign:"right"},children:e.jsxs(M,{children:[e.jsx(_,{type:"primary",onClick:q,children:"Search"}),e.jsx(_,{onClick:te,children:"Clear"})]})})]})}),e.jsx(J,{children:e.jsx(fe,{columns:ce,dataSource:h.data||[],rowKey:"id",pagination:{current:h.current_page,pageSize:h.per_page,total:h.total,showSizeChanger:!0,showTotal:t=>`Total ${t} documents`,onChange:t=>{S.get(route("admin-portal.documents.index"),{...D,page:t})}},locale:{emptyText:e.jsx(H,{image:H.PRESENTED_IMAGE_SIMPLE,description:"No documents found",children:e.jsx(_,{type:"primary",icon:e.jsx(G,{}),onClick:()=>N(),children:"Upload Your First Document"})})}})}),e.jsx(Fe,{open:F,onCancel:ee,document:O,categories:i,visibilityOptions:{public:"Public",members_only:"Members Only",admin_only:"Admin Only"}}),e.jsxs(V,{title:"Delete Document",open:L,onCancel:()=>{v(!1),k(null),$("")},onOk:oe,okText:"Delete",cancelText:"Cancel",okButtonProps:{danger:!0,disabled:z!==(u==null?void 0:u.title)},centered:!0,styles:{mask:{backgroundColor:"rgba(0, 0, 0, 0.45)"}},children:[e.jsxs("p",{children:['Are you sure you want to delete "',u==null?void 0:u.title,'"?']}),e.jsx("p",{style:{color:o.colorTextSecondary,fontSize:"12px",marginBottom:"16px"},children:"This action cannot be undone. The document file will be permanently deleted."}),e.jsx("p",{style:{marginBottom:"8px"},children:"Type the document title to confirm:"}),e.jsx(B,{placeholder:"Enter document title",value:z,onChange:t=>$(t.target.value),style:{backgroundColor:o.colorBgContainer,borderColor:o.colorBorder,color:o.colorText}})]}),e.jsxs(V,{title:n==="publish"?"Publish Document":"Unpublish Document",open:U,onCancel:()=>{l(!1),w(null),R(null)},onOk:se,okText:n==="publish"?"Publish":"Unpublish",cancelText:"Cancel",centered:!0,styles:{mask:{backgroundColor:"rgba(0, 0, 0, 0.45)"}},children:[e.jsxs("p",{children:["Are you sure you want to ",n,' "',s==null?void 0:s.title,'"?']}),e.jsx("p",{style:{color:o.colorTextSecondary,fontSize:"12px"},children:n==="publish"?"This will make the document visible to members based on its visibility settings.":"This will hide the document from members until you publish it again."})]})]})})}export{yt as default};
